clear all
opengl software
addpath(genpath('C:\Program Files\MATLAB\R2016b\toolbox\altmany-export_fig-2763b78'))
addpath(genpath('C:\Program Files\MATLAB\R2016b\toolbox\useradded\append_pdfs'))
addpath(genpath('C:\Program Files\MATLAB\R2016b\toolbox\useradded\export_fig'))
plotting = figure;
set(gcf,'color','w');
set(plotting,'units','normalized','outerposition',[0 0 1 1]);
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 3 1]);
set(gcf,'renderer','painters')
colormap jet


%define constants
lambdaHalpha = 6562.81;
%http://www.rochesterastronomy.org/sn2014/index.html
%http://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?objname=UGC+8728&img_stamp=YES&extend=no&list_limit=9
%http://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?objname=VV%20306c&extend=no&out_csys=Equatorial&out_equinox=J2000.0&obj_sort=RA+or+Longitude&of=pre_text&zv_breaker=30000.0&list_limit=5&img_stamp=YES
%z_sn2014ab_MCG = 0.023516;
z_sn2014ab= 0.023203;
%juliandate(2014,03,9.43)+reltest(1)-juliandate(2014,01,12+11/24+24/60/24+41/60/60/24) determines the actual discovery date even though it was not announced
discoverydatejd_sn2014ab= juliandate(2014,01,12.4755);
discoverydatejd_sn2014ab_rochester = juliandate(2014,03,9.43);
jdtomjd=-2400000.5;
discoverydatemjd = discoverydatejd_sn2014ab+jdtomjd;
A_B_sn2014ab= 0.107;
A_V_sn2014ab= 0.081;
A_R_sn2014ab= 0.064;
A_I_sn2014ab= 0.044;
%redshiftdistance_2014ab = 105.7; %in Mpc error 7.4 for MCG
redshiftdistance_2014ab = 104.4; %in Mpc error 7.3 for VV306
redshiftdistancemodulus_2014ab = -5*(log10(redshiftdistance_2014ab*10^6)-1);
%R.A. = 13:48:05.99, 
%Decl. = +07:23:16.4 



%create relative dates for years 2004-2016
year2004MJD = 53005;
yearaxisreldate(1) = year2004MJD-discoverydatemjd;
for i=2:13
	yearaxisreldate(i) = year2004MJD-discoverydatemjd+(i-1)*365.25;
end

%read in data


%Lick
[d20140324_sn2014ab_1(1,:)  d20140324_sn2014ab_1(2,:) d20140324_sn2014ab_1(3,:)] =textread('sn2014ab-20140324.533-ui.flm','%f%f%f','delimiter',' ');
[d20140430_sn2014ab_1(1,:)  d20140430_sn2014ab_1(2,:) d20140430_sn2014ab_1(3,:)] =textread('sn2014ab-20140430.405-ui.flm','%f%f%f','delimiter',' ');
[d20140528_sn2014ab_1(1,:)  d20140528_sn2014ab_1(2,:) d20140528_sn2014ab_1(3,:)] =textread('sn2014ab-20140528.350-ui.flm','%f%f%f','delimiter',' ');
[d20140621_sn2014ab_1(1,:)  d20140621_sn2014ab_1(2,:) d20140621_sn2014ab_1(3,:)] =textread('sn2014ab-20140621.267-ui.flm','%f%f%f','delimiter',' ');
[d20140630_sn2014ab_1(1,:)  d20140630_sn2014ab_1(2,:) d20140630_sn2014ab_1(3,:)] =textread('sn2014ab-20140630.275-ui.flm','%f%f%f','delimiter',' ');

%Floyds
%code for iraf to generate the ascii files from the fits files:
%wspectext 14ab_20140408_redblu_130141.688.fits[*,1] 14ab_20140408_redblu_130141.688.ascii     
%wspectext 14ab_20140409_redblu_130138.753a.fits[*,1] 14ab_20140409_redblu_130138.753a.ascii     
%wspectext 14ab_20140411_redblu_110654.037a.fits[*,1] 14ab_20140411_redblu_110654.037a.ascii     
%wspectext PSN134805_20140507_redblu_091056.362a.fits[*,1] PSN134805_20140507_redblu_091056.362a.ascii
%wspectext PSN134805_20140507_redblu_111119.119a.fits[*,1] PSN134805_20140507_redblu_111119.119a.ascii
%wspectext PSN134805_20140507_redblu_115738.671a.fits[*,1] PSN134805_20140507_redblu_115738.671a.ascii
%wspectext sn2014ab_20140420_redblu_135720.950a.fits[*,1] sn2014ab_20140420_redblu_135720.950a.ascii 
%wspectext sn2014ab_20140423_redblu_134720.890a.fits[*,1] sn2014ab_20140423_redblu_134720.890a.ascii 
%wspectext sn2014ab_20140522_redblu_080229.904a.fits[*,1] sn2014ab_20140522_redblu_080229.904a.ascii 

%read in code for FLOYDS
[d20140408_sn2014ab_1(1,:)  d20140408_sn2014ab_1(2,:)] =textread('Floydsdata_DS/14ab_20140408_redblu_130141.688.ascii     ','%f%f','delimiter',' ');
[d20140409_sn2014ab_1(1,:)  d20140409_sn2014ab_1(2,:)] =textread('Floydsdata_DS/14ab_20140409_redblu_130138.753a.ascii     ','%f%f','delimiter',' ');
[d20140411_sn2014ab_1(1,:)  d20140411_sn2014ab_1(2,:)] =textread('Floydsdata_DS/14ab_20140411_redblu_110654.037a.ascii     ','%f%f','delimiter',' ');
[d20140507_sn2014ab_1(1,:)  d20140507_sn2014ab_1(2,:)] =textread('Floydsdata_DS/PSN134805_20140507_redblu_091056.362a.ascii','%f%f','delimiter',' ');
[d20140507_sn2014ab_2(1,:)  d20140507_sn2014ab_2(2,:)] =textread('Floydsdata_DS/PSN134805_20140507_redblu_111119.119a.ascii','%f%f','delimiter',' ');
[d20140507_sn2014ab_3(1,:)  d20140507_sn2014ab_3(2,:)] =textread('Floydsdata_DS/PSN134805_20140507_redblu_115738.671a.ascii','%f%f','delimiter',' ');
[d20140420_sn2014ab_1(1,:)  d20140420_sn2014ab_1(2,:)] =textread('Floydsdata_DS/sn2014ab_20140420_redblu_135720.950a.ascii ','%f%f','delimiter',' ');
[d20140423_sn2014ab_1(1,:)  d20140423_sn2014ab_1(2,:)] =textread('Floydsdata_DS/sn2014ab_20140423_redblu_134720.890a.ascii ','%f%f','delimiter',' ');
[d20140522_sn2014ab_1(1,:)  d20140522_sn2014ab_1(2,:)] =textread('Floydsdata_DS/sn2014ab_20140522_redblu_080229.904a.ascii ','%f%f','delimiter',' ');

d20140507datacell1 = {d20140507_sn2014ab_1(1,:) d20140507_sn2014ab_2(1,:) d20140507_sn2014ab_3(1,:)};
d20140507datacell2 = {d20140507_sn2014ab_1(2,:) d20140507_sn2014ab_2(2,:) d20140507_sn2014ab_3(2,:)};
[d20140507_sn2014ab_4(1,:),d20140507_sn2014ab_4(2,:)] = interpcombinedata(d20140507datacell1,d20140507datacell2);

%clf
%hold all
%plot(d20140408_sn2014ab_1(1,:),d20140408_sn2014ab_1(2,:))
%plot(d20140409_sn2014ab_1(1,:),d20140409_sn2014ab_1(2,:))
%plot(d20140411_sn2014ab_1(1,:),d20140411_sn2014ab_1(2,:))
%axis([[4650 5100] [0.55*10^-16 4*10^-14]])
%export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\DoublePeakHbetaFLOYDS20140408to11.pdf

%Magellan
[d20140519_sn2014ab_1(1,:)  d20140519_sn2014ab_1(2,:)] =textread('SN2014ab_IMACS_1200_2014-05-19.txt','%f%f','delimiter',' ');


%%%%%should compare what the difference between these two is
%NTT
[d20140310_sn2014ab_1(1,:)  d20140310_sn2014ab_1(2,:)] =textread('PSJ13480599+0723164_20140309_Gr13_Free_slit1.0_57003_1.dat','%f%f','delimiter',' ');
[d20140310_sn2014ab_2(1,:)  d20140310_sn2014ab_2(2,:)] =textread('tPSJ13480599+0723164_20140309_Gr13_Free_slit1.0_1_f.asci','%f%f','delimiter',' ');

%actually somewhat different but ignoring for now
clf
plot(d20140310_sn2014ab_1(1,:),d20140310_sn2014ab_1(2,:))
hold all
plot(d20140310_sn2014ab_2(1,:),d20140310_sn2014ab_2(2,:))

%VLT-X-Shooter
rawbt20140526_2 =  fitsread('ADP.2014-05-26T15_03_44.393.fits','binarytable');
rawbt20140526_3 =  fitsread('ADP.2014-05-26T15_03_44.407.fits','binarytable');
rawbt20140526_4 =  fitsread('ADP.2014-05-26T15_03_44.607.fits','binarytable');
rawbt20140602_1 =  fitsread('ADP.2014-06-02T12_54_50.840.fits','binarytable');
rawbt20140602_2 =  fitsread('ADP.2014-06-02T12_54_51.460.fits','binarytable');
rawbt20140602_3 =  fitsread('ADP.2014-06-02T12_54_51.513.fits','binarytable');
rawbt20140722_1 =  fitsread('ADP.2014-07-22T07_25_21.390.fits','binarytable');
rawbt20140722_2 =  fitsread('ADP.2014-07-22T07_25_21.403.fits','binarytable');
rawbt20140722_3 =  fitsread('ADP.2014-07-22T07_25_21.717.fits','binarytable');
rawbt20140722_4 =  fitsread('ADP.2014-07-22T07_35_01.203.fits','binarytable');
rawbt20140722_5 =  fitsread('ADP.2014-07-22T07_35_01.463.fits','binarytable');
rawbt20140722_6 =  fitsread('ADP.2014-07-22T07_35_01.713.fits','binarytable');
rawbt20140808_1 =  fitsread('ADP.2014-08-08T10_21_32.763.fits','binarytable');
rawbt20140808_2 =  fitsread('ADP.2014-08-08T10_21_32.777.fits','binarytable');
rawbt20140808_3 =  fitsread('ADP.2014-08-08T10_21_32.977.fits','binarytable');

d20140526_sn2014abtemp_2(1,:) = cell2mat(rawbt20140526_2(1)).*10;
d20140526_sn2014abtemp_3(1,:) = cell2mat(rawbt20140526_3(1)).*10;
d20140526_sn2014abtemp_4(1,:) = cell2mat(rawbt20140526_4(1)).*10;
d20140602_sn2014abtemp_1(1,:) = cell2mat(rawbt20140602_1(1)).*10;
d20140602_sn2014abtemp_2(1,:) = cell2mat(rawbt20140602_2(1)).*10;
d20140602_sn2014abtemp_3(1,:) = cell2mat(rawbt20140602_3(1)).*10;
d20140722_sn2014abtemp_1(1,:) = cell2mat(rawbt20140722_1(1)).*10;
d20140722_sn2014abtemp_2(1,:) = cell2mat(rawbt20140722_2(1)).*10;
d20140722_sn2014abtemp_3(1,:) = cell2mat(rawbt20140722_3(1)).*10;
d20140722_sn2014abtemp_4(1,:) = cell2mat(rawbt20140722_4(1)).*10;
d20140722_sn2014abtemp_5(1,:) = cell2mat(rawbt20140722_5(1)).*10;
d20140722_sn2014abtemp_6(1,:) = cell2mat(rawbt20140722_6(1)).*10;
d20140808_sn2014abtemp_1(1,:) = cell2mat(rawbt20140808_1(1)).*10;
d20140808_sn2014abtemp_2(1,:) = cell2mat(rawbt20140808_2(1)).*10;
d20140808_sn2014abtemp_3(1,:) = cell2mat(rawbt20140808_3(1)).*10;

d20140526_sn2014abtemp_2(2,:) = cell2mat(rawbt20140526_2(2));
d20140526_sn2014abtemp_3(2,:) = cell2mat(rawbt20140526_3(2));
d20140526_sn2014abtemp_4(2,:) = cell2mat(rawbt20140526_4(2));
d20140602_sn2014abtemp_1(2,:) = cell2mat(rawbt20140602_1(2));
d20140602_sn2014abtemp_2(2,:) = cell2mat(rawbt20140602_2(2));
d20140602_sn2014abtemp_3(2,:) = cell2mat(rawbt20140602_3(2));
d20140722_sn2014abtemp_1(2,:) = cell2mat(rawbt20140722_1(2));
d20140722_sn2014abtemp_2(2,:) = cell2mat(rawbt20140722_2(2));
d20140722_sn2014abtemp_3(2,:) = cell2mat(rawbt20140722_3(2));
d20140722_sn2014abtemp_4(2,:) = cell2mat(rawbt20140722_4(2));
d20140722_sn2014abtemp_5(2,:) = cell2mat(rawbt20140722_5(2));
d20140722_sn2014abtemp_6(2,:) = cell2mat(rawbt20140722_6(2));
d20140808_sn2014abtemp_1(2,:) = cell2mat(rawbt20140808_1(2));
d20140808_sn2014abtemp_2(2,:) = cell2mat(rawbt20140808_2(2));
d20140808_sn2014abtemp_3(2,:) = cell2mat(rawbt20140808_3(2));

%stitch together VLT X-Shooter data
d20140526_sn2014ab_2(1,:) = [d20140526_sn2014abtemp_3(1,:) d20140526_sn2014abtemp_2(1,(find(d20140526_sn2014abtemp_2(1,:) > max(d20140526_sn2014abtemp_3(1,:)),1,'first')):length(d20140526_sn2014abtemp_2)) d20140526_sn2014abtemp_4(1,(find(d20140526_sn2014abtemp_4(1,:) > max(d20140526_sn2014abtemp_2(1,:)),1,'first')):length(d20140526_sn2014abtemp_4))];
d20140526_sn2014ab_2(2,:) = [d20140526_sn2014abtemp_3(2,:) d20140526_sn2014abtemp_2(2,(find(d20140526_sn2014abtemp_2(1,:) > max(d20140526_sn2014abtemp_3(1,:)),1,'first')):length(d20140526_sn2014abtemp_2)) d20140526_sn2014abtemp_4(2,(find(d20140526_sn2014abtemp_4(1,:) > max(d20140526_sn2014abtemp_2(1,:)),1,'first')):length(d20140526_sn2014abtemp_4))];

d20140602_sn2014ab_1(1,:) = [d20140602_sn2014abtemp_1(1,:) d20140602_sn2014abtemp_3(1,(find(d20140602_sn2014abtemp_3(1,:) > max(d20140602_sn2014abtemp_1(1,:)),1,'first')):length(d20140602_sn2014abtemp_3)) d20140602_sn2014abtemp_2(1,(find(d20140602_sn2014abtemp_2(1,:) > max(d20140602_sn2014abtemp_3(1,:)),1,'first')):length(d20140602_sn2014abtemp_2))];
d20140602_sn2014ab_1(2,:) = [d20140602_sn2014abtemp_1(2,:) d20140602_sn2014abtemp_3(2,(find(d20140602_sn2014abtemp_3(1,:) > max(d20140602_sn2014abtemp_1(1,:)),1,'first')):length(d20140602_sn2014abtemp_3)) d20140602_sn2014abtemp_2(2,(find(d20140602_sn2014abtemp_2(1,:) > max(d20140602_sn2014abtemp_3(1,:)),1,'first')):length(d20140602_sn2014abtemp_2))];

%321
d20140722_sn2014ab_1(1,:) = [d20140722_sn2014abtemp_3(1,:) d20140722_sn2014abtemp_2(1,(find(d20140722_sn2014abtemp_2(1,:) > max(d20140722_sn2014abtemp_3(1,:)),1,'first')):length(d20140722_sn2014abtemp_2)) d20140722_sn2014abtemp_1(1,(find(d20140722_sn2014abtemp_1(1,:) > max(d20140722_sn2014abtemp_2(1,:)),1,'first')):length(d20140722_sn2014abtemp_1))];
d20140722_sn2014ab_1(2,:) = [d20140722_sn2014abtemp_3(2,:) d20140722_sn2014abtemp_2(2,(find(d20140722_sn2014abtemp_2(1,:) > max(d20140722_sn2014abtemp_3(1,:)),1,'first')):length(d20140722_sn2014abtemp_2)) d20140722_sn2014abtemp_1(2,(find(d20140722_sn2014abtemp_1(1,:) > max(d20140722_sn2014abtemp_2(1,:)),1,'first')):length(d20140722_sn2014abtemp_1))];

%465
d20140722_sn2014ab_4(1,:) = [d20140722_sn2014abtemp_4(1,:) d20140722_sn2014abtemp_6(1,(find(d20140722_sn2014abtemp_6(1,:) > max(d20140722_sn2014abtemp_4(1,:)),1,'first')):length(d20140722_sn2014abtemp_6)) d20140722_sn2014abtemp_5(1,(find(d20140722_sn2014abtemp_5(1,:) > max(d20140722_sn2014abtemp_6(1,:)),1,'first')):length(d20140722_sn2014abtemp_5))];
d20140722_sn2014ab_4(2,:) = [d20140722_sn2014abtemp_4(2,:) d20140722_sn2014abtemp_6(2,(find(d20140722_sn2014abtemp_6(1,:) > max(d20140722_sn2014abtemp_4(1,:)),1,'first')):length(d20140722_sn2014abtemp_6)) d20140722_sn2014abtemp_5(2,(find(d20140722_sn2014abtemp_5(1,:) > max(d20140722_sn2014abtemp_6(1,:)),1,'first')):length(d20140722_sn2014abtemp_5))];

d20140808_sn2014ab_1(1,:) = [d20140808_sn2014abtemp_2(1,:) d20140808_sn2014abtemp_3(1,(find(d20140808_sn2014abtemp_3(1,:) > max(d20140808_sn2014abtemp_2(1,:)),1,'first')):length(d20140808_sn2014abtemp_3)) d20140808_sn2014abtemp_1(1,(find(d20140808_sn2014abtemp_1(1,:) > max(d20140808_sn2014abtemp_3(1,:)),1,'first')):length(d20140808_sn2014abtemp_1))];
d20140808_sn2014ab_1(2,:) = [d20140808_sn2014abtemp_2(2,:) d20140808_sn2014abtemp_3(2,(find(d20140808_sn2014abtemp_3(1,:) > max(d20140808_sn2014abtemp_2(1,:)),1,'first')):length(d20140808_sn2014abtemp_3)) d20140808_sn2014abtemp_1(2,(find(d20140808_sn2014abtemp_1(1,:) > max(d20140808_sn2014abtemp_3(1,:)),1,'first')):length(d20140808_sn2014abtemp_1))];


%clf
%semilogy(d20140722_sn2014abtemp_4(1,:),d20140722_sn2014abtemp_4(2,:))
%hold on 
%semilogy(d20140722_sn2014abtemp_5(1,:),d20140722_sn2014abtemp_5(2,:))
%semilogy(d20140722_sn2014abtemp_6(1,:),d20140722_sn2014abtemp_6(2,:))

%flxxx matches the q2 files for all of the cases where there is a q1 and q2, why is this and what is the other file?  Where are the error files?
%0329 q2
%0501 q2
%0523 q2
%0622 q2
%0623 q2

%read in data for late-time MMT spectrum
[d20180414_sn2014ab_1(1,:) d20180414_sn2014ab_1(2,:)] =textread('MMT/SN2014abGal-2018-04-14-MMT-BCH-1200_formatedited.txt','%f%f','delimiter',' ');

%spectropolarimetry spol
[d20140329_sn2014ab_1(1,:)  d20140329_sn2014ab_1(2,:)] =textread('20140329_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140329_sn2014ab_1(3,:)] =textread('20140329_sn2014ab_1.q.txt','%f%f','delimiter',' ');
[temp  d20140329_sn2014ab_1(4,:)] =textread('20140329_sn2014ab_1.u.txt','%f%f','delimiter',' ');
[temp  d20140329_sn2014ab_1(5,:)] =textread('20140329_sn2014ab_2.q.txt','%f%f','delimiter',' ');
[temp d20140329_sn2014ab_1(6,:)] =textread('20140329_sn2014ab_2.u.txt','%f%f','delimiter',' ');

d20140329_SPOL_sn2014ab_1(1,:) =  d20140329_sn2014ab_1(1,(d20140329_sn2014ab_1(1,:) > 4000) & (d20140329_sn2014ab_1(1,:) < 7550));
d20140329_SPOL_sn2014ab_1(2,:) =  d20140329_sn2014ab_1(2,(d20140329_sn2014ab_1(1,:) > 4000) & (d20140329_sn2014ab_1(1,:) < 7550));
d20140329_SPOL_sn2014ab_1(3,:) =  d20140329_sn2014ab_1(3,(d20140329_sn2014ab_1(1,:) > 4000) & (d20140329_sn2014ab_1(1,:) < 7550));
d20140329_SPOL_sn2014ab_1(4,:) =  d20140329_sn2014ab_1(4,(d20140329_sn2014ab_1(1,:) > 4000) & (d20140329_sn2014ab_1(1,:) < 7550));
d20140329_SPOL_sn2014ab_1(5,:) =  d20140329_sn2014ab_1(5,(d20140329_sn2014ab_1(1,:) > 4000) & (d20140329_sn2014ab_1(1,:) < 7550));
d20140329_SPOL_sn2014ab_1(6,:) =  d20140329_sn2014ab_1(6,(d20140329_sn2014ab_1(1,:) > 4000) & (d20140329_sn2014ab_1(1,:) < 7550));

[d20140330_sn2014ab_1(1,:)  d20140330_sn2014ab_1(2,:)] =textread('20140330_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140330_sn2014ab_1(3,:)] =textread('20140330_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140330_sn2014ab_1(4,:)] =textread('20140330_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140330_SPOL_sn2014ab_1(1,:) =  d20140330_sn2014ab_1(1,(d20140330_sn2014ab_1(1,:) > 4000) & (d20140330_sn2014ab_1(1,:) < 7550));
d20140330_SPOL_sn2014ab_1(2,:) =  d20140330_sn2014ab_1(2,(d20140330_sn2014ab_1(1,:) > 4000) & (d20140330_sn2014ab_1(1,:) < 7550));
d20140330_SPOL_sn2014ab_1(3,:) =  d20140330_sn2014ab_1(3,(d20140330_sn2014ab_1(1,:) > 4000) & (d20140330_sn2014ab_1(1,:) < 7550));
d20140330_SPOL_sn2014ab_1(4,:) =  d20140330_sn2014ab_1(4,(d20140330_sn2014ab_1(1,:) > 4000) & (d20140330_sn2014ab_1(1,:) < 7550));



[d20140331_sn2014ab_1(1,:)  d20140331_sn2014ab_1(2,:)] =textread('20140331_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140331_sn2014ab_1(3,:)] =textread('20140331_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140331_sn2014ab_1(4,:)] =textread('20140331_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140331_SPOL_sn2014ab_1(1,:) =  d20140331_sn2014ab_1(1,(d20140331_sn2014ab_1(1,:) > 4000) & (d20140331_sn2014ab_1(1,:) < 7550));
d20140331_SPOL_sn2014ab_1(2,:) =  d20140331_sn2014ab_1(2,(d20140331_sn2014ab_1(1,:) > 4000) & (d20140331_sn2014ab_1(1,:) < 7550));
d20140331_SPOL_sn2014ab_1(3,:) =  d20140331_sn2014ab_1(3,(d20140331_sn2014ab_1(1,:) > 4000) & (d20140331_sn2014ab_1(1,:) < 7550));
d20140331_SPOL_sn2014ab_1(4,:) =  d20140331_sn2014ab_1(4,(d20140331_sn2014ab_1(1,:) > 4000) & (d20140331_sn2014ab_1(1,:) < 7550));


[d20140402_sn2014ab_1(1,:)  d20140402_sn2014ab_1(2,:)] =textread('20140402_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140402_sn2014ab_1(3,:)] =textread('20140402_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140402_sn2014ab_1(4,:)] =textread('20140402_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140402_SPOL_sn2014ab_1(1,:) =  d20140402_sn2014ab_1(1,(d20140402_sn2014ab_1(1,:) > 4000) & (d20140402_sn2014ab_1(1,:) < 7550));
d20140402_SPOL_sn2014ab_1(2,:) =  d20140402_sn2014ab_1(2,(d20140402_sn2014ab_1(1,:) > 4000) & (d20140402_sn2014ab_1(1,:) < 7550));
d20140402_SPOL_sn2014ab_1(3,:) =  d20140402_sn2014ab_1(3,(d20140402_sn2014ab_1(1,:) > 4000) & (d20140402_sn2014ab_1(1,:) < 7550));
d20140402_SPOL_sn2014ab_1(4,:) =  d20140402_sn2014ab_1(4,(d20140402_sn2014ab_1(1,:) > 4000) & (d20140402_sn2014ab_1(1,:) < 7550));

[d20140426_sn2014ab_1(1,:)  d20140426_sn2014ab_1(2,:)] =textread('20140426_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140426_sn2014ab_1(3,:)] =textread('20140426_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140426_sn2014ab_1(4,:)] =textread('20140426_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140426_SPOL_sn2014ab_1(1,:) =  d20140426_sn2014ab_1(1,(d20140426_sn2014ab_1(1,:) > 4000) & (d20140426_sn2014ab_1(1,:) < 7550));
d20140426_SPOL_sn2014ab_1(2,:) =  d20140426_sn2014ab_1(2,(d20140426_sn2014ab_1(1,:) > 4000) & (d20140426_sn2014ab_1(1,:) < 7550));
d20140426_SPOL_sn2014ab_1(3,:) =  d20140426_sn2014ab_1(3,(d20140426_sn2014ab_1(1,:) > 4000) & (d20140426_sn2014ab_1(1,:) < 7550));
d20140426_SPOL_sn2014ab_1(4,:) =  d20140426_sn2014ab_1(4,(d20140426_sn2014ab_1(1,:) > 4000) & (d20140426_sn2014ab_1(1,:) < 7550));

[d20140427_sn2014ab_1(1,:)  d20140427_sn2014ab_1(2,:)] =textread('20140427_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140427_sn2014ab_1(3,:)] =textread('20140427_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140427_sn2014ab_1(4,:)] =textread('20140427_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140427_SPOL_sn2014ab_1(1,:) =  d20140427_sn2014ab_1(1,(d20140427_sn2014ab_1(1,:) > 4000) & (d20140427_sn2014ab_1(1,:) < 7550));
d20140427_SPOL_sn2014ab_1(2,:) =  d20140427_sn2014ab_1(2,(d20140427_sn2014ab_1(1,:) > 4000) & (d20140427_sn2014ab_1(1,:) < 7550));
d20140427_SPOL_sn2014ab_1(3,:) =  d20140427_sn2014ab_1(3,(d20140427_sn2014ab_1(1,:) > 4000) & (d20140427_sn2014ab_1(1,:) < 7550));
d20140427_SPOL_sn2014ab_1(4,:) =  d20140427_sn2014ab_1(4,(d20140427_sn2014ab_1(1,:) > 4000) & (d20140427_sn2014ab_1(1,:) < 7550));

[d20140428_sn2014ab_1(1,:)  d20140428_sn2014ab_1(2,:)] =textread('20140428_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140428_sn2014ab_1(3,:)] =textread('20140428_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140428_sn2014ab_1(4,:)] =textread('20140428_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140428_SPOL_sn2014ab_1(1,:) =  d20140428_sn2014ab_1(1,(d20140428_sn2014ab_1(1,:) > 4000) & (d20140428_sn2014ab_1(1,:) < 7550));
d20140428_SPOL_sn2014ab_1(2,:) =  d20140428_sn2014ab_1(2,(d20140428_sn2014ab_1(1,:) > 4000) & (d20140428_sn2014ab_1(1,:) < 7550));
d20140428_SPOL_sn2014ab_1(3,:) =  d20140428_sn2014ab_1(3,(d20140428_sn2014ab_1(1,:) > 4000) & (d20140428_sn2014ab_1(1,:) < 7550));
d20140428_SPOL_sn2014ab_1(4,:) =  d20140428_sn2014ab_1(4,(d20140428_sn2014ab_1(1,:) > 4000) & (d20140428_sn2014ab_1(1,:) < 7550));

[d20140501_sn2014ab_1(1,:)  d20140501_sn2014ab_1(2,:)] =textread('20140501_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140501_sn2014ab_1(3,:)] =textread('20140501_sn2014ab_1.q.txt','%f%f','delimiter',' ');
[temp  d20140501_sn2014ab_1(4,:)] =textread('20140501_sn2014ab_1.u.txt','%f%f','delimiter',' ');
[temp  d20140501_sn2014ab_1(5,:)] =textread('20140501_sn2014ab_2.q.txt','%f%f','delimiter',' ');
[temp d20140501_sn2014ab_1(6,:)] =textread('20140501_sn2014ab_2.u.txt','%f%f','delimiter',' ');

d20140501_SPOL_sn2014ab_1(1,:) =  d20140501_sn2014ab_1(1,(d20140501_sn2014ab_1(1,:) > 4000) & (d20140501_sn2014ab_1(1,:) < 7550));
d20140501_SPOL_sn2014ab_1(2,:) =  d20140501_sn2014ab_1(2,(d20140501_sn2014ab_1(1,:) > 4000) & (d20140501_sn2014ab_1(1,:) < 7550));
d20140501_SPOL_sn2014ab_1(3,:) =  d20140501_sn2014ab_1(3,(d20140501_sn2014ab_1(1,:) > 4000) & (d20140501_sn2014ab_1(1,:) < 7550));
d20140501_SPOL_sn2014ab_1(4,:) =  d20140501_sn2014ab_1(4,(d20140501_sn2014ab_1(1,:) > 4000) & (d20140501_sn2014ab_1(1,:) < 7550));
d20140501_SPOL_sn2014ab_1(5,:) =  d20140501_sn2014ab_1(5,(d20140501_sn2014ab_1(1,:) > 4000) & (d20140501_sn2014ab_1(1,:) < 7550));
d20140501_SPOL_sn2014ab_1(6,:) =  d20140501_sn2014ab_1(6,(d20140501_sn2014ab_1(1,:) > 4000) & (d20140501_sn2014ab_1(1,:) < 7550));

[d20140523_sn2014ab_1(1,:)  d20140523_sn2014ab_1(2,:)] =textread('20140523_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140523_sn2014ab_1(3,:)] =textread('20140523_sn2014ab_1.q.txt','%f%f','delimiter',' ');
[temp  d20140523_sn2014ab_1(4,:)] =textread('20140523_sn2014ab_1.u.txt','%f%f','delimiter',' ');
[temp  d20140523_sn2014ab_1(5,:)] =textread('20140523_sn2014ab_2.q.txt','%f%f','delimiter',' ');
[temp  d20140523_sn2014ab_1(6,:)] =textread('20140523_sn2014ab_2.u.txt','%f%f','delimiter',' ');

d20140523_SPOL_sn2014ab_1(1,:) =  d20140523_sn2014ab_1(1,(d20140523_sn2014ab_1(1,:) > 4000) & (d20140523_sn2014ab_1(1,:) < 7550));
d20140523_SPOL_sn2014ab_1(2,:) =  d20140523_sn2014ab_1(2,(d20140523_sn2014ab_1(1,:) > 4000) & (d20140523_sn2014ab_1(1,:) < 7550));
d20140523_SPOL_sn2014ab_1(3,:) =  d20140523_sn2014ab_1(3,(d20140523_sn2014ab_1(1,:) > 4000) & (d20140523_sn2014ab_1(1,:) < 7550));
d20140523_SPOL_sn2014ab_1(4,:) =  d20140523_sn2014ab_1(4,(d20140523_sn2014ab_1(1,:) > 4000) & (d20140523_sn2014ab_1(1,:) < 7550));
d20140523_SPOL_sn2014ab_1(5,:) =  d20140523_sn2014ab_1(5,(d20140523_sn2014ab_1(1,:) > 4000) & (d20140523_sn2014ab_1(1,:) < 7550));
d20140523_SPOL_sn2014ab_1(6,:) =  d20140523_sn2014ab_1(6,(d20140523_sn2014ab_1(1,:) > 4000) & (d20140523_sn2014ab_1(1,:) < 7550));

[d20140524_sn2014ab_1(1,:)  d20140524_sn2014ab_1(2,:)] =textread('20140524_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140524_sn2014ab_1(3,:)] =textread('20140524_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140524_sn2014ab_1(4,:)] =textread('20140524_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140524_SPOL_sn2014ab_1(1,:) =  d20140524_sn2014ab_1(1,(d20140524_sn2014ab_1(1,:) > 4000) & (d20140524_sn2014ab_1(1,:) < 7550));
d20140524_SPOL_sn2014ab_1(2,:) =  d20140524_sn2014ab_1(2,(d20140524_sn2014ab_1(1,:) > 4000) & (d20140524_sn2014ab_1(1,:) < 7550));
d20140524_SPOL_sn2014ab_1(3,:) =  d20140524_sn2014ab_1(3,(d20140524_sn2014ab_1(1,:) > 4000) & (d20140524_sn2014ab_1(1,:) < 7550));
d20140524_SPOL_sn2014ab_1(4,:) =  d20140524_sn2014ab_1(4,(d20140524_sn2014ab_1(1,:) > 4000) & (d20140524_sn2014ab_1(1,:) < 7550));

[d20140526_sn2014ab_1(1,:)  d20140526_sn2014ab_1(2,:)] =textread('20140526_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140526_sn2014ab_1(3,:)] =textread('20140526_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140526_sn2014ab_1(4,:)] =textread('20140526_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140526_SPOL_sn2014ab_1(1,:) =  d20140526_sn2014ab_1(1,(d20140526_sn2014ab_1(1,:) > 4000) & (d20140526_sn2014ab_1(1,:) < 7550));
d20140526_SPOL_sn2014ab_1(2,:) =  d20140526_sn2014ab_1(2,(d20140526_sn2014ab_1(1,:) > 4000) & (d20140526_sn2014ab_1(1,:) < 7550));
d20140526_SPOL_sn2014ab_1(3,:) =  d20140526_sn2014ab_1(3,(d20140526_sn2014ab_1(1,:) > 4000) & (d20140526_sn2014ab_1(1,:) < 7550));
d20140526_SPOL_sn2014ab_1(4,:) =  d20140526_sn2014ab_1(4,(d20140526_sn2014ab_1(1,:) > 4000) & (d20140526_sn2014ab_1(1,:) < 7550));

[d20140622_sn2014ab_1(1,:)  d20140622_sn2014ab_1(2,:)] =textread('20140622_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140622_sn2014ab_1(3,:)] =textread('20140622_sn2014ab_1.q.txt','%f%f','delimiter',' ');
[temp  d20140622_sn2014ab_1(4,:)] =textread('20140622_sn2014ab_1.u.txt','%f%f','delimiter',' ');
[temp  d20140622_sn2014ab_1(5,:)] =textread('20140622_sn2014ab_2.q.txt','%f%f','delimiter',' ');
[temp  d20140622_sn2014ab_1(6,:)] =textread('20140622_sn2014ab_2.u.txt','%f%f','delimiter',' ');

d20140622_SPOL_sn2014ab_1(1,:) =  d20140622_sn2014ab_1(1,(d20140622_sn2014ab_1(1,:) > 4000) & (d20140622_sn2014ab_1(1,:) < 7550));
d20140622_SPOL_sn2014ab_1(2,:) =  d20140622_sn2014ab_1(2,(d20140622_sn2014ab_1(1,:) > 4000) & (d20140622_sn2014ab_1(1,:) < 7550));
d20140622_SPOL_sn2014ab_1(3,:) =  d20140622_sn2014ab_1(3,(d20140622_sn2014ab_1(1,:) > 4000) & (d20140622_sn2014ab_1(1,:) < 7550));
d20140622_SPOL_sn2014ab_1(4,:) =  d20140622_sn2014ab_1(4,(d20140622_sn2014ab_1(1,:) > 4000) & (d20140622_sn2014ab_1(1,:) < 7550));
d20140622_SPOL_sn2014ab_1(5,:) =  d20140622_sn2014ab_1(5,(d20140622_sn2014ab_1(1,:) > 4000) & (d20140622_sn2014ab_1(1,:) < 7550));
d20140622_SPOL_sn2014ab_1(6,:) =  d20140622_sn2014ab_1(6,(d20140622_sn2014ab_1(1,:) > 4000) & (d20140622_sn2014ab_1(1,:) < 7550));

[d20140623_sn2014ab_1(1,:)  d20140623_sn2014ab_1(2,:)] =textread('20140623_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140623_sn2014ab_1(3,:)] =textread('20140623_sn2014ab_1.q.txt','%f%f','delimiter',' ');
[temp  d20140623_sn2014ab_1(4,:)] =textread('20140623_sn2014ab_1.u.txt','%f%f','delimiter',' ');
[temp  d20140623_sn2014ab_1(5,:)] =textread('20140623_sn2014ab_2.q.txt','%f%f','delimiter',' ');
[temp  d20140623_sn2014ab_1(6,:)] =textread('20140623_sn2014ab_2.u.txt','%f%f','delimiter',' ');

d20140623_SPOL_sn2014ab_1(1,:) =  d20140623_sn2014ab_1(1,(d20140623_sn2014ab_1(1,:) > 4000) & (d20140623_sn2014ab_1(1,:) < 7550));
d20140623_SPOL_sn2014ab_1(2,:) =  d20140623_sn2014ab_1(2,(d20140623_sn2014ab_1(1,:) > 4000) & (d20140623_sn2014ab_1(1,:) < 7550));
d20140623_SPOL_sn2014ab_1(3,:) =  d20140623_sn2014ab_1(3,(d20140623_sn2014ab_1(1,:) > 4000) & (d20140623_sn2014ab_1(1,:) < 7550));
d20140623_SPOL_sn2014ab_1(4,:) =  d20140623_sn2014ab_1(4,(d20140623_sn2014ab_1(1,:) > 4000) & (d20140623_sn2014ab_1(1,:) < 7550));
d20140623_SPOL_sn2014ab_1(5,:) =  d20140623_sn2014ab_1(5,(d20140623_sn2014ab_1(1,:) > 4000) & (d20140623_sn2014ab_1(1,:) < 7550));
d20140623_SPOL_sn2014ab_1(6,:) =  d20140623_sn2014ab_1(6,(d20140623_sn2014ab_1(1,:) > 4000) & (d20140623_sn2014ab_1(1,:) < 7550));

[d20140624_sn2014ab_1(1,:)  d20140624_sn2014ab_1(2,:)] =textread('20140624_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140624_sn2014ab_1(3,:)] =textread('20140624_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140624_sn2014ab_1(4,:)] =textread('20140624_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140624_SPOL_sn2014ab_1(1,:) =  d20140624_sn2014ab_1(1,(d20140624_sn2014ab_1(1,:) > 4000) & (d20140624_sn2014ab_1(1,:) < 7550));
d20140624_SPOL_sn2014ab_1(2,:) =  d20140624_sn2014ab_1(2,(d20140624_sn2014ab_1(1,:) > 4000) & (d20140624_sn2014ab_1(1,:) < 7550));
d20140624_SPOL_sn2014ab_1(3,:) =  d20140624_sn2014ab_1(3,(d20140624_sn2014ab_1(1,:) > 4000) & (d20140624_sn2014ab_1(1,:) < 7550));
d20140624_SPOL_sn2014ab_1(4,:) =  d20140624_sn2014ab_1(4,(d20140624_sn2014ab_1(1,:) > 4000) & (d20140624_sn2014ab_1(1,:) < 7550));

[d20140626_sn2014ab_1(1,:)  d20140626_sn2014ab_1(2,:)] =textread('20140626_sn2014ab.flxxx.txt','%f%f','delimiter',' ');
[temp  d20140626_sn2014ab_1(3,:)] =textread('20140626_sn2014ab.q.txt','%f%f','delimiter',' ');
[temp  d20140626_sn2014ab_1(4,:)] =textread('20140626_sn2014ab.u.txt','%f%f','delimiter',' ');

d20140626_SPOL_sn2014ab_1(1,:) =  d20140626_sn2014ab_1(1,(d20140626_sn2014ab_1(1,:) > 4000) & (d20140626_sn2014ab_1(1,:) < 7550));
d20140626_SPOL_sn2014ab_1(2,:) =  d20140626_sn2014ab_1(2,(d20140626_sn2014ab_1(1,:) > 4000) & (d20140626_sn2014ab_1(1,:) < 7550));
d20140626_SPOL_sn2014ab_1(3,:) =  d20140626_sn2014ab_1(3,(d20140626_sn2014ab_1(1,:) > 4000) & (d20140626_sn2014ab_1(1,:) < 7550));
d20140626_SPOL_sn2014ab_1(4,:) =  d20140626_sn2014ab_1(4,(d20140626_sn2014ab_1(1,:) > 4000) & (d20140626_sn2014ab_1(1,:) < 7550));

[d20140420_sn2014ab_2(1,:)  d20140420_sn2014ab_2(2,:)] =textread('MMT/SN2014ab_2014-04-20comb.flx.txt','%f%f','delimiter',' ');
[temp  d20140420_sn2014ab_2(3,:)] =textread('MMT/SN2014ab_2014-04-20comb.q.txt','%f%f','delimiter',' ');
[temp  d20140420_sn2014ab_2(4,:)] =textread('MMT/SN2014ab_2014-04-20comb.u.txt','%f%f','delimiter',' ');

d20140420_SPOL_sn2014ab_2(1,:) =  d20140420_sn2014ab_2(1,(d20140420_sn2014ab_2(1,:) > 4000) & (d20140420_sn2014ab_2(1,:) < 7550));
d20140420_SPOL_sn2014ab_2(2,:) =  d20140420_sn2014ab_2(2,(d20140420_sn2014ab_2(1,:) > 4000) & (d20140420_sn2014ab_2(1,:) < 7550));
d20140420_SPOL_sn2014ab_2(3,:) =  d20140420_sn2014ab_2(3,(d20140420_sn2014ab_2(1,:) > 4000) & (d20140420_sn2014ab_2(1,:) < 7550));
d20140420_SPOL_sn2014ab_2(4,:) =  d20140420_sn2014ab_2(4,(d20140420_sn2014ab_2(1,:) > 4000) & (d20140420_sn2014ab_2(1,:) < 7550));


%truncate ugly data
%temp1 = d20140526_sn2014ab_2(1,:);
%temp2 = d20140526_sn2014ab_2(2,:);
%clear d20140526_sn2014ab_2;
%d20140526_sn2014ab_2(2,:) = temp2(find(temp1>5500));
%d20140526_sn2014ab_2(1,:) = temp1(find(temp1>5500));





















temp1 = d20140507_sn2014ab_4(1,1:end);
temp2 = d20140507_sn2014ab_4(2,1:end);
clear d20140507_sn2014ab_4
d20140507_sn2014ab_4(1,:) = temp1;
d20140507_sn2014ab_4(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140519_sn2014ab_1(1,1:4088);
temp2 = d20140519_sn2014ab_1(2,1:4088);
clear d20140519_sn2014ab_1
d20140519_sn2014ab_1(1,:) = temp1;
d20140519_sn2014ab_1(2,:) = temp2;

%truncate floyds data
clear temp1 temp2;
temp1 = d20140408_sn2014ab_1(1,find(d20140408_sn2014ab_1(1,:)>5000,1,'first'):end)
temp2 = d20140408_sn2014ab_1(2,find(d20140408_sn2014ab_1(1,:)>5000,1,'first'):end)
clear d20140408_sn2014ab_1
d20140408_sn2014ab_1(1,:) = temp1;
d20140408_sn2014ab_1(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140409_sn2014ab_1(1,find(d20140409_sn2014ab_1(1,:)>5000,1,'first'):end)
temp2 = d20140409_sn2014ab_1(2,find(d20140409_sn2014ab_1(1,:)>5000,1,'first'):end)
clear d20140409_sn2014ab_1
d20140409_sn2014ab_1(1,:) = temp1;
d20140409_sn2014ab_1(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140411_sn2014ab_1(1,find(d20140411_sn2014ab_1(1,:)>5000,1,'first'):end)
temp2 = d20140411_sn2014ab_1(2,find(d20140411_sn2014ab_1(1,:)>5000,1,'first'):end)
clear d20140411_sn2014ab_1
d20140411_sn2014ab_1(1,:) = temp1;
d20140411_sn2014ab_1(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140507_sn2014ab_1(1,find(d20140507_sn2014ab_1(1,:)>4000,1,'first'):end)
temp2 = d20140507_sn2014ab_1(2,find(d20140507_sn2014ab_1(1,:)>4000,1,'first'):end)
clear d20140507_sn2014ab_1
d20140507_sn2014ab_1(1,:) = temp1;
d20140507_sn2014ab_1(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140507_sn2014ab_2(1,find(d20140507_sn2014ab_2(1,:)>4000,1,'first'):end)
temp2 = d20140507_sn2014ab_2(2,find(d20140507_sn2014ab_2(1,:)>4000,1,'first'):end)
clear d20140507_sn2014ab_2
d20140507_sn2014ab_2(1,:) = temp1;
d20140507_sn2014ab_2(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140507_sn2014ab_3(1,find(d20140507_sn2014ab_3(1,:)>4000,1,'first'):end)
temp2 = d20140507_sn2014ab_3(2,find(d20140507_sn2014ab_3(1,:)>4000,1,'first'):end)
clear d20140507_sn2014ab_3
d20140507_sn2014ab_3(1,:) = temp1;
d20140507_sn2014ab_3(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140420_sn2014ab_1(1,find(d20140420_sn2014ab_1(1,:)>4000,1,'first'):end)
temp2 = d20140420_sn2014ab_1(2,find(d20140420_sn2014ab_1(1,:)>4000,1,'first'):end)
clear d20140420_sn2014ab_1
d20140420_sn2014ab_1(1,:) = temp1;
d20140420_sn2014ab_1(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140423_sn2014ab_1(1,find(d20140423_sn2014ab_1(1,:)>4000,1,'first'):end)
temp2 = d20140423_sn2014ab_1(2,find(d20140423_sn2014ab_1(1,:)>4000,1,'first'):end)
clear d20140423_sn2014ab_1
d20140423_sn2014ab_1(1,:) = temp1;
d20140423_sn2014ab_1(2,:) = temp2;

clear temp1 temp2;
temp1 = d20140522_sn2014ab_1(1,find(d20140522_sn2014ab_1(1,:)>4000,1,'first'):end)
temp2 = d20140522_sn2014ab_1(2,find(d20140522_sn2014ab_1(1,:)>4000,1,'first'):end)
clear d20140522_sn2014ab_1
d20140522_sn2014ab_1(1,:) = temp1;
d20140522_sn2014ab_1(2,:) = temp2;

clf
plot(d20140507_sn2014ab_4(1,:),d20140507_sn2014ab_4(2,:))


%%%%%

%calculate relative dates
p20140310_sn2014ab_1(1,1) = round(juliandate(2014,03,10) - discoverydatejd_sn2014ab)
%p20140310_sn2014ab_2(1,1) = round(juliandate(2014,03,10) - discoverydatejd_sn2014ab)
p20140324_sn2014ab_1(1,1) = round(juliandate(2014,03,24) - discoverydatejd_sn2014ab)
p20140329_sn2014ab_1(1,1) = round(juliandate(2014,03,29) - discoverydatejd_sn2014ab)
p20140330_sn2014ab_1(1,1) = round(juliandate(2014,03,30) - discoverydatejd_sn2014ab)
p20140331_sn2014ab_1(1,1) = round(juliandate(2014,03,31) - discoverydatejd_sn2014ab)
p20140402_sn2014ab_1(1,1) = round(juliandate(2014,04,02) - discoverydatejd_sn2014ab)
p20140426_sn2014ab_1(1,1) = round(juliandate(2014,04,26) - discoverydatejd_sn2014ab)
p20140427_sn2014ab_1(1,1) = round(juliandate(2014,04,27) - discoverydatejd_sn2014ab)
p20140428_sn2014ab_1(1,1) = round(juliandate(2014,04,28) - discoverydatejd_sn2014ab)
p20140430_sn2014ab_1(1,1) = round(juliandate(2014,04,30) - discoverydatejd_sn2014ab)
p20140501_sn2014ab_1(1,1) = round(juliandate(2014,05,01) - discoverydatejd_sn2014ab)
p20140519_sn2014ab_1(1,1) = round(juliandate(2014,05,19) - discoverydatejd_sn2014ab)
p20140523_sn2014ab_1(1,1) = round(juliandate(2014,05,23) - discoverydatejd_sn2014ab)
p20140524_sn2014ab_1(1,1) = round(juliandate(2014,05,24) - discoverydatejd_sn2014ab)
p20140526_sn2014ab_1(1,1) = round(juliandate(2014,05,26) - discoverydatejd_sn2014ab)
p20140528_sn2014ab_1(1,1) = round(juliandate(2014,05,28) - discoverydatejd_sn2014ab)
p20140621_sn2014ab_1(1,1) = round(juliandate(2014,06,21) - discoverydatejd_sn2014ab)
p20140622_sn2014ab_1(1,1) = round(juliandate(2014,06,22) - discoverydatejd_sn2014ab)
p20140623_sn2014ab_1(1,1) = round(juliandate(2014,06,23) - discoverydatejd_sn2014ab)
p20140624_sn2014ab_1(1,1) = round(juliandate(2014,06,24) - discoverydatejd_sn2014ab)
p20140626_sn2014ab_1(1,1) = round(juliandate(2014,06,26) - discoverydatejd_sn2014ab)
p20140630_sn2014ab_1(1,1) = round(juliandate(2014,06,30) - discoverydatejd_sn2014ab)
p20140526_sn2014ab_2(1,:) = round(juliandate(2014,03,23) - discoverydatejd_sn2014ab)
%p20140526_sn2014ab_3(1,:) = round(juliandate(2014,05,26) - discoverydatejd_sn2014ab)
%p20140526_sn2014ab_4(1,:) = round(juliandate(2014,05,26) - discoverydatejd_sn2014ab)
p20140602_sn2014ab_1(1,:) = round(juliandate(2014,04,24) - discoverydatejd_sn2014ab)
%p20140602_sn2014ab_2(1,:) = round(juliandate(2014,06,02) - discoverydatejd_sn2014ab)
%p20140602_sn2014ab_3(1,:) = round(juliandate(2014,06,02) - discoverydatejd_sn2014ab)
p20140722_sn2014ab_1(1,:) = round(juliandate(2014,06,24) - discoverydatejd_sn2014ab)
%p20140722_sn2014ab_2(1,:) = round(juliandate(2014,07,22) - discoverydatejd_sn2014ab)
%p20140722_sn2014ab_3(1,:) = round(juliandate(2014,07,22) - discoverydatejd_sn2014ab)
p20140722_sn2014ab_4(1,:) = round(juliandate(2014,06,29) - discoverydatejd_sn2014ab)
%p20140722_sn2014ab_5(1,:) = round(juliandate(2014,07,22) - discoverydatejd_sn2014ab)
%p20140722_sn2014ab_6(1,:) = round(juliandate(2014,07,22) - discoverydatejd_sn2014ab)
p20140808_sn2014ab_1(1,:) = round(juliandate(2014,07,19) - discoverydatejd_sn2014ab)
%p20140808_sn2014ab_2(1,:) = round(juliandate(2014,08,08) - discoverydatejd_sn2014ab)
%p20140808_sn2014ab_3(1,:) = round(juliandate(2014,08,08) - discoverydatejd_sn2014ab)
p20140408_sn2014ab_1(1,:) = round(juliandate(2014,04,08) - discoverydatejd_sn2014ab)
p20140409_sn2014ab_1(1,:) = round(juliandate(2014,04,09) - discoverydatejd_sn2014ab)
p20140411_sn2014ab_1(1,:) = round(juliandate(2014,04,11) - discoverydatejd_sn2014ab)
p20140507_sn2014ab_4(1,:) = round(juliandate(2014,05,07) - discoverydatejd_sn2014ab)
%p20140507_sn2014ab_1(1,:) = round(juliandate(2014,05,07) - discoverydatejd_sn2014ab)
%p20140507_sn2014ab_2(1,:) = round(juliandate(2014,05,07) - discoverydatejd_sn2014ab)
%p20140507_sn2014ab_3(1,:) = round(juliandate(2014,05,07) - discoverydatejd_sn2014ab)
p20140420_sn2014ab_1(1,:) = round(juliandate(2014,04,20) - discoverydatejd_sn2014ab)
p20140420_sn2014ab_2(1,:) = round(juliandate(2014,04,20) - discoverydatejd_sn2014ab)
p20140423_sn2014ab_1(1,:) = round(juliandate(2014,04,23) - discoverydatejd_sn2014ab)
p20140522_sn2014ab_1(1,:) = round(juliandate(2014,05,22) - discoverydatejd_sn2014ab)
p20180414_sn2014ab_1(1,:) = round(juliandate(2018,04,14) - discoverydatejd_sn2014ab)

data.reldate(1 ) = p20140310_sn2014ab_1(1,1);
data.reldate(2 ) = p20140526_sn2014ab_2(1,1);
data.reldate(3 ) = p20140324_sn2014ab_1(1,1);
data.reldate(4 ) = p20140329_sn2014ab_1(1,1);
data.reldate(5 ) = p20140330_sn2014ab_1(1,1);
data.reldate(6 ) = p20140331_sn2014ab_1(1,1);
data.reldate(7 ) = p20140402_sn2014ab_1(1,1);
data.reldate(8 ) = p20140408_sn2014ab_1(1,:);
data.reldate(9 ) = p20140409_sn2014ab_1(1,:);
data.reldate(10) = p20140411_sn2014ab_1(1,:);
data.reldate(11) = p20140420_sn2014ab_2(1,:);
data.reldate(12) = p20140420_sn2014ab_1(1,:);
data.reldate(13) = p20140423_sn2014ab_1(1,:);
data.reldate(14) = p20140602_sn2014ab_1(1,:);
data.reldate(15) = p20140426_sn2014ab_1(1,1);
data.reldate(16) = p20140427_sn2014ab_1(1,1);
data.reldate(17) = p20140428_sn2014ab_1(1,1);
data.reldate(18) = p20140430_sn2014ab_1(1,1);
data.reldate(19) = p20140501_sn2014ab_1(1,1);
data.reldate(20) = p20140507_sn2014ab_4(1,:);
data.reldate(21) = p20140519_sn2014ab_1(1,1);
data.reldate(22) = p20140522_sn2014ab_1(1,:);
data.reldate(23) = p20140523_sn2014ab_1(1,1);
data.reldate(24) = p20140524_sn2014ab_1(1,1);
data.reldate(25) = p20140526_sn2014ab_1(1,1);
data.reldate(26) = p20140528_sn2014ab_1(1,1);
data.reldate(27) = p20140621_sn2014ab_1(1,1);
data.reldate(28) = p20140622_sn2014ab_1(1,1);
data.reldate(29) = p20140623_sn2014ab_1(1,1);
data.reldate(30) = p20140624_sn2014ab_1(1,1);
data.reldate(31) = p20140722_sn2014ab_1(1,1);
data.reldate(32) = p20140626_sn2014ab_1(1,1);
data.reldate(33) = p20140722_sn2014ab_4(1,1);
data.reldate(34) = p20140630_sn2014ab_1(1,1);
data.reldate(35) = p20140808_sn2014ab_1(1,:);
data.reldate(36) = p20180414_sn2014ab_1(1,:);

data.ymd{1 } = '20140310';
data.ymd{2 } = '20140323';
data.ymd{3 } = '20140324';
data.ymd{4 } = '20140329';
data.ymd{5 } = '20140330';
data.ymd{6 } = '20140331';
data.ymd{7 } = '20140402';
data.ymd{8 } = '20140408';
data.ymd{9 } = '20140409';
data.ymd{10} = '20140411';
data.ymd{11} = '20140420';
data.ymd{12} = '20140420';
data.ymd{13} = '20140423';
data.ymd{14} = '20140424';
data.ymd{15} = '20140426';
data.ymd{16} = '20140427';
data.ymd{17} = '20140428';
data.ymd{18} = '20140430';
data.ymd{19} = '20140501';
data.ymd{20} = '20140507';
data.ymd{21} = '20140519';
data.ymd{22} = '20140522';
data.ymd{23} = '20140523';
data.ymd{24} = '20140524';
data.ymd{25} = '20140526';
data.ymd{26} = '20140528';
data.ymd{27} = '20140621';
data.ymd{28} = '20140622';
data.ymd{29} = '20140623';
data.ymd{30} = '20140624';
data.ymd{31} = '20140624';
data.ymd{32} = '20140626';
data.ymd{33} = '20140629';
data.ymd{34} = '20140630';
data.ymd{35} = '20140719';
data.ymd{36} = '20180414';

%deredshift
data.wave_dez{1 } =  d20140310_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{2 } =  d20140526_sn2014ab_2(1,:)/(1+z_sn2014ab);
data.wave_dez{3 } =  d20140324_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{4 } =  d20140329_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{5 } =  d20140330_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{6 } =  d20140331_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{7 } =  d20140402_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{8 } =  d20140408_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{9 } =  d20140409_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{10} =  d20140411_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{11} =  d20140420_SPOL_sn2014ab_2(1,:)/(1+z_sn2014ab);
data.wave_dez{12} =  d20140420_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{13} =  d20140423_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{14} =  d20140602_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{15} =  d20140426_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{16} =  d20140427_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{17} =  d20140428_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{18} =  d20140430_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{19} =  d20140501_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{20} =  d20140507_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{21} =  d20140519_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{22} =  d20140522_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{23} =  d20140523_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{24} =  d20140524_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{25} =  d20140526_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{26} =  d20140528_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{27} =  d20140621_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{28} =  d20140622_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{29} =  d20140623_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{30} =  d20140624_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{31} =  d20140722_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{32} =  d20140626_SPOL_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{33} =  d20140722_sn2014ab_4(1,:)/(1+z_sn2014ab);
data.wave_dez{34} =  d20140630_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{35} =  d20140808_sn2014ab_1(1,:)/(1+z_sn2014ab);
data.wave_dez{36} =  d20180414_sn2014ab_1(1,:)/(1+z_sn2014ab);

data.flux{1 } =  d20140310_sn2014ab_1(2,:)
data.flux{2 } =  d20140526_sn2014ab_2(2,:)
data.flux{3 } =  d20140324_sn2014ab_1(2,:)
data.flux{4 } =  d20140329_SPOL_sn2014ab_1(2,:)
data.flux{5 } =  d20140330_SPOL_sn2014ab_1(2,:)
data.flux{6 } =  d20140331_SPOL_sn2014ab_1(2,:)
data.flux{7 } =  d20140402_SPOL_sn2014ab_1(2,:)
data.flux{8 } =  d20140408_sn2014ab_1(2,:)
data.flux{9 } =  d20140409_sn2014ab_1(2,:)
data.flux{10} =  d20140411_sn2014ab_1(2,:)
data.flux{11} =  d20140420_SPOL_sn2014ab_2(2,:)
data.flux{12} =  d20140420_sn2014ab_1(2,:)
data.flux{13} =  d20140423_sn2014ab_1(2,:)
data.flux{14} =  d20140602_sn2014ab_1(2,:)
data.flux{15} =  d20140426_SPOL_sn2014ab_1(2,:)
data.flux{16} =  d20140427_SPOL_sn2014ab_1(2,:)
data.flux{17} =  d20140428_SPOL_sn2014ab_1(2,:)
data.flux{18} =  d20140430_sn2014ab_1(2,:)
data.flux{19} =  d20140501_SPOL_sn2014ab_1(2,:)
data.flux{20} =  d20140507_sn2014ab_1(2,:)
data.flux{21} =  d20140519_sn2014ab_1(2,:)
data.flux{22} =  d20140522_sn2014ab_1(2,:)
data.flux{23} =  d20140523_SPOL_sn2014ab_1(2,:)
data.flux{24} =  d20140524_SPOL_sn2014ab_1(2,:)
data.flux{25} =  d20140526_SPOL_sn2014ab_1(2,:)
data.flux{26} =  d20140528_sn2014ab_1(2,:)
data.flux{27} =  d20140621_sn2014ab_1(2,:)
data.flux{28} =  d20140622_SPOL_sn2014ab_1(2,:)
data.flux{29} =  d20140623_SPOL_sn2014ab_1(2,:)
data.flux{30} =  d20140624_SPOL_sn2014ab_1(2,:)
data.flux{31} =  d20140722_sn2014ab_1(2,:)
data.flux{32} =  d20140626_SPOL_sn2014ab_1(2,:)
data.flux{33} =  d20140722_sn2014ab_4(2,:)
data.flux{34} =  d20140630_sn2014ab_1(2,:)
data.flux{35} =  d20140808_sn2014ab_1(2,:)
data.flux{36} =  d20180414_sn2014ab_1(2,:)

data.epochs(1 ) = 1;
data.epochs(2 ) = 2;
data.epochs(3 ) = 3;
data.epochs(4 ) = 4;
data.epochs(5 ) = 4;
data.epochs(6 ) = 4;
data.epochs(7 ) = 4;
data.epochs(8 ) = 5;
data.epochs(9 ) = 5;
data.epochs(10) = 5;
data.epochs(11) = 6;
data.epochs(12) = 7;
data.epochs(13) = 6;
data.epochs(14) = 8;
data.epochs(15) = 9;
data.epochs(16) = 9;
data.epochs(17) = 9;
data.epochs(18) = 10;
data.epochs(19) = 9;
data.epochs(20) = 11;
data.epochs(21) = 12;
data.epochs(22) = 13;
data.epochs(23) = 14;
data.epochs(24) = 14;
data.epochs(25) = 14;
data.epochs(26) = 15;
data.epochs(27) = 16;
data.epochs(28) = 17;
data.epochs(29) = 17;
data.epochs(30) = 17;
data.epochs(31) = 18;
data.epochs(32) = 17;
data.epochs(33) = 19;
data.epochs(34) = 20;
data.epochs(35) = 21;
data.epochs(36) = 22;


data.name{1 } = 'NTT/EFOSC2';
data.name{2 } = 'VLT/X-shooter';
data.name{3 } = 'Lick/Kast';
data.name{4 } = 'Bok/SPOL';
data.name{5 } = 'Bok/SPOL';
data.name{6 } = 'Bok/SPOL';
data.name{7 } = 'Bok/SPOL';
data.name{8 } = 'LCO/FLOYDS';
data.name{9 } = 'LCO/FLOYDS';
data.name{10} = 'LCO/FLOYDS';
data.name{11} = 'LCO/FLOYDS';
data.name{12} = 'MMT/SPOL';
data.name{13} = 'LCO/FLOYDS';
data.name{14} = 'VLT/X-shooter';
data.name{15} = 'Kuiper/SPOL';
data.name{16} = 'Kuiper/SPOL';
data.name{17} = 'Kuiper/SPOL';
data.name{18} = 'Lick/Kast';
data.name{19} = 'Kuiper/SPOL';
data.name{20} = 'LCO/FLOYDS';
data.name{21} = 'Magellan/IMACS';
data.name{22} = 'LCO/FLOYDS';
data.name{23} = 'Bok/SPOL';
data.name{24} = 'Bok/SPOL';
data.name{25} = 'Bok/SPOL';
data.name{26} = 'Lick/Kast';
data.name{27} = 'Lick/Kast';
data.name{28} = 'Kuiper/SPOL';
data.name{29} = 'Kuiper/SPOL';
data.name{30} = 'Kuiper/SPOL';
data.name{31} = 'VLT/X-shooter';
data.name{32} = 'Kuiper/SPOL';
data.name{33} = 'VLT/X-shooter';
data.name{34} = 'Lick/Kast';
data.name{35} = 'VLT/X-shooter';
data.name{36} = 'MMT/BC';

goodplotcolors = [
[0.0000 0.3922 0.0039]
[0.0000 0.0000 1.0000]
[1.0000 0.0000 0.0000]
[0.5843 0.0000 0.2275]
[0.5686 0.8157 0.7961]
[0.0000 0.7255 0.0902]
[0.4941 0.1765 0.8235]
[1.0000 0.0000 0.9647]
[0.9961 0.5373 0.0000]
];

for i=1:size(data.reldate,2)
	data.flux_deredMW{i} = deredden(data.wave_dez{i},data.flux{i},A_V_sn2014ab);
end

%[bbodyfit11 , wavetemp11  ,bestT(1 ,1), bestalpha(1 ,1)] = blackbodyfit(d20140310_sn2014ab_1(1,:),contscaled20140310_sn2014ab_1(2,:),3000,6400)
%[bbodyfit11 , wavetemp11  ,bestT(1 ,1), bestalpha(1 ,1)] = blackbodyfit(data.wave_dez{1},data.flux_contscale{1},'test1again')
%[bbodyfit22 , wavetemp22  ,bestT(2 ,2), bestalpha(2 ,2)] = blackbodyfit(data.wave_dez{2},data.flux_contscale{2},'test2')
%[bbodyfit33 , wavetemp33  ,bestT(3 ,3), bestalpha(3 ,3)] = blackbodyfit(data.wave_dez{3},data.flux_contscale{3},'test3')



%align highres spectrum to fit the NaID profile before correcting for it for all the data sets
%NaIDestimate_flux_norm_cont_halpha = estimate_cont_halpha(data.wave_dez{24},data.flux_deredMW{24});
%NaIDestimate_align_halpha.multiplier = measure_peaks_halpha(data.wave_dez{24},NaIDestimate_flux_norm_cont_halpha);
%NaIDestimate_wave = data.wave_dez{24}*NaIDestimate_align_halpha.multiplier.highres;
%measureNaID(NaIDestimate_wave,data.flux_deredMW{24},A_V_sn2014ab,(1+z_sn2014ab)/(NaIDestimate_align_halpha.multiplier.highres)) 

NaIDestimate_flux_norm_cont_halpha = estimate_cont_halpha(data.wave_dez{2},data.flux_deredMW{2});
NaIDestimate_align_halpha.multiplier = measure_peaks_halpha(data.wave_dez{2},NaIDestimate_flux_norm_cont_halpha);
NaIDestimate_wave = data.wave_dez{2}*NaIDestimate_align_halpha.multiplier.highres;
measureNaID(NaIDestimate_wave,data.flux_deredMW{2},A_V_sn2014ab,(1+z_sn2014ab)/(NaIDestimate_align_halpha.multiplier.highres)) 


%offset to naID from narrow aligned spectrum
%5891 is absorption minimum compared to 5889.95, so
%    10^-5 .* c.* (5891 - 5889.95)/5889.95 = 53.4809 km/s redshifted NaID compared to the narrow Halpha emission

%LIGHT CURVE STUFF BEGINS
%OTHER SN DATA
%SN 2010jl
z_sn2010jl = 0.010697;
discoverydatejd_SN2010jl       = juliandate(2010,11,02.06       );

%Spectrum
[d_sn2010jl(1,:) d_sn2010jl(2,:) d_sn2010jl(3,:)] =textread('Hrenorm_sn2010jl-110406.dat','%f%f%f','delimiter',' ');
p_sn2010jl(1,:) = d_sn2010jl(1,:)./(1+z_sn2010jl);

[d20110102_sn2010jl(1,:) d20110102_sn2010jl(2,:)] = textread('2010jlspectra/2011jan02_sn2010jl.flx.txt','%f%f','delimiter',' ');
p20110102_sn2010jl(1,:) = d20110102_sn2010jl(1,:)/(1+z_sn2010jl);

%Lick SPOL (to compare Ca II region of line)
[d20110103_sn2010jl(1,:) d20110103_sn2010jl(2,:) cp cp cp cp cp cp cp cp] = textread('lick\sn2010jl_kast_20110103_specpol.txt','%f%f%f%f%f%f%f%f%f%f','delimiter',' ');
p20110103_sn2010jl(1,:) = d20110103_sn2010jl(1,:)/(1+z_sn2010jl);

[d20110125_sn2010jl(1,:) d20110125_sn2010jl(2,:) cp cp cp cp cp cp cp cp] = textread('lick\sn2010jl_kast_20110125_specpol.txt','%f%f%f%f%f%f%f%f%f%f','delimiter',' ');
p20110125_sn2010jl(1,:) = d20110125_sn2010jl(1,:)/(1+z_sn2010jl);

[d20110201_sn2010jl(1,:) d20110201_sn2010jl(2,:) cp cp cp cp cp cp cp cp] = textread('lick\sn2010jl_kast_20110201_specpol.txt','%f%f%f%f%f%f%f%f%f%f','delimiter',' ');
p20110201_sn2010jl(1,:) = d20110201_sn2010jl(1,:)/(1+z_sn2010jl);

[d20110209_sn2010jl(1,:) d20110209_sn2010jl(2,:) d20110209_sn2010jl(3,:)] = textread('2010jlspectra\sn2010jl-20110209.482-ui.flm','%f%f%f','delimiter',' ');
p20110209_sn2010jl(1,:) = d20110209_sn2010jl(1,:)/(1+z_sn2010jl);

juliandate(2011,02,09) - discoverydatejd_SN2010jl 
juliandate(2011,02,01) - discoverydatejd_SN2010jl 


%Light curve
fid   = fopen('sn2010jl_phot_fransson.txt');
LCsn2010jlscan =  textscan(fid,'%f%f%f%f%f%f%f%f%f%f%f%f%s%s','delimiter',' ','headerlines',1);
fclose(fid);

for i = 1:size(LCsn2010jlscan,2)-2
	LCsn2010jl(i,:) = LCsn2010jlscan{1,i};
end

LCsn2010jl(LCsn2010jl == 0) = NaN

uprime_ind_sn2010jl = ~isnan(LCsn2010jl(3,:));
LCsn2010jl_uprime_epoch = LCsn2010jl(2,uprime_ind_sn2010jl);
LCsn2010jl_uprime_appmags = LCsn2010jl(3,uprime_ind_sn2010jl);
LCsn2010jl_uprime_appmagserr = LCsn2010jl(4,uprime_ind_sn2010jl);

B_ind_sn2010jl = ~isnan(LCsn2010jl(5,:));
LCsn2010jl_B_epoch = LCsn2010jl(2,B_ind_sn2010jl);
LCsn2010jl_B_appmags = LCsn2010jl(5,B_ind_sn2010jl);
LCsn2010jl_B_appmagserr = LCsn2010jl(6,B_ind_sn2010jl);

V_ind_sn2010jl = ~isnan(LCsn2010jl(7,:));
LCsn2010jl_V_epoch = LCsn2010jl(2,V_ind_sn2010jl);
LCsn2010jl_V_appmags = LCsn2010jl(7,V_ind_sn2010jl);
LCsn2010jl_V_appmagserr = LCsn2010jl(8,V_ind_sn2010jl);

rprime_ind_sn2010jl = ~isnan(LCsn2010jl(9,:));
LCsn2010jl_rprime_epoch = LCsn2010jl(2,rprime_ind_sn2010jl);
LCsn2010jl_rprime_appmags = LCsn2010jl(9,rprime_ind_sn2010jl);
LCsn2010jl_rprime_appmagserr = LCsn2010jl(10,rprime_ind_sn2010jl);

iprime_ind_sn2010jl = ~isnan(LCsn2010jl(11,:));
LCsn2010jl_iprime_epoch = LCsn2010jl(2,iprime_ind_sn2010jl);
LCsn2010jl_iprime_appmags = LCsn2010jl(11,iprime_ind_sn2010jl);
LCsn2010jl_iprime_appmagserr = LCsn2010jl(12,iprime_ind_sn2010jl);

[LC1999em(1,:) LC1999em(2,:) LC1999em(3,:) LC1999em(4,:) LC1999em(5,:)] = textread('SN1999emLC.txt','%f%f%f%f%f','delimiter',' ');
[LC1998S(1,:) LC1998S(2,:) LC1998S(3,:)] = textread('SN1998SLC_R.txt','%f%f%f','delimiter',' ');
[LC2003hf(1,:) LC2003hf(2,:) LC2003hf(3,:) LC2003hf(4,:) LC2003hf(5,:) LC2003hf(6,:) LC2003hf(7,:) LC2003hf(8,:) LC2003hf(9,:) LC2003hf(10,:)] = textread('sn03hf-faran.txt','%f%f%f%f%f%f%f%f%f%f','delimiter',' ');


redshiftdistance1999em = 8.2;
redshiftdistancemodulus1999em = -5*(log10(8.2*10^6)-1);
A_R1999em= 3.1 * 0.04;
z1999em = 0.002392;

distance1998S = 15.612;
distancemodulus1998S = -5*(log10(distance1998S*10^6)-1);
A_R1998S= 3.1 * 0.050;
E_BmVgal1998S = 0.20;
A_R1998Sgal = 0.5189;

distance2010jl = 48.8;
distancemodulus2010jl = -5*(log10(distance2010jl*10^6)-1);
A_R2010jl = 0.059;
A_V2010jl = 0.075;
z2010jl = 0.010697;

redshiftdistance2003hf = 127.7;
redshiftdistancemodulus2003hf = -5*(log10(redshiftdistance2003hf*10^6)-1);
A_R2003hf = 0.047;
A_V2003hf = 0.060;
z2003hf = 0.031302;

LC1999emmjd = juliandate(LC1999em(3,:),LC1999em(1,:),LC1999em(2,:))-2400000.5;
peakdate1999em = LC1999emmjd(min(find(LC1999em(4,:)==min(LC1999em(4,:)))));
LC1999emabsmag = LC1999em(4,:)+redshiftdistancemodulus1999em-A_R1999em;

LC1998Smjd = LC1998S(1,:)+2450000-2400000.5;
peakdate1998S = LC1998Smjd(min(find(LC1998S(2,:)==min(LC1998S(2,:)))));
LC1998Sabsmag = LC1998S(2,:)+distancemodulus1998S-A_R1998S-A_R1998Sgal;

LC2003hfmjd = LC2003hf(1,:);
peakdate2003hf = 52863;
LC2003hfabsmag = LC2003hf(7,:)+redshiftdistancemodulus2003hf-A_R2003hf;

LC2010jlabsmagR = LCsn2010jl_rprime_appmags+distancemodulus2010jl-A_R2010jl;



%apply known milky way reddening, fix narrow lines, then measure the NaID, then apply NaID and adjust the narrow line offset
%with narrow line offset first, then apply a new narrow line correction after applying this new reddening
%A_V_NaID = 0.2147;
%A_R_NaID = 0.1738;
%A_I_NaID = 0.1284;
%A_B_NaID = 0.2813;
%A_V_NaID = 0.2314;
%A_R_NaID = 0.1873;
%A_I_NaID = 0.1384;
%A_B_NaID = 0.3032;
A_V_NaID = 0.1756;
A_R_NaID = 0.1422;
A_I_NaID = 0.1050;
A_B_NaID = 0.2300;


%if no narrow line offset
%A_V_NaID = 0.3297;
%A_R_NaID = 0.2669;
%A_I_NaID = 0.1969;
%A_B_NaID = 0.4315;

%new light curve
[LCsn2014ab(1,:) LCsn2014ab(2,:) LCsn2014ab(3,:) LCsn2014ab(4,:) LCsn2014ab(5,:) LCsn2014ab(6,:) LCsn2014ab(7,:) LCsn2014ab(8,:) LCsn2014ab(9,:) LCsn2014ab(10,:) LCsn2014ab(11,:)] = textread('lightcurve_sn2014ab_nickel_standard_table_readable.dat','%f%f%f%f%f%f%f%f%f%f%f','delimiter',',');

for i=1:size(LCsn2014ab,1)
	for j=1:size(LCsn2014ab,2)
		if(LCsn2014ab(i,j) == 0)
			LCsn2014ab(i,j) = NaN;
		end
	end
end

%CSS light curve 
[LCCSSsn2014abunsort(1,:) LCCSSsn2014abunsort(2,:) LCCSSsn2014abunsort(3,:) LCCSSsn2014abunsort(4,:) LCCSSsn2014abunsort(5,:) LCCSSsn2014abunsort(6,:) LCCSSsn2014abunsort(7,:)] = textread('CSS2014abLightCurve_fromresultweb.txt','%f%f%f%f%f%f%f','delimiter',',');
[CSSsortdate, CSSsortdateindex] = sort(LCCSSsn2014abunsort(6,:));
for i=1:7
	LCCSSsn2014ab(i,:) = LCCSSsn2014abunsort(i,CSSsortdateindex);
end

%convert to absolute magnitude and remove MW extinction and remove NaID extinction
absmagB_sn2014ab = LCsn2014ab(4,:) +redshiftdistancemodulus_2014ab-A_B_sn2014ab-A_B_NaID;
absmagV_sn2014ab = LCsn2014ab(6,:) +redshiftdistancemodulus_2014ab-A_V_sn2014ab-A_V_NaID;
absmagR_sn2014ab = LCsn2014ab(8,:) +redshiftdistancemodulus_2014ab-A_R_sn2014ab-A_R_NaID;
absmagI_sn2014ab = LCsn2014ab(10,:)+redshiftdistancemodulus_2014ab-A_I_sn2014ab-A_I_NaID;
absmagVCSS_sn2014ab = LCCSSsn2014ab(2,:)+redshiftdistancemodulus_2014ab-A_V_sn2014ab-A_V_NaID;

magerrorB_sn2014ab= LCsn2014ab(5,:);
magerrorV_sn2014ab= LCsn2014ab(7,:);
magerrorR_sn2014ab= LCsn2014ab(9,:);
magerrorI_sn2014ab= LCsn2014ab(11,:);
magerrorVCSS_sn2014ab = LCCSSsn2014ab(3,:);

LCreldateB_sn2014ab= LCsn2014ab(2,:) - discoverydatemjd;
LCreldateV_sn2014ab= LCsn2014ab(2,:) - discoverydatemjd;
LCreldateR_sn2014ab= LCsn2014ab(2,:) - discoverydatemjd;
LCreldateI_sn2014ab= LCsn2014ab(2,:) - discoverydatemjd;
LCCSSreldateV_sn2014ab = LCCSSsn2014ab(6,:) - discoverydatemjd;

%CSS
%day -56 (using old relative dates
(absmagVCSS_sn2014ab(342)+absmagVCSS_sn2014ab(343)+absmagVCSS_sn2014ab(344)+absmagVCSS_sn2014ab(345))/4
%day 18
(absmagVCSS_sn2014ab(350)+absmagVCSS_sn2014ab(351)+absmagVCSS_sn2014ab(352)+absmagVCSS_sn2014ab(353))/4

%day 114
(absmagVCSS_sn2014ab(374)+absmagVCSS_sn2014ab(375)+absmagVCSS_sn2014ab(376)+absmagVCSS_sn2014ab(377))/4



%change if we change the reldate system
%adjusted for the change
medianCSSfluxwithnoSN = median(10.^(absmagVCSS_sn2014ab(find( (LCCSSreldateV_sn2014ab<-25) | (LCCSSreldateV_sn2014ab>250) ))./-2.5))
medianCSSmagwithnoSN = -2.5*log10(median(10.^(absmagVCSS_sn2014ab(find( (LCCSSreldateV_sn2014ab<-25) | (LCCSSreldateV_sn2014ab>250) ))./-2.5)))
absmagVCSS_sn2014ab_mediansubtracted = -2.5.*log10(10.^(absmagVCSS_sn2014ab./-2.5) - medianCSSfluxwithnoSN);


(absmagVCSS_sn2014ab_mediansubtracted(374)+absmagVCSS_sn2014ab_mediansubtracted(375)+absmagVCSS_sn2014ab_mediansubtracted(376)+absmagVCSS_sn2014ab_mediansubtracted(377))/4

%this is peak value quoted in abstract
min(real(absmagVCSS_sn2014ab_mediansubtracted))
min(real(absmagVCSS_sn2014ab_mediansubtracted))-(redshiftdistancemodulus_2014ab-A_V_sn2014ab-A_V_NaID)
%and its corresponding date
LCCSSreldateV_sn2014ab(find(min(real(absmagVCSS_sn2014ab_mediansubtracted)) == real(absmagVCSS_sn2014ab_mediansubtracted)))


%discovery value converted
16.4 +redshiftdistancemodulus_2014ab-A_V_sn2014ab-A_V_NaID

%LIGHT CURVE STUFF ENDS


for i=1:size(data.reldate,2)
i
	data.flux_deredMWHG{i} = deredden(data.wave_dez{i},data.flux{i},A_V_sn2014ab + A_V_NaID);
	data.flux_contscale{i} = data.flux_deredMWHG{i}(1,:)/max(data.flux_deredMWHG{i}(find((data.wave_dez{i} < 9000)&(data.wave_dez{i} > 5000))));
end

epoch_flux = [];
for i=1:max(data.epochs)
	clear epoch_flux
	epochcomb_index = find((data.epochs == i));

	data.epoch_name{i} = data.name{epochcomb_index(1)};
	data.epoch_color{i} = goodplotcolors(strcmp(data.epoch_name{i},unique(data.name)),:);
	data.epoch_wave{i} = data.wave_dez_aligned_halpha{epochcomb_index(1)};

	if (size(epochcomb_index,2) == 1)
		data.epoch_flux{i} = data.flux_contscale{epochcomb_index(1)};
		data.epoch_day{i} = ['day ' num2str(data.reldate(epochcomb_index(1)))];
	else
		j = size(epochcomb_index,2);
		while (j > 1)
			epoch_flux(j,:) = interp1(data.wave_dez_aligned_halpha{epochcomb_index(j)},data.flux_contscale{epochcomb_index(j)},data.wave_dez_aligned_halpha{epochcomb_index(1)});
			j = j-1;
		end
		epoch_flux(1,:) =  data.flux_contscale{epochcomb_index(1)};
		data.epoch_flux{i} = median(epoch_flux);
		data.epoch_day{i} = ['days ' num2str(data.reldate(epochcomb_index(1))) '-' num2str(data.reldate(epochcomb_index(end)))];
	end
end

set(plotting,'units','normalized','outerposition',[0 0 0.8 1]);
clf
for i = 1:size(data.epoch_flux,2)
	logplot(i) = semilogy(data.epoch_wave{i},data.epoch_flux{i} * 6^(-i),'LineWidth',2,'Color',data.epoch_color{i})
	hold on
	if (i==2)
		htext = text(6950,0.2*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==5)
		htext = text(6950,0.4*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==7)
		htext = text(6950,0.5*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==9)
		htext = text(6950,0.44*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==10)
		htext = text(6950,0.48*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==11)
		htext = text(6950,0.45*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==13)
		htext = text(6950,0.35*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==14)
		htext = text(6950,0.6*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==15)
		htext = text(6950,0.75*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==16)
		htext = text(6950,0.5*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==17)
		htext = text(6950,0.51*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==18)
		htext = text(6950,0.35*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==19)
		htext = text(6950,0.37*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==20)
		htext = text(6950,0.58*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	elseif(i==21)
		htext = text(6950,0.43*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	else
		htext = text(6950,0.3*6^(-i*1.04),data.epoch_day{i},'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',data.epoch_color{i})
	end
end


line([4101 4101],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([4340 4340],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([4861 4861],[0.55 0.85],'LineStyle','-','Color',[0 0 0])
line([4959 4959],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([5007 5007],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([5876 5876],[0.2 0.35],'LineStyle','-','Color',[0 0 0])
line([5896 5896],[0.2 0.35],'LineStyle','-','Color',[0 0 0])
line([6562.81 6562.81],[1.3 2.3],'LineStyle','-','Color',[0 0 0])
htext = text(4101,0.9,'H\delta','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(4340,0.9,'H\gamma','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(4861,0.95,'H\beta','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(4983,0.9,'[OIII]','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(5876-22,0.4,'HeI\lambda5876','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(5896+22,0.4,'NaID','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(6562.81,2.5,'H\alpha','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(6754,0.22,'$\bigoplus$','interpreter','latex','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',12)
htext = text(7430,0.22,'$\bigoplus$','interpreter','latex','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',12)
htext = text(7050,5,'SN 2014ab','interpreter','latex','FontName','CMU Serif')
set(htext, 'Color', 'black')	
set(htext, 'FontSize',26)
set(htext, 'Color',[0 0 0])


xlabel('Rest Wavelength ($\rm{\AA}$) ','interpreter','latex','FontSize',24,'FontName','CMU Serif Roman')
ylabel('$F_\lambda$ (Scaled)','interpreter','latex','FontSize',24,'FontName','CMU Serif Roman')
axis([[3400 10000] [10^-19*2 250]])
ax1 = gca;
ax2 = axes('Position',get(ax1,'Position'),'YAxisLocation','right','XAxisLocation','top','Color','none');
ylabel(ax2,'','FontSize',22)
xlabel(ax2,'')
set(ax2,'xtick',[],'YTick',[])
set(ax1,'FontSize',22)
set(ax2,'FontSize',22)
set(ax1,'XMinorTick','on','YMinorTick','on')
legend([logplot(1), logplot(2), logplot(3), logplot(4), logplot(5), logplot(7), logplot(9), logplot(12), logplot(22)],[data.epoch_name(1), data.epoch_name(2), data.epoch_name(3), data.epoch_name(4), data.epoch_name(5), data.epoch_name(7), data.epoch_name(9), data.epoch_name(12), data.epoch_name(22)])

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\FullSpectrum.pdf


%spectral resolution calculations
%MMT Blue Channel
% 5584- 6858
((6858-5584)/2+5584)/0.476177503771396 
%magellan
% 5472- 7022
((7022-5472)/2+5472)/0.3794
%%%need to do SPOL resolution calculation here for day 99 2014-04-20 (done here actually now)
% 3909- 9086
((9086-3909)/2+3909)/1.695247815499897
%but from MMT log, and using http://james.as.arizona.edu/~psmith/SPOL/gratings.html I get
3 * 5.2 * 2.62 * 0.76


%various continuum fitting regions
%halpha continuum
%%%
%trying new estimate_cont_halpha code

for i=1:size(data.wave_dez,2)
	data.flux_norm_cont_halpha{i} = estimate_cont_halpha(data.wave_dez{i},data.flux_deredMWHG{i});
	data.align_halpha.multiplier{i} = measure_peaks_halpha(data.wave_dez{i},data.flux_norm_cont_halpha{i});
end




for i=1:size(data.wave_dez,2)
	if(max(data.wave_dez{i})>12000)
		data.flux_norm_cont_paschenbeta{i} = estimate_cont_paschenbeta(data.wave_dez{i},data.flux_deredMWHG{i});
	else
		data.flux_norm_cont_paschenbeta{i} = NaN;
	end
end


%saved workspace up to this point

%[bbodyfit11 , wavetemp11  ,bestT(1 ,1), bestalpha(1 ,1)] = blackbodyfit(d20140310_sn2014ab_1(1,:),contscaled20140310_sn2014ab_1(2,:),3000,6400)

data.wave_dez_aligned_halpha = align_halpha(data.wave_dez,data.align_halpha.multiplier,data.reldate)



%find min and max wavelengths for table
wavelengthfilenew = fopen('spectralwavelengthsnew_real.txt','w');
for i=1:size(data.wave_dez,2)
	fprintf(wavelengthfilenew,'%5.0f',data.wave_dez{i}(1));
	fprintf(wavelengthfilenew,'-');
	fprintf(wavelengthfilenew,'%5.0f',data.wave_dez{i}(end));
	fprintf(wavelengthfilenew,'\n');
end
fclose(wavelengthfilenew);

%find min and max wavelengths for table
wavelengthfilenew_aligned = fopen('spectralwavelengthsnew_real_aligned.txt','w');
for i=1:size(data.wave_dez_aligned_halpha,2)
	fprintf(wavelengthfilenew_aligned,'%5.0f',data.wave_dez_aligned_halpha{i}(1));
	fprintf(wavelengthfilenew_aligned,'-');
	fprintf(wavelengthfilenew_aligned,'%5.0f',data.wave_dez_aligned_halpha{i}(end));
	fprintf(wavelengthfilenew_aligned,'\n');
end
fclose(wavelengthfilenew_aligned);


%%test alignment plot
%testfigure = figure;
%hold all
%axis([[6450 6650] [0 15]])
%for i=1:size(data.wave_dez_aligned_halpha,2)
%	plot(data.wave_dez_aligned_halpha{i},data.flux_norm_cont_halpha{i});
%	pause(0.2);
%end
%close(testfigure)
%
%
%testfigure = figure;
%hold all
%axis([[4000 7000] [0 15]])
%for i=1:size(data.wave_dez_aligned_halpha,2)
%	plot(data.wave_dez_aligned_halpha{i},data.flux_norm_cont_halpha{i});
%	pause(0.5);
%end
%close(testfigure)




%try to use blackbody fit instead of continuum across regions?
%[bbodyfit11 , wavetemp11  ,bestT(1 ,1), bestalpha(1 ,1)] = blackbodyfit(d20140310_sn2014ab_1(1,:),contscaled20140310_sn2014ab_1(2,:),3000,6400)



%axis conversion to velocity relative to Halpha
%velocity in km/s
lambdaHalpha = 6562.81;
lambdaHbeta = 4861.363;
lambdaNaID1= 5889.950;
lambdaNaID2= 5895.924;
lambdaNaID = (lambdaNaID1 + lambdaNaID2)/2;
lambdaPaschenbeta = 12822;
c=3*10^10;
data.reldate_highres_otherNaN = NaN(size(data.reldate));
data.reldate_highres_index = zeros(size(data.reldate),'logical');
for i=1:size(data.wave_dez,2)
	data.velHalpha{i} = 10^-5 .* c.* (data.wave_dez_aligned_halpha{i}-lambdaHalpha)./lambdaHalpha;
	data.velHbeta{i} = 10^-5 .* c.* (data.wave_dez_aligned_halpha{i}-lambdaHbeta)./lambdaHbeta;
	data.velNaID{i} = 10^-5 .* c.* (data.wave_dez_aligned_halpha{i}-lambdaNaID)./lambdaNaID;
	data.velPaschenbeta{i} = 10^-5 .* c.* (data.wave_dez_aligned_halpha{i}-lambdaPaschenbeta)./lambdaPaschenbeta;
	if(isfield(data.align_halpha.multiplier{i},'highres'))
		data.reldate_highres_otherNaN(i) = data.reldate(i);
		data.reldate_highres_index(i) = 1;
	end
	
	%normalize flux to halpha lowres peak for plotting line comparisons
	if(isfield(data.align_halpha.multiplier{i},'highres'))
		data.flux_norm_lowrespeak_halpha{i} = (data.flux_norm_cont_halpha{i}-1)./max(-1+data.flux_norm_cont_halpha{i}((find(data.velHalpha{i}>-3000&data.velHalpha{i}<-200))));
	else
		data.flux_norm_lowrespeak_halpha{i} = (data.flux_norm_cont_halpha{i}-1)./max(-1+data.flux_norm_cont_halpha{i}((find(data.velHalpha{i}>-3000&data.velHalpha{i}<3000))));
	end
	
%normalize flux to hbeta lowres peak for plotting line comparisons
	if(min(data.velHbeta{i})>0)
		data.flux_norm_lowrespeak_hbeta{i} = data.flux_norm_cont_halpha{i}-1;
	else
		data.flux_norm_lowrespeak_hbeta{i} = (data.flux_norm_cont_halpha{i}-1)./max(-1+data.flux_norm_cont_halpha{i}((find(data.velHbeta{i}>-3000&data.velHbeta{i}<-200))));
	end
		
	%normalize flux to NaID lowres peak for plotting line comparisons
	if(min(data.velNaID{i})>0)
		data.flux_norm_lowrespeak_NaID{i} = data.flux_norm_cont_halpha{i}-1;
	else
		data.flux_norm_lowrespeak_NaID{i} = (data.flux_norm_cont_halpha{i}-1)./max(-1+data.flux_norm_cont_halpha{i}((find(data.velNaID{i}>-3000&data.velNaID{i}<-200))));
	end	
		
	
	%normalize flux to hbeta lowres peak for plotting line comparisons
	if(max(data.velPaschenbeta{i})<0)
		data.flux_norm_lowrespeak_paschenbeta{i} = NaN;
	else
		data.flux_norm_lowrespeak_paschenbeta{i} = (data.flux_norm_cont_paschenbeta{i}-1)./max(-1+data.flux_norm_cont_paschenbeta{i}((find(data.velPaschenbeta{i}>-3000&data.velPaschenbeta{i}<-200))));
	end
end


plot(data.velPaschenbeta{i},data.flux_norm_cont_paschenbeta{i}-1)


j=1
for i=1:size(data.wave_dez,2)
i
	[data.leftEWHalpha(i) ,data.leftNEWerr(i) ,data.leftdEWHalpha(i) ,data.rightEWHalpha(i) ,data.rightNEWerr(i) ,data.rightdEWHalpha(i) ,data.EWreldate(i) ] = measureEWleftright(data.wave_dez{i},data.flux_norm_cont_halpha{i},data.reldate(i))
	if(max(data.velPaschenbeta{i})<0)
		%[data.leftEWHalpha(i) ,data.leftNEWerr(i) ,data.leftdEWHalpha(i) ,data.rightEWHalpha(i) ,data.rightNEWerr(i) ,data.rightdEWHalpha(i) ,data.EWreldate(i) ] = [NaN NaN NaN NaN NaN NaN NaN];
	else
		[data.leftEWPaschenbeta(i) ,data.leftNEWerrPaschenbeta(i) ,data.leftdEWPaschenbeta(i) ,data.rightEWPaschenbeta(i) ,data.rightNEWerrPaschenbeta(i) ,data.rightdEWPaschenbeta(i) ,data.EWreldatePaschenbeta(i) ] = measureEWleftrightPaschen(data.wave_dez{i},data.flux_norm_cont_paschenbeta{i},data.reldate(i))
		Pabetaroverbratio(j) = data.rightEWPaschenbeta(i)./data.leftEWPaschenbeta(i);
		PabetaBoverRratio(j) = data.leftEWPaschenbeta(i)./data.rightEWPaschenbeta(i);
		Pabetaroverbratioerr(j) = Pabetaroverbratio(j)  .* sqrt((data.rightdEWPaschenbeta(i)./data.rightEWPaschenbeta(i)).^2 + (data.leftdEWPaschenbeta(i)./data.leftEWPaschenbeta(i)).^2);
		PabetaBoverRratioerr(j) = PabetaBoverRratio(j)  .* sqrt((data.leftdEWPaschenbeta(i)./data.leftEWPaschenbeta(i)).^2 + (data.rightdEWPaschenbeta(i)./data.rightEWPaschenbeta(i)).^2);
		totalEWPaschenbeta(j) = data.leftEWPaschenbeta(i)+data.rightEWPaschenbeta(i);
		totalEWerrPaschenbeta(j) = sqrt(data.leftdEWPaschenbeta(i)^2+data.rightdEWPaschenbeta(i)^2);
		Pabetareldate(j) = data.reldate(i);
		j=j+1;
	end
	roverbratio(i) = data.rightEWHalpha(i)./data.leftEWHalpha(i);
	BoverRratio(i) = data.leftEWHalpha(i)./data.rightEWHalpha(i);
	roverbratioerr(i) = roverbratio(i)  .* sqrt((data.rightdEWHalpha(i)./data.rightEWHalpha(i)).^2 + (data.leftdEWHalpha(i)./data.leftEWHalpha(i)).^2);
	BoverRratioerr(i) = BoverRratio(i)  .* sqrt((data.leftdEWHalpha(i)./data.leftEWHalpha(i)).^2 + (data.rightdEWHalpha(i)./data.rightEWHalpha(i)).^2);
	totalEW(i) = data.leftEWHalpha(i)+data.rightEWHalpha(i);
	totalEWerr(i) = sqrt(data.leftdEWHalpha(i)^2+data.rightdEWHalpha(i)^2);
end

		%Pabetaroverbratioerr(j) = roverbratio(34)  .* sqrt((data.rightdEWPaschenbeta(34)./data.rightEWPaschenbeta(34)).^2 + (data.leftdEWPaschenbeta(34)./data.leftEWPaschenbeta(34)).^2);
		

%%% PLOTTING
data.color = varycolor(size(data.wave_dez_aligned_halpha,2));
maxcolors = distinguishable_colors(36);
plotting = figure;
set(gcf,'color','w');
set(plotting,'units','normalized','outerposition',[0 0 1 1]);
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 3 1]);
set(gcf,'renderer','painters')
colormap jet

%roverbratio plot
clf
hold all
plt1 = scatter(data.reldate,roverbratio,275,[0.0000 0.0000 0.0000],'MarkerFaceColor',[0.0000 0.0000 0.0000])
errorbar(data.reldate,roverbratio,roverbratioerr*0.4,'.','Color',[0.0000 0.0000 0.0000],'LineWidth',2)
plt2 = scatter(Pabetareldate,Pabetaroverbratio,275,[1.000 0.4000 0.0000],'MarkerFaceColor',[1.000 0.4000 0.0000])
errorbar(Pabetareldate,Pabetaroverbratio,Pabetaroverbratioerr*0.11,'.','Color',[1.000 0.4000 0.0000],'LineWidth',2)


%hL = legend([plt1 plt2],'','Location','Southeast')
htext = text(100,1.075,'Red side stronger','interpreter','latex')
set(htext, 'Color', [1 0 0])
set(htext, 'FontSize',44)
htext = text(100,0.925,'Blue side stronger','interpreter','latex')
set(htext, 'Color', [0 0 1])
set(htext, 'FontSize',44)

htext = text(60,0.3,'H$\alpha$','interpreter','latex')
set(htext, 'Color', [0 0 0])
set(htext, 'FontSize',44)
htext = text(60,0.1,'Pa$\beta$','interpreter','latex')
set(htext, 'Color', [1.000 0.4000 0.0000])
set(htext, 'FontSize',44)
line([-5 1000],[1 1],'LineStyle','--','Color',[0.5 0.5 0.5],'LineWidth',3)

ax1 = gca;
set(ax1,'FontSize',42)
xlabel('Days Relative to Discovery','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
ylabel('Ratio of Red/Blue Flux','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
set(gca,'XMinorTick','on','YMinorTick','on')
axis([[45 200],[0 1.2]])
box on
saveas(plotting, ['C:\Users\Cbilinski\Desktop\Figures\SN2014ab\bvsrratiored.eps'], 'epsc');
eval(['!epstopdf C:\Users\Cbilinski\Desktop\Figures\SN2014ab\bvsrratiored.eps']);


%BoverRratio plot
clf
hold all
plt1 = scatter(data.reldate,BoverRratio,275,[0.0000 0.0000 0.0000],'MarkerFaceColor',[0.0000 0.0000 0.0000])
errorbar(data.reldate,BoverRratio,BoverRratioerr*0.4,'.','Color',[0.0000 0.0000 0.0000],'LineWidth',2)
plt2 = scatter(Pabetareldate,PabetaBoverRratio,275,[1.000 0.4000 0.0000],'MarkerFaceColor',[1.000 0.4000 0.0000])
errorbar(Pabetareldate,PabetaBoverRratio,PabetaBoverRratioerr*0.11,'.','Color',[1.000 0.4000 0.0000],'LineWidth',2)


%hL = legend([plt1 plt2],'','Location','Southeast')
htext = text(100,1.1,'Blue side stronger','interpreter','latex')
set(htext, 'Color', [0 0 1])
set(htext, 'FontSize',44)
htext = text(100,0.9,'Red side stronger','interpreter','latex')
set(htext, 'Color', [1 0 0])
set(htext, 'FontSize',44)

htext = text(60,0.3,'H$\alpha$','interpreter','latex')
set(htext, 'Color', [0 0 0])
set(htext, 'FontSize',44)
htext = text(60,0.1,'Pa$\beta$','interpreter','latex')
set(htext, 'Color', [1.000 0.4000 0.0000])
set(htext, 'FontSize',44)
line([-5 1000],[1 1],'LineStyle','--','Color',[0.5 0.5 0.5],'LineWidth',3)

ax1 = gca;
set(ax1,'FontSize',42)
xlabel('Days Relative to Discovery','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
ylabel('Ratio of Red/Blue Flux','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
set(gca,'XMinorTick','on','YMinorTick','on')
axis([[45 200],[0.8 2]])
box on
saveas(plotting, ['C:\Users\Cbilinski\Desktop\Figures\SN2014ab\bvsrratioblue.eps'], 'epsc');
eval(['!epstopdf C:\Users\Cbilinski\Desktop\Figures\SN2014ab\bvsrratioblue.eps']);



%total EW plot

clf
hold all
scatter(data.reldate,totalEW,175,[0.0000 0.0000 0.0000],'MarkerFaceColor',[0.0000 0.0000 0.0000])
errorbar(data.reldate,totalEW,0.76*totalEWerr,'.','Color',[0.0000 0.0000 0.0000],'LineWidth',2)
scatter(Pabetareldate,totalEWPaschenbeta,175,[1.000 0.4000 0.0000],'MarkerFaceColor',[1.000 0.4000 0.0000])
errorbar(Pabetareldate,totalEWPaschenbeta,0.25*totalEWerrPaschenbeta,'.','Color',[1.000 0.4000 0.0000],'LineWidth',2)
set(gca,'xscale','log')
box on
axis([[45 1700],[450 1750]])
ax1 = gca;
set(ax1,'FontSize',42)
xlabel('Days Relative to Discovery','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
ylabel('Equivalent Width ($\rm{\AA}$)','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
htext = text(750,750,'H$\alpha$','interpreter','latex');
set(htext, 'Color', [0 0 0]);
set(htext, 'FontSize',46);
htext = text(750,550,'Pa$\beta$','interpreter','latex');
set(htext, 'Color', [1.000 0.4000 0.0000]);
set(htext, 'FontSize',46);
saveas(plotting, ['C:\Users\Cbilinski\Desktop\Figures\SN2014ab\eqw.eps'], 'epsc');
eval(['!epstopdf C:\Users\Cbilinski\Desktop\Figures\SN2014ab\eqw.eps']);



%%asymmetric plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);

data.mirrorflux_n500{2} = [data.flux_norm_lowrespeak_halpha{2}(find(data.velHalpha{2}<-500)) wrev(data.flux_norm_lowrespeak_halpha{2}(find(data.velHalpha{2}<-500)))];
data.mirrorwav_n500{2} = data.velHalpha{2}(1:length(data.mirrorflux_n500{2}));
data.mirrorflux_0{2} = [data.flux_norm_lowrespeak_halpha{2}(find(data.velHalpha{2}<-0)) wrev(data.flux_norm_lowrespeak_halpha{2}(find(data.velHalpha{2}<-0)))];
data.mirrorwav_0{2} = data.velHalpha{2}(1:length(data.mirrorflux_0{2}));

Lorx = data.velHalpha{2}((data.velHalpha{2}/1000 > -8) & (data.velHalpha{2}/1000 < 8))/1000
Lory = data.flux_norm_lowrespeak_halpha{2}((data.velHalpha{2}/1000 > -8) & (data.velHalpha{2}/1000 < 8))

Lorfit = lorentzfit(Lorx,Lory);

%Lorfit = lorentzfit(data.velHalpha{2}/1000,data.flux_norm_lowrespeak_halpha{2})

clf
hold all
l2 = plot(data.mirrorwav_0{2}/1000,data.mirrorflux_0{2},'LineWidth',7,'Color','blue')
l3 = plot(data.mirrorwav_n500{2}/1000,data.mirrorflux_n500{2},'LineWidth',5,'Color',[0.9961 0.5373 0.0000])
l1 = plot(data.velHalpha{2}/1000,data.flux_norm_lowrespeak_halpha{2},'LineWidth',3,'Color','black')
l4 = plot(Lorx,Lorfit,'--','LineWidth',3,'Color',[0.0000 0.7255 0.0902])
axis([[-8 8],[0 1.15]])
htext = text(-7.5,1.05,'SN 2014ab day 188')
set(htext, 'Color', 'black')
set(htext, 'FontSize',38)
htext = text(-7.5,0.85,'Mirrored at -500 km s^{-1}')
set(htext, 'Color',[0.9961 0.5373 0.0000])
set(htext, 'FontSize',38)
htext = text(-7.5,0.95,'Mirrored at 0 km s^{-1}')
set(htext, 'Color', 'blue')
set(htext, 'FontSize',38)
htext = text(-7.5,0.75,'Lorentzian Fit')
set(htext, 'Color', [0.0000 0.7255 0.0902])
set(htext, 'FontSize',38)
ax1 = gca;
set(ax1,'FontSize',42)
set(ax1,'XMinorTick','on','YMinorTick','on')
xlabel('Doppler velocity ($10^{3}\,\mathrm{km\,s^{-1}}$)','FontSize',44,'FontName','CMU Serif Roman','interpreter','latex')
ylabel('$F_{\lambda}$(Scaled)','interpreter','latex','FontSize',44,'FontName','CMU Serif Roman')
box on

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\MirrorAsymmetry.pdf -pdf



%linear plot comparison to 2010jl
%other lick dates
%[d20110125_sn2010jl(1,:) d20110125_sn2010jl(2,:) cp cp cp cp cp cp cp cp] = textread('lick\sn2010jl_kast_20110125_specpol.txt','%f%f%f%f%f%f%f%f%f%f','delimiter',' ');
%p20110125_sn2010jl(1,:) = d20110125_sn2010jl(1,:)/(1+z_sn2010jl);
%
%[d20110201_sn2010jl(1,:) d20110201_sn2010jl(2,:) cp cp cp cp cp cp cp cp] = textread('lick\sn2010jl_kast_20110201_specpol.txt','%f%f%f%f%f%f%f%f%f%f','delimiter',' ');
%p20110201_sn2010jl(1,:) = d20110201_sn2010jl(1,:)/(1+z_sn2010jl);

%new lick data from nathan to use
%d20110209_sn2010jl


plotcompare = figure;
set(gcf,'color','w');
set(plotcompare,'units','normalized','outerposition',[0 0 1 1]);
set(plotcompare,'PaperUnits','normalized','PaperPosition',[0 0 3 1]);
set(gcf,'renderer','painters')
colormap jet

clf
h = 6.626*10^-27; %erg s
c = 3*10^10; %cm s^-1
kB = 1.380658 * 10^-16; %erg K^-1

tempblackbody = 2*h*c^2./(data.wave_dez_aligned_halpha{35}.*10^-8).^5*1./(exp((h*c)./((data.wave_dez_aligned_halpha{35}.*10^-8).*kB.*6800))-1);
tempblackbodyvalues = 0.158.*tempblackbody./max(tempblackbody);

A_V_more = 0.10*3.08
data.flux_deredMWHG_more{35} = deredden(data.wave_dez{35},data.flux{35},A_V_sn2014ab + A_V_NaID + A_V_more);
d20110209_sn2010jl_dered(2,:) = deredden(p20110209_sn2010jl,d20110209_sn2010jl(2,:),A_V2010jl);

clf
hold all
p1 = plot(p20110209_sn2010jl,d20110209_sn2010jl_dered(2,:)./max(d20110209_sn2010jl_dered(2,p20110209_sn2010jl<7000)) ,'Color',[0.0000 0.4627 1.0000],'LineWidth',2)
%p2 = plot(data.wave_dez_aligned_halpha{35},smooth(0.066+data.flux_deredMWHG{35}./max( data.flux_deredMWHG{35}( (data.wave_dez_aligned_halpha{35}<7000) & (data.wave_dez_aligned_halpha{35}>5000) ) )),'Color',[0.9961 0.5373 0.0000],'LineWidth',2)
p3 = plot(data.wave_dez_aligned_halpha{35},smooth(0.043+data.flux_deredMWHG_more{35}./max( data.flux_deredMWHG_more{35}( (data.wave_dez_aligned_halpha{35}<7000) & (data.wave_dez_aligned_halpha{35}>5000) ) )),'Color',[0 0 0],'LineWidth',2)
%p4 = plot(p20110102_sn2010jl,-0.025+d20110102_sn2010jl(2,:)./max(d20110102_sn2010jl(2,p20110102_sn2010jl<7000)) ,'Color',[0.0000 0.4627 1.0000],'LineWidth',2)
p5 = plot(data.wave_dez_aligned_halpha{35},tempblackbodyvalues,'LineWidth',2,'Color',[0.9961 0.5373 0.0000])

axis([[3400 9000] [0.05 0.3]])
xlabel('Rest Wavelength ($\rm{\AA}$) ','interpreter','latex','FontSize',26,'FontName','CMU Serif Roman')
ylabel('$F_\lambda$ (Arbitrarily Scaled)','interpreter','latex','FontSize',26,'FontName','CMU Serif Roman')
box on
ax1 = gca;
set(ax1,'FontSize',24)
set(ax1,'XMinorTick','on','YMinorTick','on')

lgd = legend([p1, p3, p5],{'SN 2010jl day 99 ','SN 2014ab day 70 + Dereddening','6800K Blackbody'},'FontSize',22)

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\LinearSpectrum.pdf



cont1qupair(1,:) = [9.5508e-04,4.6277e-04]
cont1qupair(2,:) = [-0.0020,0.0014       ]
cont1qupair(3,:) = [-0.0023,0.0021       ]
cont1qupair(4,:) = [-0.0021,0.0025       ]
cont1qupair(5,:) = [-9.9241e-05,0.0034   ]

cont2qupair(1,:) = [7.8158e-04,3.8179e-04]
cont2qupair(2,:) = [-0.0017,0.0014       ]
cont2qupair(3,:) = [2.0255e-04,0.0044    ]
cont2qupair(4,:) = [-0.0011,0.0036       ]
cont2qupair(5,:) = [-0.0041,2.4105e-04   ]

cont1qupair_err(1,:) = [2.7436e-04,2.6484e-04]
cont1qupair_err(2,:) = [3.0663e-04,2.8842e-04]
cont1qupair_err(3,:) = [6.7365e-04,6.6340e-04]
cont1qupair_err(4,:) = [5.3303e-04,5.4699e-04]
cont1qupair_err(5,:) = [8.7406e-04,8.7468e-04]

cont2qupair_err(1,:) = [3.6865e-04,3.7711e-04]
cont2qupair_err(2,:) = [4.4522e-04,4.1554e-04]
cont2qupair_err(3,:) = [9.6309e-04,8.8501e-04]
cont2qupair_err(4,:) = [6.6748e-04,7.7754e-04]
cont2qupair_err(5,:) = [0.0012,0.0012]


cont3qupair(1,:) = [4.8473e-04,-6.0556e-04]
cont3qupair(2,:) = [-2.4661e-04,0.0027]
cont3qupair(3,:) = [-4.6530e-04,0.0023]
cont3qupair(4,:) = [-0.0010,0.0035]
cont3qupair(5,:) = [-0.0023,0.0031]

cont3qupair_err(1,:) = [2.6635e-04,2.4349e-04]
cont3qupair_err(2,:) = [2.4200e-04,2.3526e-04]
cont3qupair_err(3,:) = [4.3965e-04,4.7643e-04]
cont3qupair_err(4,:) = [3.5428e-04,3.9582e-04]
cont3qupair_err(5,:) = [4.6765e-04,4.4630e-04]








plottingqupair = figure
set(gcf,'color','w');
set(plottingqupair,'units','normalized','outerposition',[0 0 1 1]);
set(plottingqupair,'PaperUnits','normalized','PaperPosition',[0 0 3 1]);
set(gcf,'renderer','painters')
colormap jet

clf
axis([[-0.5 0.5] [-0.5 0.5]])
hold all
plot(100*cont1qupair(:,1),100*cont1qupair(:,2),'Color','black')
e1 = errorbar(100*cont1qupair(1,1),100*cont1qupair(1,2),100*cont1qupair_err(1,2),100*cont1qupair_err(1,2),100*cont1qupair_err(1,1),100*cont1qupair_err(1,1),'Color','black','Marker','x','MarkerSize',5)                              
e2 = errorbar(100*cont1qupair(2,1),100*cont1qupair(2,2),100*cont1qupair_err(2,2),100*cont1qupair_err(2,2),100*cont1qupair_err(2,1),100*cont1qupair_err(2,1),'Color','black','Marker','s','MarkerSize',5)                                  
e3 = errorbar(100*cont1qupair(3,1),100*cont1qupair(3,2),100*cont1qupair_err(3,2),100*cont1qupair_err(3,2),100*cont1qupair_err(3,1),100*cont1qupair_err(3,1),'Color','black','Marker','d','MarkerSize',5)                                    
e4 = errorbar(100*cont1qupair(4,1),100*cont1qupair(4,2),100*cont1qupair_err(4,2),100*cont1qupair_err(4,2),100*cont1qupair_err(4,1),100*cont1qupair_err(4,1),'Color','black','Marker','^','MarkerSize',5)                                
e5 = errorbar(100*cont1qupair(5,1),100*cont1qupair(5,2),100*cont1qupair_err(5,2),100*cont1qupair_err(5,2),100*cont1qupair_err(5,1),100*cont1qupair_err(5,1),'Color','black','Marker','v','MarkerSize',5)

plot(100*cont2qupair(:,1),100*cont2qupair(:,2),'Color',[0.9961 0.5373 0.0000])
errorbar(100*cont2qupair(1,1),100*cont2qupair(1,2),100*cont2qupair_err(1,2),100*cont2qupair_err(1,2),100*cont2qupair_err(1,1),100*cont2qupair_err(1,1),'Color',[0.9961 0.5373 0.0000])                                 
errorbar(100*cont2qupair(2,1),100*cont2qupair(2,2),100*cont2qupair_err(2,2),100*cont2qupair_err(2,2),100*cont2qupair_err(2,1),100*cont2qupair_err(2,1),'Color',[0.9961 0.5373 0.0000])                                 
errorbar(100*cont2qupair(3,1),100*cont2qupair(3,2),100*cont2qupair_err(3,2),100*cont2qupair_err(3,2),100*cont2qupair_err(3,1),100*cont2qupair_err(3,1),'Color',[0.9961 0.5373 0.0000])                               
errorbar(100*cont2qupair(4,1),100*cont2qupair(4,2),100*cont2qupair_err(4,2),100*cont2qupair_err(4,2),100*cont2qupair_err(4,1),100*cont2qupair_err(4,1),'Color',[0.9961 0.5373 0.0000])                             
errorbar(100*cont2qupair(5,1),100*cont2qupair(5,2),100*cont2qupair_err(5,2),100*cont2qupair_err(5,2),100*cont2qupair_err(5,1),100*cont2qupair_err(5,1),'Color',[0.9961 0.5373 0.0000])

plot(100*cont3qupair(:,1),100*cont3qupair(:,2),'Color',[0 0 1])
errorbar(100*cont3qupair(1,1),100*cont3qupair(1,2),100*cont3qupair_err(1,2),100*cont3qupair_err(1,2),100*cont3qupair_err(1,1),100*cont3qupair_err(1,1),'Color',[0 0 1])                                 
errorbar(100*cont3qupair(2,1),100*cont3qupair(2,2),100*cont3qupair_err(2,2),100*cont3qupair_err(2,2),100*cont3qupair_err(2,1),100*cont3qupair_err(2,1),'Color',[0 0 1])                                 
errorbar(100*cont3qupair(3,1),100*cont3qupair(3,2),100*cont3qupair_err(3,2),100*cont3qupair_err(3,2),100*cont3qupair_err(3,1),100*cont3qupair_err(3,1),'Color',[0 0 1])                               
errorbar(100*cont3qupair(4,1),100*cont3qupair(4,2),100*cont3qupair_err(4,2),100*cont3qupair_err(4,2),100*cont3qupair_err(4,1),100*cont3qupair_err(4,1),'Color',[0 0 1])                             
errorbar(100*cont3qupair(5,1),100*cont3qupair(5,2),100*cont3qupair_err(5,2),100*cont3qupair_err(5,2),100*cont3qupair_err(5,1),100*cont3qupair_err(5,1),'Color',[0 0 1])


box on
blah1 = line([-1 1],[0 0],'LineStyle','--','Color',[0 0 0]);
blah2 = line([0 0],[-1 1],'LineStyle','--','Color',[0 0 0]);
xlabel('Integrated q (\%)','FontSize',28,'interpreter','latex')
ylabel('Integrated u (\%)','FontSize',28,'interpreter','latex')

s1 = scatter(100*cont1qupair(1,1),100*cont1qupair(1,2),300,'x','MarkerFaceColor','Black','MarkerEdgeColor','Black')
s2 = scatter(100*cont1qupair(2,1),100*cont1qupair(2,2),300,'s','MarkerFaceColor','Black','MarkerEdgeColor','Black')
s3 = scatter(100*cont1qupair(3,1),100*cont1qupair(3,2),300,'d','MarkerFaceColor','Black','MarkerEdgeColor','Black')
s4 = scatter(100*cont1qupair(4,1),100*cont1qupair(4,2),300,'^','MarkerFaceColor','Black','MarkerEdgeColor','Black')
s5 = scatter(100*cont1qupair(5,1),100*cont1qupair(5,2),300,'v','MarkerFaceColor','Black','MarkerEdgeColor','Black')

s1_2 = scatter(100*cont2qupair(1,1),100*cont2qupair(1,2),300,'x','MarkerFaceColor',[0.9961 0.5373 0.0000],'MarkerEdgeColor',[0.9961 0.5373 0.0000])
s2_2 = scatter(100*cont2qupair(2,1),100*cont2qupair(2,2),300,'s','MarkerFaceColor',[0.9961 0.5373 0.0000],'MarkerEdgeColor',[0.9961 0.5373 0.0000])
s3_2 = scatter(100*cont2qupair(3,1),100*cont2qupair(3,2),300,'d','MarkerFaceColor',[0.9961 0.5373 0.0000],'MarkerEdgeColor',[0.9961 0.5373 0.0000])
s4_2 = scatter(100*cont2qupair(4,1),100*cont2qupair(4,2),300,'^','MarkerFaceColor',[0.9961 0.5373 0.0000],'MarkerEdgeColor',[0.9961 0.5373 0.0000])
s5_2 = scatter(100*cont2qupair(5,1),100*cont2qupair(5,2),300,'v','MarkerFaceColor',[0.9961 0.5373 0.0000],'MarkerEdgeColor',[0.9961 0.5373 0.0000])

s1_3 = scatter(100*cont3qupair(1,1),100*cont3qupair(1,2),300,'x','MarkerFaceColor',[0 0 1],'MarkerEdgeColor',[0 0 1])
s2_3 = scatter(100*cont3qupair(2,1),100*cont3qupair(2,2),300,'s','MarkerFaceColor',[0 0 1],'MarkerEdgeColor',[0 0 1])
s3_3 = scatter(100*cont3qupair(3,1),100*cont3qupair(3,2),300,'d','MarkerFaceColor',[0 0 1],'MarkerEdgeColor',[0 0 1])
s4_3 = scatter(100*cont3qupair(4,1),100*cont3qupair(4,2),300,'^','MarkerFaceColor',[0 0 1],'MarkerEdgeColor',[0 0 1])
s5_3 = scatter(100*cont3qupair(5,1),100*cont3qupair(5,2),300,'v','MarkerFaceColor',[0 0 1],'MarkerEdgeColor',[0 0 1])


text(0.125,0.4,'5100-5700 $\rm{\AA}$','interpreter','LaTex','FontSize',38)
text(0.125,0.3,'6000-6300 $\rm{\AA}$','interpreter','LaTex','FontSize',38,'Color',[0.9961 0.5373 0.0000])
ax1 = gca;
set(ax1,'FontSize',36)
set(ax1,'XMinorTick','on','YMinorTick','on')

[~, objh] = legend([s1, s2, s3, s4, s5],{'Epoch 1','Epoch 2','Epoch 3','Epoch 4','Epoch 5'},'FontSize',38)
objhl = findobj(objh, 'type', 'patch'); %// objects of legend of type line
set(objhl, 'Markersize', 20); %// set marker size as desired

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\qucontmigration.pdf









%halpha velocity plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-8 8] [-0.1+1 1+1.1]])
for i=1:size(data.wave_dez_aligned_halpha,2)
	%handle exceptions
	%if (i ==size(data.wave_dez_aligned_halpha,2))
	%	plot(data.velHalpha{end}/1000,1+data.flux_norm_lowrespeak_halpha{end},'LineWidth',2,'Color',data.color(i,:));
	%else
		if(data.reldate_highres_index(i) == 1)
			plot(data.velHalpha{i}/1000,1+data.flux_norm_lowrespeak_halpha{i},'LineWidth',2,'Color',[data.color(i,:) 1]);
		%htext = text(-7,1.2,'day 1'       ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(i,:))
		%pause(0.1);
		else
			plot(data.velHalpha{i}/1000,1+data.flux_norm_lowrespeak_halpha{i},'LineWidth',2,'Color',[data.color(i,:) 0.2]);
		end
	%end
end
box on
line([-8 8],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (10^{3} km/s)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')

htext = text(-6,1+0.5,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
htext = text(-6,1+0.4,'H$\alpha$','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',36)
set(ax1,'XMinorTick','on','YMinorTick','on')
htext = text(-7,1+1.050,['day ',char(string(data.reldate(1 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(1 ,:) 0.2])
htext = text(-7,1+0.975,['day ',char(string(data.reldate(2 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(2 ,:) 1  ])
htext = text(-7,1+0.900,['day ',char(string(data.reldate(3 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(3 ,:) 0.2])
htext = text(-7,1+0.825,['day ',char(string(data.reldate(4 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(4 ,:) 0.2])
htext = text(-7,1+0.750,['day ',char(string(data.reldate(5 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(5 ,:) 0.2])
htext = text(-7,1+0.675,['day ',char(string(data.reldate(6 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(6 ,:) 0.2])
htext = text(-7,1+0.600,['day ',char(string(data.reldate(7 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(7 ,:) 0.2])
htext = text(-5,1+1.050,['day ',char(string(data.reldate(8 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(8 ,:) 0.2])
htext = text(-5,1+0.975,['day ',char(string(data.reldate(9 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(9 ,:) 0.2])
htext = text(-5,1+0.900,['day ',char(string(data.reldate(10)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(10,:) 0.2])
htext = text(-5,1+0.825,['day ',char(string(data.reldate(11)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(11,:) 0.2])
htext = text(-5,1+0.750,['day ',char(string(data.reldate(12)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(12,:) 0.2])
htext = text(-5,1+0.675,['day ',char(string(data.reldate(13)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(13,:) 0.2])
htext = text(-5,1+0.600,['day ',char(string(data.reldate(14)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(14,:) 1  ])
htext = text(-3,1+1.050,['day ',char(string(data.reldate(15)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(15,:) 0.2])
htext = text(-3,1+0.975,['day ',char(string(data.reldate(16)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(16,:) 0.2])
htext = text(-3,1+0.900,['day ',char(string(data.reldate(17)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(17,:) 0.2])
htext = text(-3,1+0.825,['day ',char(string(data.reldate(18)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(18,:) 0.2])
htext = text(1 ,1+1.050,['day ',char(string(data.reldate(19)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(19,:) 0.2])
htext = text(1 ,1+0.975,['day ',char(string(data.reldate(20)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(20,:) 0.2])
htext = text(1 ,1+0.900,['day ',char(string(data.reldate(21)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(21,:) 1  ])
htext = text(1 ,1+0.825,['day ',char(string(data.reldate(22)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(22,:) 0.2])
htext = text(3 ,1+1.050,['day ',char(string(data.reldate(23)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(23,:) 0.2])
htext = text(3 ,1+0.975,['day ',char(string(data.reldate(24)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(24,:) 0.2])
htext = text(3 ,1+0.900,['day ',char(string(data.reldate(25)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(25,:) 0.2])
htext = text(3 ,1+0.825,['day ',char(string(data.reldate(26)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(26,:) 0.2])
htext = text(3 ,1+0.750,['day ',char(string(data.reldate(27)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(27,:) 0.2])
htext = text(3 ,1+0.675,['day ',char(string(data.reldate(28)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(28,:) 0.2])
htext = text(3 ,1+0.600,['day ',char(string(data.reldate(29)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(29,:) 0.2])
htext = text(5 ,1+1.050,['day ',char(string(data.reldate(30)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(30,:) 0.2])
htext = text(5 ,1+0.975,['day ',char(string(data.reldate(31)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(31,:) 1  ])
htext = text(5 ,1+0.900,['day ',char(string(data.reldate(32)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(32,:) 0.2])
htext = text(5 ,1+0.825,['day ',char(string(data.reldate(33)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(33,:) 1  ])
htext = text(5 ,1+0.750,['day ',char(string(data.reldate(34)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(34,:) 0.2])
htext = text(5 ,1+0.675,['day ',char(string(data.reldate(35)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(35,:) 1  ])
htext = text(5 ,1+0.600,['day ',char(string(data.reldate(36)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(36,:) 1  ])

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\HalphaVelocity.jpg -jpg


%saveas(plotting, ['C:\Users\Cbilinski\Desktop\Figures\SN2014ab\HalphaVelocitytest.eps'], 'epsc');
%eval(['!epstopdf C:\Users\Cbilinski\Desktop\Figures\SN2014ab\HalphaVelocitytest.eps']);



%hbeta velocity plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-20 20] [-0.1+1 1+1.1]])
for i=1:size(data.wave_dez_aligned_halpha,2)
	%handle exceptions
	if(min(data.velHbeta{i})>0)
		nodata(i) = 1;
	elseif (i ==size(data.wave_dez_aligned_halpha,2))
		plot(data.velHbeta{end}/1000,1+data.flux_norm_lowrespeak_hbeta{end},'LineWidth',2,'Color',data.color(i,:));
	else
		if(data.reldate_highres_index(i) == 1)
			plot(data.velHbeta{i}/1000,1+data.flux_norm_lowrespeak_hbeta{i},'LineWidth',2,'Color',[data.color(i,:) 1]);
		else
			plot(data.velHbeta{i}/1000,1+data.flux_norm_lowrespeak_hbeta{i},'LineWidth',2,'Color',[data.color(i,:) 0.2]);
		end
		%htext = text(-7,1.2,'day 1'       ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(i,:))
		%pause(0.1);
	end
end
box on
line([-20000 20000],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (10^{3} km/s)','FontSize',42,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')

htext = text(-11,1+0.5,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
htext = text(-11,1+0.4,'H$\beta$','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',36)
set(ax1,'XMinorTick','on','YMinorTick','on')
htext = text(-19,1+1.050,['day ',char(string(data.reldate(1 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(1 ,:) 0.2])
htext = text(-19,1+0.975,['day ',char(string(data.reldate(2 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 36,'Color',[data.color(2 ,:) 1  ])
htext = text(-19,1+0.900,['day ',char(string(data.reldate(3 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(3 ,:) 0.2])
htext = text(-19,1+0.825,['day ',char(string(data.reldate(4 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(4 ,:) 0.2])
htext = text(-19,1+0.750,['day ',char(string(data.reldate(5 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(5 ,:) 0.2])
htext = text(-19,1+0.675,['day ',char(string(data.reldate(6 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(6 ,:) 0.2])
%htext = text(-191+,0.600,['day ',char(string(data.reldate(7 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(7 ,:) 0.2])
%htext = text(-121+,1.050,['day ',char(string(data.reldate(8 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(8 ,:) 0.2])
%htext = text(-121+,0.975,['day ',char(string(data.reldate(9 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',22,'Color',[data.color(9 ,:) 0.2])
htext = text(-12.5,1+1.050,['day ',char(string(data.reldate(10)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(10,:) 0.2])
htext = text(-12.5,1+0.975,['day ',char(string(data.reldate(11)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(11,:) 0.2])
htext = text(-12.5,1+0.900,['day ',char(string(data.reldate(12)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(12,:) 0.2])
htext = text(-12.5,1+0.825,['day ',char(string(data.reldate(13)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(13,:) 0.2])
htext = text(-12.5,1+0.750,['day ',char(string(data.reldate(14)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 36,'Color',[data.color(14,:) 1  ])
htext = text(-12.5,1+0.675,['day ',char(string(data.reldate(15)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(15,:) 0.2])
htext = text(-6,1+1.050,['day ',char(string(data.reldate(16)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(16,:) 0.2])
htext = text(-6,1+0.975,['day ',char(string(data.reldate(17)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(17,:) 0.2])
htext = text(-6,1+0.900,['day ',char(string(data.reldate(18)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(18,:) 0.2])
%htext = text(2 ,1+1.050,['day ',char(string(data.reldate(19)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(19,:) 0.2])
htext = text(0.5 ,1+1.050,['day ',char(string(data.reldate(20)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(20,:) 0.2])
htext = text(0.5 ,1+0.975,['day ',char(string(data.reldate(21)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  36,'Color',[data.color(21,:) 1  ])
htext = text(0.5 ,1+0.900,['day ',char(string(data.reldate(22)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(22,:) 0.2])
htext = text(7 ,1+1.050,['day ',char(string(data.reldate(23)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(23,:) 0.2])
htext = text(7 ,1+0.975,['day ',char(string(data.reldate(24)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(24,:) 0.2])
htext = text(7 ,1+0.900,['day ',char(string(data.reldate(25)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(25,:) 0.2])
htext = text(7 ,1+0.825,['day ',char(string(data.reldate(26)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(26,:) 0.2])
htext = text(7 ,1+0.750,['day ',char(string(data.reldate(27)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(27,:) 0.2])
htext = text(7 ,1+0.675,['day ',char(string(data.reldate(28)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',  22,'Color',[data.color(28,:) 0.2])
htext = text(13.5 ,1+1.050,['day ',char(string(data.reldate(29)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(29,:) 0.2])
htext = text(13.5 ,1+0.975,['day ',char(string(data.reldate(30)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(30,:) 0.2])
htext = text(13.5 ,1+0.900,['day ',char(string(data.reldate(31)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 36,'Color',[data.color(31,:) 1  ])
htext = text(13.5 ,1+0.825,['day ',char(string(data.reldate(32)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(32,:) 0.2])
htext = text(13.5 ,1+0.750,['day ',char(string(data.reldate(33)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 36,'Color',[data.color(33,:) 1  ])
htext = text(13.5 ,1+0.675,['day ',char(string(data.reldate(34)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 22,'Color',[data.color(34,:) 0.2])
htext = text(13.5 ,1+0.600,['day ',char(string(data.reldate(35)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize', 36,'Color',[data.color(35,:) 1  ])
%htext = text(16 1+,0.600,['day ',char(string(data.reldate(36)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[data.color(36,:) 1  ])


export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\HbetaVelocity.jpg -jpg


%Paschen beta velocity plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-8 8] [-0.1+1 1+1.1]])
j=1;
for i=1:size(data.wave_dez,2)
	%handle exceptions
	if(max(data.velPaschenbeta{i})<0)
		nodataPaschenbeta(i) = 1;
	else
		plot(data.velPaschenbeta{i}/1000,1+smooth(data.flux_norm_lowrespeak_paschenbeta{i},25),'LineWidth',2,'Color',maxcolors(j,:));
		htext = text(5,1+1-0.1*j,['day ',char(string(data.reldate(i)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',32,'Color',maxcolors(j,:))
		%pause(0.1);
		j=j+1;
	end
end
box on
%line([-20000 20000],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (10^{3} km/s)','FontSize',42,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')

htext = text(-6,1+0.7,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
htext = text(-6,1+0.6,'Pa$\beta$','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',36)
set(ax1,'XMinorTick','on','YMinorTick','on')

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\PabetaVelocity.jpg -jpg


%Paschen beta vs Halpha velocity plot
%%%zzz scale factor for paschen beta resolved? also check on pa beta not lining up for some of them zzz
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-8 8] [-0.1+1 1+1.1]])
j=1;
for i=1:size(data.wave_dez,2)
	%handle exceptions
	if(max(data.velPaschenbeta{i})<0)
		nodataPaschenbeta(i) = 1;
	else
		if( (i==2))
			plot(data.velPaschenbeta{i}/1000,1+1.05*smooth(data.flux_norm_lowrespeak_paschenbeta{i},25),'LineWidth',2,'Color',maxcolors(j,:));
			plot(data.velHalpha{i}/1000,1+smooth(data.flux_norm_lowrespeak_halpha{i},25),'LineWidth',2,'Color',[0 0 0]);
			htext = text(2,1.8,['---Pa$\beta$ day ',char(string(data.reldate(i)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',maxcolors(j,:))
			htext = text(2,1.7,['---H$\alpha$ day ',char(string(data.reldate(i)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
			%pause(0.1);
			j=j+1;
		end
	end
end
box on
%line([-20000 20000],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (10^{3} km/s)','FontSize',42,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')

htext = text(-6,1+0.7,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
%htext = text(-6,1+0.6,'Pa$\beta$','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',36)
set(ax1,'XMinorTick','on','YMinorTick','on')

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\PabetavsHalphaVelocity.jpg -jpg

%NaID velocity plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-20 20] [-0.5 1.1]])
for i=1:size(data.wave_dez_aligned_halpha,2)
	%handle exceptions
	if(min(data.velNaID{i})>0)
		nodataNaID(i) = 1;
	else
		plot(data.velNaID{i}/1000,smooth(data.flux_norm_lowrespeak_NaID{i},25),'LineWidth',2,'Color',data.color(i,:));
		%htext = text(-7,1.2,'day 1'       ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(i,:))
		%pause(0.1);
	end
end
box on
line([-20000 20000],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (km/s)','FontSize',32,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',32,'FontName','CMU Serif Roman')

htext = text(-8,0.7,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',[0 0 0])
htext = text(-8,0.6,'Na ID','FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',28)
set(ax1,'XMinorTick','on','YMinorTick','on')
htext = text(-19,1.050,['day ',char(string(data.reldate(1 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(1 ,:))
htext = text(-19,0.975,['day ',char(string(data.reldate(2 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(2 ,:))
htext = text(-19,0.900,['day ',char(string(data.reldate(3 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(3 ,:))
htext = text(-19,0.825,['day ',char(string(data.reldate(4 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(4 ,:))
htext = text(-19,0.750,['day ',char(string(data.reldate(5 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(5 ,:))
htext = text(-19,0.675,['day ',char(string(data.reldate(6 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(6 ,:))
%htext = text(-19,0.600,['day ',char(string(data.reldate(7 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(7 ,:))
%htext = text(-12,1.050,['day ',char(string(data.reldate(8 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(8 ,:))
%htext = text(-12,0.975,['day ',char(string(data.reldate(9 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(9 ,:))
htext = text(-12,1.050,['day ',char(string(data.reldate(10)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(10,:))
htext = text(-12,0.975,['day ',char(string(data.reldate(11)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(11,:))
htext = text(-12,0.900,['day ',char(string(data.reldate(12)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(12,:))
htext = text(-12,0.825,['day ',char(string(data.reldate(13)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(13,:))
htext = text(-12,0.750,['day ',char(string(data.reldate(14)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(14,:))
htext = text(-12,0.675,['day ',char(string(data.reldate(15)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(15,:))
htext = text(-5,1.050,['day ',char(string(data.reldate(16)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(16,:))
htext = text(-5,0.975,['day ',char(string(data.reldate(17)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(17,:))
htext = text(-5,0.900,['day ',char(string(data.reldate(18)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(18,:))
%htext = text(2 ,1.050,['day ',char(string(data.reldate(19)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(19,:))
htext = text(2 ,1.050,['day ',char(string(data.reldate(20)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(20,:))
htext = text(2 ,0.975,['day ',char(string(data.reldate(21)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(21,:))
htext = text(2 ,0.900,['day ',char(string(data.reldate(22)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(22,:))
htext = text(9 ,1.050,['day ',char(string(data.reldate(23)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(23,:))
htext = text(9 ,0.975,['day ',char(string(data.reldate(24)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(24,:))
htext = text(9 ,0.900,['day ',char(string(data.reldate(25)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(25,:))
htext = text(9 ,0.825,['day ',char(string(data.reldate(26)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(26,:))
htext = text(9 ,0.750,['day ',char(string(data.reldate(27)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(27,:))
htext = text(9 ,0.675,['day ',char(string(data.reldate(28)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(28,:))
htext = text(16 ,1.050,['day ',char(string(data.reldate(29)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(29,:))
htext = text(16 ,0.975,['day ',char(string(data.reldate(30)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(30,:))
htext = text(16 ,0.900,['day ',char(string(data.reldate(31)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(31,:))
htext = text(16 ,0.825,['day ',char(string(data.reldate(32)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(32,:))
htext = text(16 ,0.750,['day ',char(string(data.reldate(33)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(33,:))
htext = text(16 ,0.675,['day ',char(string(data.reldate(34)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(34,:))
htext = text(16 ,0.600,['day ',char(string(data.reldate(35)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(35,:))
%htext = text(16 ,0.600,['day ',char(string(data.reldate(36)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(36,:))

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\NaIDVelocity.pdf -pdf











%halpha narrow velocity plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-250. 0] [0.8 1.1]])

j=0;
for i=1:size(data.wave_dez_aligned_halpha,2)
	%handle exceptions
	if (i ==size(data.wave_dez_aligned_halpha,2))
		%plot(data.velHalpha{end}/1000,data.flux_norm_lowrespeak_halpha{end},'LineWidth',2,'Color',data.color(i,:));
	else
		if (1==data.reldate_highres_index(i))
			i
			plot(data.velHalpha{i},data.flux_norm_lowrespeak_halpha{i},'LineWidth',2,'Color',data.color(i,:));
			htext = text(-240,1.08-j*0.015,['day ',char(string(data.reldate(i)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',32,'Color',data.color(i,:))
			%pause(0.1);
			j=j+1;
		end
	end
end
box on
line([-8 8],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (km/s)','FontSize',42,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')

htext = text(-0.15*1000,1.075,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
htext = text(-0.15*1000,1.050,'H$\alpha$ narrow absorption','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',28)
set(ax1,'XMinorTick','on','YMinorTick','on')
%htext = text(-7,1.050,['day ',char(string(data.reldate(1 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(1 ,:))
%htext = text(-7,0.975,['day ',char(string(data.reldate(2 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(2 ,:))
%htext = text(-7,0.900,['day ',char(string(data.reldate(3 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(3 ,:))
%htext = text(-7,0.825,['day ',char(string(data.reldate(4 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(4 ,:))
%htext = text(-7,0.750,['day ',char(string(data.reldate(5 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(5 ,:))
%htext = text(-7,0.675,['day ',char(string(data.reldate(6 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(6 ,:))
%htext = text(-7,0.600,['day ',char(string(data.reldate(7 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(7 ,:))
%htext = text(-5,1.050,['day ',char(string(data.reldate(8 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(8 ,:))
%htext = text(-5,0.975,['day ',char(string(data.reldate(9 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(9 ,:))
%htext = text(-5,0.900,['day ',char(string(data.reldate(10)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(10,:))
%htext = text(-5,0.825,['day ',char(string(data.reldate(11)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(11,:))
%htext = text(-5,0.750,['day ',char(string(data.reldate(12)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(12,:))
%htext = text(-5,0.675,['day ',char(string(data.reldate(13)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(13,:))
%htext = text(-5,0.600,['day ',char(string(data.reldate(14)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(14,:))
%htext = text(-3,1.050,['day ',char(string(data.reldate(15)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(15,:))
%htext = text(-3,0.975,['day ',char(string(data.reldate(16)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(16,:))
%htext = text(-3,0.900,['day ',char(string(data.reldate(17)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(17,:))
%htext = text(-3,0.825,['day ',char(string(data.reldate(18)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(18,:))
%htext = text(-0.23*1000 ,1.075,['day ',char(string(data.reldate(19)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(19,:))
%%htext = text(1 ,0.975,['day ',char(string(data.reldate(20)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(20,:))
%%htext = text(1 ,0.900,['day ',char(string(data.reldate(21)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(21,:))
%%htext = text(1 ,0.825,['day ',char(string(data.reldate(22)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(22,:))
%%htext = text(3 ,1.050,['day ',char(string(data.reldate(23)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(23,:))
%htext = text(-0.23 *1000,1.050,['day ',char(string(data.reldate(24)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(24,:))
%%htext = text(3 ,0.900,['day ',char(string(data.reldate(25)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(25,:))
%htext = text(-0.23 *1000,1.025,['day ',char(string(data.reldate(26)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(26,:))
%%htext = text(3 ,0.750,['day ',char(string(data.reldate(27)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(27,:))
%%htext = text(3 ,0.675,['day ',char(string(data.reldate(28)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(28,:))
%%htext = text(3 ,0.600,['day ',char(string(data.reldate(29)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(29,:))
%%htext = text(5 ,1.050,['day ',char(string(data.reldate(30)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(30,:))
%%htext = text(5 ,0.975,['day ',char(string(data.reldate(31)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(31,:))
%%htext = text(5 ,0.900,['day ',char(string(data.reldate(32)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(32,:))
%htext = text(-0.20 *1000,1.075,['day ',char(string(data.reldate(33)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(33,:))
%htext = text(-0.20 *1000,1.050,['day ',char(string(data.reldate(34)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(34,:))
%%htext = text(5 ,0.675,['day ',char(string(data.reldate(35)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(35,:))
%%htext = text(5 ,0.600,['day ',char(string(data.reldate(36)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(36,:))

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\HalphaVelocityNarrowAbs.pdf -pdf






%hbeta velocity plot
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-250 0] [0.7 1.1]])
j=0;
for i=1:size(data.wave_dez_aligned_halpha,2)
	%handle exceptions
	if(min(data.velHbeta{i})>0)
		nodata(i) = 1;
	elseif (i ==size(data.wave_dez_aligned_halpha,2))
		plot(data.velHbeta{end},data.flux_norm_lowrespeak_hbeta{end},'LineWidth',2,'Color',data.color(i,:));
	else
		if (1==data.reldate_highres_index(i))
			plot(data.velHbeta{i},data.flux_norm_lowrespeak_hbeta{i},'LineWidth',2,'Color',data.color(i,:));
			%htext = text(-7,1.2,'day 1'       ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(i,:))
			htext = text(-240,1.08-j*0.02,['day ',char(string(data.reldate(i)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',32,'Color',data.color(i,:))
			j=j+1;
			%pause(0.1);
		end
	end
end
box on
line([-20000 20000],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (km/s)','FontSize',42,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',42,'FontName','CMU Serif Roman')

htext = text(-0.15*1000,1.075,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
htext = text(-0.15*1000,1.050,'H$\beta$ narrow absorption','FontName','CMU Serif Roman','interpreter','latex','FontSize',36,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',28)
set(ax1,'XMinorTick','on','YMinorTick','on')
%%htext = text(-7,1.050,['day ',char(string(data.reldate(1 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(1 ,:))
%%htext = text(-7,0.975,['day ',char(string(data.reldate(2 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(2 ,:))
%%htext = text(-7,0.900,['day ',char(string(data.reldate(3 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(3 ,:))
%%htext = text(-7,0.825,['day ',char(string(data.reldate(4 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(4 ,:))
%%htext = text(-7,0.750,['day ',char(string(data.reldate(5 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(5 ,:))
%%htext = text(-7,0.675,['day ',char(string(data.reldate(6 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(6 ,:))
%%htext = text(-7,0.600,['day ',char(string(data.reldate(7 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(7 ,:))
%%htext = text(-5,1.050,['day ',char(string(data.reldate(8 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(8 ,:))
%%htext = text(-5,0.975,['day ',char(string(data.reldate(9 )))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(9 ,:))
%%htext = text(-5,0.900,['day ',char(string(data.reldate(10)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(10,:))
%%htext = text(-5,0.825,['day ',char(string(data.reldate(11)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(11,:))
%%htext = text(-5,0.750,['day ',char(string(data.reldate(12)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(12,:))
%%htext = text(-5,0.675,['day ',char(string(data.reldate(13)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(13,:))
%%htext = text(-5,0.600,['day ',char(string(data.reldate(14)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(14,:))
%%htext = text(-3,1.050,['day ',char(string(data.reldate(15)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(15,:))
%%htext = text(-3,0.975,['day ',char(string(data.reldate(16)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(16,:))
%%htext = text(-3,0.900,['day ',char(string(data.reldate(17)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(17,:))
%%htext = text(-3,0.825,['day ',char(string(data.reldate(18)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(18,:))
%htext = text(-0.23 ,1.075,['day ',char(string(data.reldate(19)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(19,:))
%%htext = text(1 ,0.975,['day ',char(string(data.reldate(20)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(20,:))
%%htext = text(1 ,0.900,['day ',char(string(data.reldate(21)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(21,:))
%%htext = text(1 ,0.825,['day ',char(string(data.reldate(22)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(22,:))
%%htext = text(3 ,1.050,['day ',char(string(data.reldate(23)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(23,:))
%htext = text(-0.23 ,1.050,['day ',char(string(data.reldate(24)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(24,:))
%%htext = text(3 ,0.900,['day ',char(string(data.reldate(25)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(25,:))
%htext = text(-0.23 ,1.025,['day ',char(string(data.reldate(26)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(26,:))
%%htext = text(3 ,0.750,['day ',char(string(data.reldate(27)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(27,:))
%%htext = text(3 ,0.675,['day ',char(string(data.reldate(28)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(28,:))
%%htext = text(3 ,0.600,['day ',char(string(data.reldate(29)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(29,:))
%%htext = text(5 ,1.050,['day ',char(string(data.reldate(30)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(30,:))
%%htext = text(5 ,0.975,['day ',char(string(data.reldate(31)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(31,:))
%%htext = text(5 ,0.900,['day ',char(string(data.reldate(32)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(32,:))
%htext = text(-0.20 ,1.075,['day ',char(string(data.reldate(33)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(33,:))
%htext = text(-0.20 ,1.050,['day ',char(string(data.reldate(34)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(34,:))
%htext = text(5 ,0.675,['day ',char(string(data.reldate(35)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(35,:))
%htext = text(5 ,0.600,['day ',char(string(data.reldate(36)))],'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(36,:))

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\HbetaVelocityNarrowAbs.pdf -pdf




data.SPOL(1 ) = 0;
data.SPOL(2 ) = 0;
data.SPOL(3 ) = 0;
data.SPOL(4 ) = 1;
data.SPOL(5 ) = 1;
data.SPOL(6 ) = 1;
data.SPOL(7 ) = 1;
data.SPOL(8 ) = 0;
data.SPOL(9 ) = 0;
data.SPOL(10) = 0;
data.SPOL(11) = 0;
data.SPOL(12) = 1;
data.SPOL(13) = 0;
data.SPOL(14) = 0;
data.SPOL(15) = 1;
data.SPOL(16) = 1;
data.SPOL(17) = 1;
data.SPOL(18) = 0;
data.SPOL(19) = 1;
data.SPOL(20) = 0;
data.SPOL(21) = 0;
data.SPOL(22) = 0;
data.SPOL(23) = 1;
data.SPOL(24) = 1;
data.SPOL(25) = 1;
data.SPOL(26) = 0;
data.SPOL(27) = 0;
data.SPOL(28) = 1;
data.SPOL(29) = 1;
data.SPOL(30) = 1;
data.SPOL(31) = 0;
data.SPOL(32) = 1;
data.SPOL(33) = 0;
data.SPOL(34) = 0;
data.SPOL(35) = 0;
data.SPOL(36) = 0;




%Nickel V is on day 72.0206

MbolSun = 4.74
fluxMsun_CSS_sn2014ab_mediansubtracted = 10.^((real(absmagVCSS_sn2014ab_mediansubtracted)-MbolSun)/(-2.5))

avgfluxCSS_nick = mean(fluxMsun_CSS_sn2014ab_mediansubtracted(350:353))

mag_CSSatnick = -2.5*log10(avgfluxCSS_nick)+MbolSun

%flav%damn so similar
%(absmagVCSS_sn2014ab_mediansubtracted(350) + absmagVCSS_sn2014ab_mediansubtracted(351) + absmagVCSS_sn2014ab_mediansubtracted(352) + absmagVCSS_sn2014ab_mediansubtracted(353))/4
avgdateCSS_nick = (LCCSSreldateV_sn2014ab(350) + LCCSSreldateV_sn2014ab(351) + LCCSSreldateV_sn2014ab(352) + LCCSSreldateV_sn2014ab(353))/4

decayrate_CSS = 0.0034;
mag_CSSatnick_exact = mag_CSSatnick + decayrate_CSS * (LCreldateV_sn2014ab(1) - avgdateCSS_nick)
min(real(absmagVCSS_sn2014ab_mediansubtracted))

Bratio_CSS = 10^((min(real(absmagVCSS_sn2014ab_mediansubtracted)) - mag_CSSatnick_exact)/(-2.5))


find(min(real(absmagVCSS_sn2014ab_mediansubtracted)) == absmagVCSS_sn2014ab_mediansubtracted)

project_nickmagV = absmagV_sn2014ab(1) - 2.5 * log10(Bratio_CSS)

LCCSSreldateV_sn2014ab(find(min(real(absmagVCSS_sn2014ab_mediansubtracted)) == absmagVCSS_sn2014ab_mediansubtracted))



%211.7 days from day 0 to last Nickel point
%projected nickel peak -19.1435 to final data point -17.89

%%%light curve plot

min(real(absmagVCSS_sn2014ab_mediansubtracted))
absmagVCSS_sn2014ab_mediansubtracted(find((LCCSSreldateV_sn2014ab>-25) & (LCCSSreldateV_sn2014ab<250)))


%TDE calculation
TDEt0 = -212;
TDEttopeak = 212;
TDEdates = linspace(1,800,800);
TDEmags = project_nickmagV - 2.5 .*log10((TDEdates./TDEttopeak).^(-5/3));
TDEdatesoffset = TDEdates + TDEt0;










set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.7 0.9]);
clf
hold all
p1 = scatter(LCreldateB_sn2014ab,absmagB_sn2014ab,75,[0.0000 0.0000 1.0000],'filled')
errorbar(LCreldateB_sn2014ab,absmagB_sn2014ab,magerrorB_sn2014ab,'Color',[0.0000 0.0000 1.0000])
p2 = scatter(LCreldateV_sn2014ab,absmagV_sn2014ab,75,[0.0000 0.7255 0.0902],'filled')
errorbar(LCreldateV_sn2014ab,absmagV_sn2014ab,magerrorV_sn2014ab,'Color',[0.0000 0.7255 0.0902])
p3 = scatter(LCreldateR_sn2014ab,absmagR_sn2014ab,75,[1.0000 0.0000 0.0000],'filled')
errorbar(LCreldateR_sn2014ab,absmagR_sn2014ab,magerrorR_sn2014ab,'Color',[1.0000 0.0000 0.0000])
p4 = scatter(LCreldateI_sn2014ab,absmagI_sn2014ab,75,[0 0 0],'filled')
errorbar(LCreldateI_sn2014ab,absmagI_sn2014ab,magerrorI_sn2014ab,'Color',[0 0 0])
p5 = scatter(LCCSSreldateV_sn2014ab(find((LCCSSreldateV_sn2014ab>-25) & (LCCSSreldateV_sn2014ab<250))),absmagVCSS_sn2014ab_mediansubtracted(find((LCCSSreldateV_sn2014ab>-25) & (LCCSSreldateV_sn2014ab<250))),75,'s','MarkerFaceColor',[0.0000 0.3922 0.0039],'MarkerEdgeColor',[0.0000 0.3922 0.0039])
errorbar(LCCSSreldateV_sn2014ab(find((LCCSSreldateV_sn2014ab>-25) & (LCCSSreldateV_sn2014ab<250))),absmagVCSS_sn2014ab_mediansubtracted(find((LCCSSreldateV_sn2014ab>-25) & (LCCSSreldateV_sn2014ab<250))),magerrorVCSS_sn2014ab(find((LCCSSreldateV_sn2014ab>-25) & (LCCSSreldateV_sn2014ab<250))),'Color',[0.0000 0.3922 0.0039])
p6 = scatter(LCCSSreldateV_sn2014ab,absmagVCSS_sn2014ab,75,'s','MarkerFaceColor',[0.65 0.65 0.65],'MarkerEdgeColor',[0.65 0.65 0.65])
errorbar(LCCSSreldateV_sn2014ab,absmagVCSS_sn2014ab,magerrorVCSS_sn2014ab,'Color',[0.65 0.65 0.65],'LineStyle','-')
plot([LCCSSreldateV_sn2014ab(find(min(real(absmagVCSS_sn2014ab_mediansubtracted)) == absmagVCSS_sn2014ab_mediansubtracted)) LCreldateV_sn2014ab(1)], [project_nickmagV absmagV_sn2014ab(1)],'--','Color',[0.0000 0.7255 0.0902])
scatter([LCCSSreldateV_sn2014ab(find(min(real(absmagVCSS_sn2014ab_mediansubtracted)) == absmagVCSS_sn2014ab_mediansubtracted))], [project_nickmagV],50,[0.0000 0.7255 0.0902])
plot(TDEdatesoffset,TDEmags,'--','Color',[0.5 0.5 0.5])


for i = 1:length(data.reldate)
	if(data.SPOL(i) == 1)
		line([data.reldate(i),data.reldate(i)],[-18.0 -17.85],'LineStyle','-','Color',[0 0 0],'LineWidth',1)
	else
		line([data.reldate(i),data.reldate(i)],[-17.75 -17.6],'LineStyle','-','Color',[0 0 0],'LineWidth',1)
	end
end
htext = text(-350,-20.2,'SN 2014ab','interpreter','latex','Color', 'black','FontSize',22)
htext = text(90,-18.65,'B','interpreter','latex','Color', [0.0000 0.0000 1.0000],'FontSize',22)
htext = text(90,-19.01,'V','interpreter','latex')
set(htext, 'Color', [0.0000 0.7255 0.0902])
set(htext, 'FontSize',22)
htext = text(105,-19.42,'R','interpreter','latex')
set(htext, 'Color', [1.0000 0.0000 0.0000])
set(htext, 'FontSize',22)
htext = text(95,-19.55,'I','interpreter','latex')
set(htext, 'Color', 'black')
set(htext, 'FontSize',22)
htext = text(-10,-19.63,'CSS (V) ','interpreter','latex')
set(htext, 'Color',[0.0000 0.3922 0.0039])
set(htext, 'FontSize',22)
htext = text(150,-20.10,'CSS (V) host galaxy included','interpreter','latex')
set(htext, 'Color',[0.65 0.65 0.65])
set(htext, 'FontSize',22)
htext = text(-70,-18.5,'TDE Decline $t^{-\frac{5}{3}}$','interpreter','latex','FontName','CMU Serif Roman')
set(htext, 'Color',[0.5 0.5 0.5])
set(htext, 'FontSize',22)

xlabel('Days Relative to Discovery Date','interpreter','tex','FontSize',24,'FontName','CMU Serif Roman')
ylabel('Absolute Magnitude','interpreter','tex','FontSize',24,'FontName','CMU Serif Roman')
%title('', 'FontSize', 22)
axis([[-400 400] [-20.5 -17.5]])
ax1 = gca;
set(gca,'XMinorTick','on','YMinorTick','on')
set(ax1,'xtick',linspace(-400,400,17),'YTick',linspace(-20,-15,6))
atick=get(gca,'TickLength');
atick(1) = atick(1)*5;
set(gca,'YDir','reverse');
ax2 = axes('Position',get(ax1,'Position'),'YAxisLocation','right','XAxisLocation','top','Color','none');
%set(ax2,'xtick',get(ax1,'xtick'),'xticklab',get(ax1,'xticklab'))
ylabel(ax2,'')
xlabel(ax2,'')
set(ax2,'xtick',[],'YTick',[])
set(ax1,'FontSize',20)
set(ax2,'FontSize',20)
annotation('textarrow',[0.535 0.565],[0.155 0.155],'String','Spectra','FontSize',22)
annotation('textarrow',[0.555 0.585],[0.225 0.225],'String','Spectropolarimetry','FontSize',22)
[~, objh] = legend([p4 p6 ],'Nickel Telescope','CSS')
objhl = findobj(objh, 'type', 'patch'); %// objects of legend of type line
set(objhl, 'Markersize', 16); %// set marker size as desired


%saveas(plotting, ['C:\Users\Cbilinski\Desktop\Figures\SN2014ab\Photometry.eps'], 'epsc');
%eval(['!epstopdf C:\Users\Cbilinski\Desktop\Figures\SN2014ab\Photometry.eps']);

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\Photometry.pdf







%Condensed Full Spectrum Plot
set(plotting,'units','normalized','outerposition',[0 0 0.8 1]);
clf
l1 = semilogy(wave_2014ab_NTT_ep1,      flux_2014ab_NTT_ep1,                'LineWidth',2,'Color',[0.0000 0.3922 0.0039])
hold on
l13= semilogy(wave_2014ab_VLT_ep78,     6^-1*2*  8* flux_2014ab_VLT_ep78,     'LineWidth',2,'Color',[0.9961 0.5373 0.0000])
l2 = semilogy(wave_2014ab_Lic_ep15,     6^-2 *   1 * flux_2014ab_Lic_ep15,     'LineWidth',2,'Color',[0.0000 0.0000 1.0000])
l3 = semilogy(wave_2014ab_Bok_ep20_24,  6^-3 *   1 * flux_2014ab_Bok_ep20_24,  'LineWidth',2,'Color',[1.0000 0.0000 0.0000])
l4 = semilogy(wave_2014ab_LCO_ep30_33,  6^-4 *   1.3 * flux_2014ab_LCO_ep30_33,  'LineWidth',2,'Color',[0.5843 0.0000 0.2275])
l23= semilogy(wave_2014ab_MMT_ep30,     6^-5 *   1.2 *  flux_2014ab_MMT_ep30,    'LineWidth',2,'Color',[0.5686 0.8157 0.7961])
l5 = semilogy(wave_2014ab_LCO_ep42_45,  6^-6 *   1.5 * flux_2014ab_LCO_ep42_45,  'LineWidth',2,'Color',[0.5843 0.0000 0.2275])
l15= semilogy(wave_2014ab_VLT_ep85,     6^-7*2* 15* flux_2014ab_VLT_ep85,     'LineWidth',2,'Color',[0.9961 0.5373 0.0000])
l6 = semilogy(wave_2014ab_Kui_ep48_53,  6^-8 *   2 * flux_2014ab_Kui_ep48_53,  'LineWidth',2,'Color',[0.0000 0.7255 0.0902])
l7 = semilogy(wave_2014ab_Lic_ep52,     6^-9 *   3.5 * flux_2014ab_Lic_ep52,     'LineWidth',2,'Color',[0.0000 0.0000 1.0000])
%l8 = semilogy(wave_2014ab_Kui_ep53 ,   6^-7 *   2 * flux_2014ab_Kui_ep53,     'LineWidth',2,'Color',[0.0000 0.7255 0.0902])
l9 = semilogy(wave_2014ab_LCO_ep59,     6^-10 *   4 * flux_2014ab_LCO_ep59,     'LineWidth',2,'Color',[0.5843 0.0000 0.2275])
l10= semilogy(wave_2014ab_Mag_ep71 ,    6^-11 *3* 2 * flux_2014ab_Mag_ep71,     'LineWidth',2,'Color',[0.4941 0.1765 0.8235])
l11= semilogy(wave_2014ab_LCO_ep74,     6^-12*2.9* 1 * flux_2014ab_LCO_ep74,     'LineWidth',2,'Color',[0.5843 0.0000 0.2275])
l12= semilogy(wave_2014ab_Bok_ep75_78,  6^-13*2* 1.45 * flux_2014ab_Bok_ep75_78,  'LineWidth',2,'Color',[1.0000 0.0000 0.0000])
l14= semilogy(wave_2014ab_Lic_ep80,     6^-14*2* 1.45 * flux_2014ab_Lic_ep80,     'LineWidth',2,'Color',[0.0000 0.0000 1.0000])

l16= semilogy(wave_2014ab_Lic_ep104,    6^-15*2* 3 * flux_2014ab_Lic_ep104,    'LineWidth',2,'Color',[0.0000 0.0000 1.0000])

l17= semilogy(wave_2014ab_Kui_ep105_109,6^-16*2* 2.5 * flux_2014ab_Kui_ep105_109,'LineWidth',2,'Color',[0.0000 0.7255 0.0902])
l19= semilogy(wave_2014ab_VLT_ep135,    6^-17*2* 16* flux_2014ab_VLT_ep135,    'LineWidth',2,'Color',[0.9961 0.5373 0.0000])
l22= semilogy(wave_2014ab_VLT_ep136,    6^-18*2* 22* flux_2014ab_VLT_ep136,    'LineWidth',2,'Color',[0.9961 0.5373 0.0000])
l18= semilogy(wave_2014ab_Lic_ep113,    6^-19*2* 0.80 * flux_2014ab_Lic_ep113,    'LineWidth',2,'Color',[0.0000 0.0000 1.0000])
l20= semilogy(wave_2014ab_VLT_ep152,    6^-20*2* 4 * flux_2014ab_VLT_ep152,    'LineWidth',2,'Color',[0.9961 0.5373 0.0000])
l21= semilogy(wave_2014ab_MMT_ep1497,   6^-21*4* 1 * flux_2014ab_MMT_ep1497,   'LineWidth',2,'Color',[1.0000 0.0000 0.9647])
  

line([4101 4101],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([4340 4340],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([4861 4861],[0.55 0.85],'LineStyle','-','Color',[0 0 0])
line([4959 4959],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([5007 5007],[0.5 0.8],'LineStyle','-','Color',[0 0 0])
line([5876 5876],[0.2 0.35],'LineStyle','-','Color',[0 0 0])
line([5896 5896],[0.2 0.35],'LineStyle','-','Color',[0 0 0])
%line([6548 6548],[9.5 11.5],'LineStyle','-','Color',[0 0 0])
line([6562.81 6562.81],[1.3 2.3],'LineStyle','-','Color',[0 0 0])
%line([6583 6583],[9.5 11.5],'LineStyle','-','Color',[0 0 0])
%line([6717 6717],[0.5 1],'LineStyle','-','Color',[0 0 0])
%line([6731 6731],[0.5 1],'LineStyle','-','Color',[0 0 0])
htext = text(4101,0.9,'H\delta','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(4340,0.9,'H\gamma','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(4861,0.95,'H\beta','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(4983,0.9,'[OIII]','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(5876-22,0.4,'HeI\lambda5876','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
htext = text(5896+22,0.4,'NaID','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
%htext = text(6565.5,11.5,'[NII]','FontName','CMU Serif Roman')
%set(htext, 'rotation', 90)
%set(htext, 'FontSize',15)
htext = text(6562.81,2.5,'H\alpha','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',15)
%htext = text(6724,1.1,'[SII]','FontName','CMU Serif Roman')
%set(htext, 'rotation', 90)
%set(htext, 'FontSize',15)
htext = text(6754,0.22,'$\bigoplus$','interpreter','latex','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',12)
htext = text(7430,0.22,'$\bigoplus$','interpreter','latex','FontName','CMU Serif Roman')
set(htext, 'rotation', 90)
set(htext, 'FontSize',12)
htext = text(7050,5,'SN 2014ab','interpreter','latex','FontName','CMU Serif')
set(htext, 'Color', 'black')	
set(htext, 'FontSize',26)
htext  = text(6950,0.8 *2*6^-1 ,'day 57'       ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.3922 0.0039])
htext  = text(6950,1.6 *1*6^-2,'day 70'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.9961 0.5373 0.0000])
htext  = text(6950,0.8 *2*6^-3 ,'day 71'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.0000 1.0000])
htext  = text(6950,0.8 *2*6^-4 ,'days 76-80'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[1.0000 0.0000 0.0000])
htext  = text(6950,1.0 *2*6^-5 ,'days 86-89'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.5843 0.0000 0.2275])
htext  = text(6950,1.0 *2*6^-6 ,'day 90'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.5686 0.8157 0.7961])
htext  = text(6950,1.3 *2*6^-7 ,'days 98-101'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.5843 0.0000 0.2275])
htext  = text(6950,1.5 *2*6^-8,'day 102'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.9961 0.5373 0.0000])
htext  = text(6950,1.3 *2*6^-9 ,'days 104-109'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.7255 0.0902])
htext  = text(6950,2.1 *2*6^-10 ,'day 108'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.0000 1.0000])
%htext = text(6950,1.3 *2*6^-8 ,'day '      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.7255 0.0902])
htext  = text(6950,2.2*2*6^-11 ,'day 115'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.5843 0.0000 0.2275])
htext  = text(6950,2.1 *2*6^-12,'day 127'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.4941 0.1765 0.8235])
htext  = text(6950,1.4 *2*6^-13,'day 130'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.5843 0.0000 0.2275])
htext  = text(6950,1.6 *2*6^-14,'days 131-134'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[1.0000 0.0000 0.0000])
htext  = text(6950,2.3 *2*6^-15,'day 136'      ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.0000 1.0000])
htext  = text(6950,2.8*2*6^-16,'day 160'     ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.0000 1.0000])
htext  = text(6950,2.3*2*6^-17,'days 161-165','FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.7255 0.0902])
htext  = text(6950,2*2*6^-18,'day 163'     ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.9961 0.5373 0.0000])
htext  = text(6950,1.1*2*6^-19,'day 168'     ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.9961 0.5373 0.0000])
htext  = text(6950,1.0 *2*6^-20,'day 169'     ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.0000 0.0000 1.0000])
htext  = text(6950,1.1*2*6^-21,'day 188'     ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[0.9961 0.5373 0.0000])
htext  = text(6950,1.1*1.5*6^-22,'day 1553'  ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',15,'Color',[1.0000 0.0000 0.9647])
htext  = text(2965,0.1,'.','interpreter','latex','FontName','CMU Serif Roman')
set(htext, 'Color',[0.8 0.8 0.8])
legend([l1, l2, l3, l6, l10, l13, l4, l23, l21],'ESO-NTT','Lick-Kast','Bok-SPOL','Kuiper-SPOL', 'Magellan-IMACS', 'ESO-VLT','LCO-Floyds','MMT-SPOL','MMT-BC')

xlabel('Rest Wavelength ($\AA$) ','interpreter','latex','FontSize',24,'FontName','CMU Serif Roman')
ylabel('$F_\lambda$ (Scaled)','interpreter','latex','FontSize',24,'FontName','CMU Serif Roman')
axis([[3400 10000] [10^-18*2 250]])
ax1 = gca;
ax2 = axes('Position',get(ax1,'Position'),'YAxisLocation','right','XAxisLocation','top','Color','none');
ylabel(ax2,'','FontSize',22)
xlabel(ax2,'')
set(ax2,'xtick',[],'YTick',[])
set(ax1,'FontSize',22)
set(ax2,'FontSize',22)
set(ax1,'XMinorTick','on','YMinorTick','on')

export_fig C:\Users\Cbilinski\Desktop\Figures\SN2014ab\FullSpectrum.pdf
set(plotting,'units','normalized','outerposition',[0 0 1 1]);

saveas(plotting, ['C:\Users\Cbilinski\Desktop\Figures\SN2014ab\FullSpectrum.eps'], 'epsc');
eval(['!epstopdf C:\Users\Cbilinski\Desktop\Figures\SN2014ab\FullSpectrum.eps']);













































%crap


%highres halpha hbeta and paschenbeta narrow absorption
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 2.5 1.25]);
clf
hold all
axis([[-0.5 5] [-0.1 1.1]])
for i=1:size(data.wave_dez,2)
	if(isfield(data.align_halpha.multiplier{i},'highres'))





for i=1:size(data.wave_dez_aligned_halpha,2)
	%handle exceptions
	if (i ==size(data.wave_dez_aligned_halpha,2))
		plot(data.velHalpha{end}/1000,data.flux_norm_lowrespeak_halpha{end},'LineWidth',2,'Color',data.color(i,:));
	else
		plot(data.velHalpha{i}/1000,data.flux_norm_lowrespeak_halpha{i},'LineWidth',2,'Color',data.color(i,:));
		%htext = text(-7,1.2,'day 1'       ,'FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',data.color(i,:))
		%pause(0.1);
	end
end
box on
line([-8 8],[0 0],'LineStyle','--','Color',[0 0 0],'LineWidth',3)
line([0 0],[-1 10],'LineStyle','--','Color',[0 0 0],'LineWidth',3)

xlabel('Doppler velocity (10^3 km/s)','FontSize',32,'FontName','CMU Serif Roman')
ylabel('F_{\lambda}(Scaled)','interpreter','tex','FontSize',32,'FontName','CMU Serif Roman')

htext = text(-6,0.5,'SN 2014ab','FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',[0 0 0])
htext = text(-6,0.4,'H$\alpha$','FontName','CMU Serif Roman','interpreter','latex','FontSize',24,'Color',[0 0 0])
ax1 = gca;
set(ax1,'FontSize',28)
set(ax1,'XMinorTick','on','YMinorTick','on')







%%Finding the narrow line offset, only run before narrow line calibration is applied so it is commented out now.
%%narrow Halpha velocity
clf
plot(velHalpha_20140519_1(find(d20140519_sn2014ab_1(1,:)>6163 & d20140519_sn2014ab_1(1,:)<6963))/10^3,halphavarscaledsub20140519_sn2014ab_1(find(d20140519_sn2014ab_1(1,:)>6163 & d20140519_sn2014ab_1(1,:)<6963))./max(halphavarscaledsub20140519_sn2014ab_1(find(d20140519_sn2014ab_1(1,:)>6163 & d20140519_sn2014ab_1(1,:)<6963))),'LineWidth',3,'Color',[0.5714         0    1.0000])
hold all                                                                                              
plot(velHalpha_20140526_2(find(d20140526_sn2014ab_2(1,:)>6163 & d20140526_sn2014ab_2(1,:)<6963))/10^3,halphavarscaledsub20140526_sn2014ab_2(find(d20140526_sn2014ab_2(1,:)>6163 & d20140526_sn2014ab_2(1,:)<6963))./max(halphavarscaledsub20140526_sn2014ab_2(find(d20140526_sn2014ab_2(1,:)>6163 & d20140526_sn2014ab_2(1,:)<6963))),'LineWidth',3,'Color',[1.0000         0    0.6667])
plot(velHalpha_20140602_1(find(d20140602_sn2014ab_1(1,:)>6163 & d20140602_sn2014ab_1(1,:)<6963))/10^3,halphavarscaledsub20140602_sn2014ab_1(find(d20140602_sn2014ab_1(1,:)>6163 & d20140602_sn2014ab_1(1,:)<6963))./max(halphavarscaledsub20140602_sn2014ab_1(find(d20140602_sn2014ab_1(1,:)>6163 & d20140602_sn2014ab_1(1,:)<6963))),'LineWidth',3,'Color',[1.0000         0    0.3333])
plot(velHalpha_20140722_1(find(d20140722_sn2014ab_1(1,:)>6163 & d20140722_sn2014ab_1(1,:)<6963))/10^3,halphavarscaledsub20140722_sn2014ab_1(find(d20140722_sn2014ab_1(1,:)>6163 & d20140722_sn2014ab_1(1,:)<6963))./max(halphavarscaledsub20140722_sn2014ab_1(find(d20140722_sn2014ab_1(1,:)>6163 & d20140722_sn2014ab_1(1,:)<6963))),'LineWidth',3,'Color',[0.1667         0         0])
plot(velHalpha_20140808_1(find(d20140808_sn2014ab_1(1,:)>6163 & d20140808_sn2014ab_1(1,:)<6963))/10^3,halphavarscaledsub20140808_sn2014ab_1(find(d20140808_sn2014ab_1(1,:)>6163 & d20140808_sn2014ab_1(1,:)<6963))./max(halphavarscaledsub20140808_sn2014ab_1(find(d20140808_sn2014ab_1(1,:)>6163 & d20140808_sn2014ab_1(1,:)<6963))),'LineWidth',3,'Color',[     0         0         0])
plot(velHalpha_20180414_1(find(d20180414_sn2014ab_1(1,:)>6163 & d20180414_sn2014ab_1(1,:)<6963))/10^3,halphavarscaledsub20180414_sn2014ab_1(find(d20180414_sn2014ab_1(1,:)>6163 & d20180414_sn2014ab_1(1,:)<6963))./max(halphavarscaledsub20180414_sn2014ab_1(find(d20180414_sn2014ab_1(1,:)>6163 & d20180414_sn2014ab_1(1,:)<6963))),'LineWidth',3,'Color',[     0         0         0])

line([0 0],[-1 1],'LineStyle','--','Color',[0 0 0],'LineWidth',1)
axis([[-5 5] [0 1]])








