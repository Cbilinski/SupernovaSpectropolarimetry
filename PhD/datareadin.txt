%initialize
clear all
close all
data(1).wave = 0;
plotting = figure;
set(gcf,'color','w');
set(plotting,'units','normalized','outerposition',[0 0 1 1]);
set(plotting,'PaperUnits','normalized','PaperPosition',[0 0 3 1]);
set(gcf,'renderer','painters')
colormap jet

%1996.70 +2456000 -2400000.5

%constants
contrange = [5100 5700];
contrange(2,:) = [6000 6300];
%contrange(3,:) = [6562-200 6562+200];
lambdaHalpha = 6562.81;
lambdaHbeta = 4861.35;
lambdaHeI5876 = 5876;
c=3*10^10;
offsetfactorforMW=5;
FWheight=1.2;
jdtomjd=-2400000.5;

z_SN2010jl = 0.010697  ;
z_SN2011cc = 0.031895  ;
z_SN2011ht = 0.003646  ;
z_SN2012ab = 0.018     ;
z_PTF11iqb = 0.012499  ;
z_SN2009ip = 0.005944  ;
z_SN2014ab= 0.023203   ;
z_ASASSN14il = 0.021989;
%my narrow line fit for M04421
z_MJ044212 = 0.017171084098077      ;
z_SN2015da    = 0.007222 ;
z_SN2015bh = 0.006494  ;
z_J02331624 = 0.0135   ;
%my narrow line fit for SN2017gas
z_SN2017gas  = 0.010552741104298    ;
z_SN2017hcc = 0.0173   ;
%rerun with 0.0168 for hcc zzz if we do reruns
z_SN2018zd = 0.002979  ;

discoverydatejd_SN2010jl       = juliandate(2010,11,02.06       );
discoverydatejd_SN2011cc       = juliandate(2011,03,17.520      );
discoverydatejd_SN2011ht       = juliandate(2011,09,29.182      );
discoverydatejd_SN2012ab       = juliandate(2012,01,31.350      );
discoverydatejd_PTF11iqb       = juliandate(  2011,07,23.41     );
discoverydatejd_SN2009ip       = juliandate(2012,07,24.0        );
discoverydatejd_SN2014ab       = juliandate(2014,01,12.4755);
discoverydatejd_ASASSN14il     = juliandate(     2014,10,01.110 );
discoverydatejd_MJ044212       = juliandate( 2014,09,20.813     );
discoverydatejd_SN2015da       = juliandate(   2015,01,09.897   );
discoverydatejd_SN2015bh       = juliandate(  2015,02,07.390    );
discoverydatejd_J02331624      = juliandate(   2015,08,20.439   );
discoverydatejd_SN2017gas      = juliandate(   2017,08,10.400   );
discoverydatejd_SN2017hcc      = juliandate(   2017,10,02.378   );
discoverydatejd_SN2018zd       = juliandate(  2018,03,01.410    );

%discoverydatejd_SN1997eg = juliandate(1997,12,4)
%peakmagdatejd_SN1997eg = 

%https://sne.space/sne/SN2010jl/ V
%peakmagdatejd_SN2010jl       = 55516.25-jdtomjd;
%ref https://iopscience.iop.org/article/10.1088/0004-637X/730/1/34/pdf for better V band peak estimate
peakmagdatejd_SN2010jl       = 5488.12+2450000;
%https://sne.space/sne/SN2011cc/ R https://ui.adsabs.harvard.edu/abs/2014ApJ...789..104O
peakmagdatejd_SN2011cc       = 55757.32-jdtomjd;
%https://sne.space/sne/SN2011ht/ V
peakmagdatejd_SN2011ht       = 55888.37-jdtomjd;
%https://sne.space/sne/SN2012ab/ R
peakmagdatejd_SN2012ab       = 55984.28-jdtomjd;
%https://sne.space/sne/PTF11iqb/ R
peakmagdatejd_PTF11iqb       = 55776.46-jdtomjd;
%https://sne.space/sne/SN2009ip/ R
peakmagdatejd_SN2009ip       = 56207.22-jdtomjd;
%earliest data from my paper V
peakmagdatejd_SN2014ab       = juliandate(2014,01,12.4755);
%SLOTIS EMAIL from Peter
peakmagdatejd_ASASSN14il     = 56971.70-jdtomjd;
%http://slotis.kpno.noao.edu/LOTIS/TARGETS/M044212.html R
peakmagdatejd_MJ044212       = 955.00+2456000;
%http://slotis.kpno.noao.edu/LOTIS/TARGETS/PSN13522.html R
peakmagdatejd_SN2015da       = 1162.70+2456000;
%https://sne.space/sne/SN2015bh/ R
peakmagdatejd_SN2015bh       = 57166.32-jdtomjd;
%https://sne.space/sne/PS15cwt/ i GPC, have SLOTIS data, but it comes later
peakmagdatejd_J02331624      = 57237.51-jdtomjd;
%http://slotis.kpno.noao.edu/LOTIS/TARGETS/17gas.html R
peakmagdatejd_SN2017gas      = 1996.70 +2456000;
%http://slotis.kpno.noao.edu/LOTIS/TARGETS/17hcc.html R
peakmagdatejd_SN2017hcc      = 2091.60 +2456000;
% SN~2017hcc
%peakJD = 2458054.5 in other text file?

%2010jl is V pm 0.1
peakmag_SN2010jl = 13.67;
%2011cc is R pm 0.02
peakmag_SN2011cc    = 16.913;
%2011ht is V pm 0.06
peakmag_SN2011ht    = 14.210;
%2012ab is R pm 0.03
peakmag_SN2012ab   = 15.320;
%PTF11iqb is R pm 0.02
peakmag_PTF11iqb  = 15.049;
%2009ip is R pm 0.10
peakmag_SN2009ip  = 13.640
%2014ab is V pm 0.06
peakmag_SN2014ab = 15.84;
%ASASSN14il is V pm 0.05
peakmag_ASASSN14il = 14.74;
%M04421 is R pm 0.019
peakmag_MJ044212 = 15.31;
%2015da is R pm 0.455
peakmag_SN2015da = 15.04;
%2015bh is  R pm 0.02
peakmag_SN2015bh = 15.14;
%J02331 is i pm 0.03
peakmag_J02331624 = 18.34;
%2017gas is R pm 0.008
peakmag_SN2017gas = 14.70;
%2017hcc is R pm 0.016
peakmag_SN2017hcc = 12.99;


%calculations for NaID table
%peakmagdatejd_SN2010jl-juliandate(2010,11,07)
%peakmagdatejd_SN2015bh-juliandate(2015,06,04)
%peakmagdatejd_SN2017hcc-juliandate(2017,10,25)


A_V_SN2010jl        = 0.075;
A_V_SN2011cc        = 0.028;
A_V_SN2011ht        = 0.029;
A_V_SN2012ab        = 0.057;
A_V_PTF11iqb        = 0.088;
A_V_SN2009ip        = 0.054;
A_V_SN2014ab        = 0.083;
A_V_ASASSN14il      = 0.061;
A_V_MJ044212        = 1.091;
A_V_SN2015da        = 0.039;
A_V_SN2015bh        = 0.062;
A_V_J02331624       = 0.281;
A_V_SN2017gas       = 1.066;
A_V_SN2017hcc       = 0.091;
%A_V_SN2018zd        = 0.258;

A_R_SN2010jl        = 0.059;
A_R_SN2011cc        = 0.022;
A_R_SN2011ht        = 0.023;
A_R_SN2012ab        = 0.045;
A_R_PTF11iqb        = 0.070;
A_R_SN2009ip        = 0.043;
A_R_SN2014ab        = 0.066;
A_R_ASASSN14il      = 0.048;
A_R_MJ044212        = 0.863;
A_R_SN2015da        = 0.031;
A_R_SN2015bh        = 0.049;
A_R_J02331624       = 0.222;
A_R_SN2017gas       = 0.844;
A_R_SN2017hcc       = 0.072;
%A_R_SN2018zd        = ;

discoverymag_SN2010jl       = 13.5;
discoverymag_SN2011cc       = 17.7;
discoverymag_SN2011ht       = 17.0;
discoverymag_SN2012ab       = 15.8;
discoverymag_PTF11iqb       = 16.8;
discoverymag_SN2009ip       = 16.8;
discoverymag_SN2014ab       = 16.4;
discoverymag_ASASSN14il     = 16.5;
discoverymag_MJ044212       = 15.4;
discoverymag_SN2015da       = 16.9; %uf
discoverymag_SN2015bh       = 19.9; %V
discoverymag_J02331624      = 16.2; %u
discoverymag_SN2017gas      = 16; %V
discoverymag_SN2017hcc      = 17.44; %orange


redshiftdistance_SN2010jl    = 48.8;
redshiftdistance_SN2011cc    = 137.5;
redshiftdistance_SN2011ht    = 20.4;
redshiftdistance_SN2012ab    = 82.3;
redshiftdistance_PTF11iqb    = 50.2;
redshiftdistance_SN2009ip    = 25.8;
redshiftdistance_SN2014ab    = 104.4;
redshiftdistance_ASASSN14il  = 88.5;
redshiftdistance_MJ044212    = 71.5;
redshiftdistance_SN2015da    = 37.0;
redshiftdistance_SN2015bh    = 31.3;
redshiftdistance_J02331624   = 60.36;
redshiftdistance_SN2017gas   = 54.5;
redshiftdistance_SN2017hcc   = 73;


A_V_NaID_SN2014ab        = 0.1756;
A_V_NaID_SN2012ab        = 0.1858;
A_V_NaID_SN2015da        = 0.97*3.1;
A_V_NaID_SN2015bh        = 0.21*3.1;
%from Nathan's upcoming paper
A_V_NaID_SN2017hcc       = 0.016 *3.1;
A_V_NaID_SN2010jl        = 0.03*3.1;

A_V_NaID_ASASSN14il      = 1.404580343883875; %using both lines 1.414526734843207
A_V_NaID_MJ044212        = 0; %errors > estimates, so we just use upper limit on ISP, but not in A_V
A_V_NaID_SN2011cc        = 0.218485704758738; %error near the value of the estimates, but slightly below, so we use
A_V_NaID_SN2011ht        = 0.089312440068558; %D2 line is deeply entrenched in another absorption line, so we estimate by D1 alone instead
A_V_NaID_SN2017gas       = 1.395917396649360; %strong good lines, technically slightly different after redshift change, 1.389943641519506
A_V_NaID_SN2009ip        = 0.045880296216005; %error on D1 > measurement of D1, so we use only D2, very weak lines but maybe something here
A_V_NaID_J02331624       = 0; %low resolution with no clear lines, using noise estimates to place upper limit on ISP but not remove A_V_NaID
A_V_NaID_PTF11iqb        = 0.058869590972217; %two absorption lines seem present, but with much larger offset than expected, using only first line as estimate of blend of both lines, barely above the noise level
%A_V_NaID_SN2018zd        = 0.1021;

%E_B-V calculation of error limits to ISP 10^(1.17*(0.326382700129297+0.650873576017897)-1.85) for M04421
%E_B-V calculation of error limits to ISP 10^(1.17*(0.767107894647221+0.686428531832896)-1.85) for J02331
%E_B-V 10^(1.17*(0.109854123501329)-1.85) for PTF11iqb

%E_B-V calculation of error limits to ISP 10^(1.17*(0.107456459826736+0.214290065760055)-1.85) for M04421
%E_B-V calculation of error limits to ISP 10^(1.17*(0.112120111702907+0.100328055808317)-1.85) for J02331


%reddening constraint on ISP from NaID
%from my papers
ISP_SN2014ab = 0.7498;
ISP_SN2012ab = 0.71;
%reddening constraint on ISP from Tartaglia's paper with multiple constraints https://ui.adsabs.harvard.edu/abs/2020A%26A...635A..39T/abstract
ISP_SN2015da  = 0.97*9;
%reddening constraint on ISP from Elias-Rosa's paper https://ui.adsabs.harvard.edu/abs/2016MNRAS.463.3894E/abstract , but the citation to Thone's paper does not show the calculation nor the result actually https://ui.adsabs.harvard.edu/abs/2017A%26A...599A.129T/abstract
ISP_SN2015bh  = 0.21*9;
%reddening constraint on ISP from Brajesh's paper https://ui.adsabs.harvard.edu/abs/2019MNRAS.488.3089K/abstract but we actually use the value from Nathan's paper on 2017hcc with high resolution data
ISP_SN2017hcc = A_V_NaID_SN2017hcc*9/3.1;
%reddening constraint on ISP from Patat's paper https://ui.adsabs.harvard.edu/abs/2011A%26A...527L...6P/abstract
ISP_SN2010jl  = 0.03*9;

%%%use NaID estimate code
ISP_ASASSN14il= A_V_NaID_ASASSN14il*9/3.1;
ISP_MJ044212  = 0.104184983856791*9/3.1;
ISP_SN2011cc = A_V_NaID_SN2011cc*9/3.1;
%reddening constraint on ISP from Roming's paper https://iopscience.iop.org/article/10.1088/0004-637X/751/2/92/pdf is negligible, using NaID from our spectra instead to get:
ISP_SN2011ht = A_V_NaID_SN2011ht*9/3.1;
ISP_SN2017gas = A_V_NaID_SN2017gas*9/3.1;
%reddening constraint on ISP from Jon's paper https://ui.adsabs.harvard.edu/abs/2014MNRAS.442.1166M/abstract is negligible
ISP_SN2009ip  = A_V_NaID_SN2009ip*9/3.1;
%no J02331624 highres data, just using bok spol noise and resolution
ISP_J02331624 = 0.077611495117977*9/3.1;
%no reddening from Nathan's paper
ISP_PTF11iqb  = 0.018990190636199*9;
%not used
%reddening constraint on ISP from NaID
%ISP_SN2018zd  = 1.0523;


%1998S NaID shivvers 1998S paper zzz



redshiftdistancemodulus_SN2010jl     = -5*(log10(redshiftdistance_SN2010jl  *10^6)-1);
redshiftdistancemodulus_SN2011cc     = -5*(log10(redshiftdistance_SN2011cc  *10^6)-1);
redshiftdistancemodulus_SN2011ht     = -5*(log10(redshiftdistance_SN2011ht  *10^6)-1);
redshiftdistancemodulus_SN2012ab     = -5*(log10(redshiftdistance_SN2012ab  *10^6)-1);
redshiftdistancemodulus_PTF11iqb     = -5*(log10(redshiftdistance_PTF11iqb  *10^6)-1);
redshiftdistancemodulus_SN2009ip     = -5*(log10(redshiftdistance_SN2009ip  *10^6)-1);
redshiftdistancemodulus_SN2014ab     = -5*(log10(redshiftdistance_SN2014ab  *10^6)-1);
redshiftdistancemodulus_ASASSN14il   = -5*(log10(redshiftdistance_ASASSN14il*10^6)-1);
redshiftdistancemodulus_MJ044212     = -5*(log10(redshiftdistance_MJ044212  *10^6)-1);
redshiftdistancemodulus_SN2015da     = -5*(log10(redshiftdistance_SN2015da  *10^6)-1);
redshiftdistancemodulus_SN2015bh     = -5*(log10(redshiftdistance_SN2015bh  *10^6)-1);
redshiftdistancemodulus_J02331624    = -5*(log10(redshiftdistance_J02331624 *10^6)-1);
redshiftdistancemodulus_SN2017gas    = -5*(log10(redshiftdistance_SN2017gas *10^6)-1);
redshiftdistancemodulus_SN2017hcc    = -5*(log10(redshiftdistance_SN2017hcc *10^6)-1);


%% need to change A_V to A_R in some cases if we want to use this
%discoveryabsmag_SN2010jl       =discoverymag_SN2010jl    +redshiftdistancemodulus_SN2010jl       -A_V_SN2010jl  -A_V_NaID_SN2010jl  
%discoveryabsmag_SN2011cc       =discoverymag_SN2011cc    +redshiftdistancemodulus_SN2011cc       -A_V_SN2011cc  -A_V_NaID_SN2011cc  
%discoveryabsmag_SN2011ht       =discoverymag_SN2011ht    +redshiftdistancemodulus_SN2011ht       -A_V_SN2011ht  -A_V_NaID_SN2011ht  
%discoveryabsmag_SN2012ab       =discoverymag_SN2012ab    +redshiftdistancemodulus_SN2012ab       -A_V_SN2012ab  -A_V_NaID_SN2012ab  
%discoveryabsmag_PTF11iqb       =discoverymag_PTF11iqb    +redshiftdistancemodulus_PTF11iqb       -A_V_PTF11iqb  -A_V_NaID_PTF11iqb  
%discoveryabsmag_SN2009ip       =discoverymag_SN2009ip    +redshiftdistancemodulus_SN2009ip       -A_V_SN2009ip  -A_V_NaID_SN2009ip  
%discoveryabsmag_SN2014ab       =discoverymag_SN2014ab    +redshiftdistancemodulus_SN2014ab       -A_V_SN2014ab  -A_V_NaID_SN2014ab  
%discoveryabsmag_ASASSN14il     =discoverymag_ASASSN14il  +redshiftdistancemodulus_ASASSN14il     -A_V_ASASSN14il-A_V_NaID_ASASSN14il
%discoveryabsmag_MJ044212       =discoverymag_MJ044212    +redshiftdistancemodulus_MJ044212       -A_V_MJ044212  -A_V_NaID_MJ044212  
%discoveryabsmag_SN2015da       =discoverymag_SN2015da    +redshiftdistancemodulus_SN2015da       -A_V_SN2015da  -A_V_NaID_SN2015da  
%discoveryabsmag_SN2015bh       =discoverymag_SN2015bh    +redshiftdistancemodulus_SN2015bh       -A_V_SN2015bh  -A_V_NaID_SN2015bh  
%discoveryabsmag_J02331624      =discoverymag_J02331624   +redshiftdistancemodulus_J02331624      -A_V_J02331624 -A_V_NaID_J02331624 
%discoveryabsmag_SN2017gas      =discoverymag_SN2017gas   +redshiftdistancemodulus_SN2017gas      -A_V_SN2017gas -A_V_NaID_SN2017gas 
%discoveryabsmag_SN2017hcc      =discoverymag_SN2017hcc   +redshiftdistancemodulus_SN2017hcc      -A_V_SN2017hcc -A_V_NaID_SN2017hcc 


%needed to convert A_V to A_R for NaID because we didnt store it:
Rv = 3.1;
AR_x = 10000/6580;
AR_y = AR_x - 1.82;
AR_a = 1 + 0.104*AR_y - 0.609*AR_y.^2 +0.701*AR_y.^3 + 1.137*AR_y.^4 - 1.718*AR_y.^5 - 0.827*AR_y.^6 + 1.647*AR_y.^7 - 0.505*AR_y.^8;
AR_b = 1.952*AR_y + 2.908*AR_y.^2 - 3.989*AR_y.^3 - 7.985*AR_y.^4 + 11.102*AR_y.^5 +5.491*AR_y.^6 - 10.805*AR_y.^7 + 3.347*AR_y.^8;
%AR_calc = AV_calc .* (AR_a + AR_b./Rv);
A_R_NaID_SN2011cc = A_V_NaID_SN2011cc  .* (AR_a + AR_b./Rv);
A_R_NaID_SN2012ab = A_V_NaID_SN2012ab  .* (AR_a + AR_b./Rv);
A_R_NaID_PTF11iqb = A_V_NaID_PTF11iqb  .* (AR_a + AR_b./Rv);
A_R_NaID_SN2009ip = A_V_NaID_SN2009ip  .* (AR_a + AR_b./Rv);
A_R_NaID_SN2015bh = A_V_NaID_SN2015bh  .* (AR_a + AR_b./Rv);
A_R_NaID_J02331624= A_V_NaID_J02331624 .* (AR_a + AR_b./Rv);
A_R_NaID_SN2017hcc= A_V_NaID_SN2017hcc .* (AR_a + AR_b./Rv);


peakabsmag_SN2010jl       =peakmag_SN2010jl    +redshiftdistancemodulus_SN2010jl       -A_V_SN2010jl  -A_V_NaID_SN2010jl;  
peakabsmag_SN2011cc       =peakmag_SN2011cc    +redshiftdistancemodulus_SN2011cc       -A_R_SN2011cc  -A_V_NaID_SN2011cc;  
peakabsmag_SN2011ht       =peakmag_SN2011ht    +redshiftdistancemodulus_SN2011ht       -A_V_SN2011ht  -A_V_NaID_SN2011ht;  
peakabsmag_SN2012ab       =peakmag_SN2012ab    +redshiftdistancemodulus_SN2012ab       -A_R_SN2012ab  -A_R_NaID_SN2012ab;  
peakabsmag_PTF11iqb       =peakmag_PTF11iqb    +redshiftdistancemodulus_PTF11iqb       -A_R_PTF11iqb  -A_R_NaID_PTF11iqb;  
peakabsmag_SN2009ip       =peakmag_SN2009ip    +redshiftdistancemodulus_SN2009ip       -A_R_SN2009ip  -A_R_NaID_SN2009ip;  
peakabsmag_SN2014ab       =peakmag_SN2014ab    +redshiftdistancemodulus_SN2014ab       -A_V_SN2014ab  -A_V_NaID_SN2014ab;  
peakabsmag_ASASSN14il     =peakmag_ASASSN14il  +redshiftdistancemodulus_ASASSN14il     -A_V_ASASSN14il-A_V_NaID_ASASSN14il;
peakabsmag_MJ044212       =peakmag_MJ044212    +redshiftdistancemodulus_MJ044212       -A_V_MJ044212  -A_V_NaID_MJ044212;
peakabsmag_SN2015da       =peakmag_SN2015da    +redshiftdistancemodulus_SN2015da       -A_V_SN2015da  -A_V_NaID_SN2015da;  
peakabsmag_SN2015bh       =peakmag_SN2015bh    +redshiftdistancemodulus_SN2015bh       -A_R_SN2015bh  -A_R_NaID_SN2015bh;  
%i is most similar to R between R and V, but ideally we would
peakabsmag_J02331624      =peakmag_J02331624   +redshiftdistancemodulus_J02331624      -A_R_J02331624 -A_R_NaID_J02331624; 
peakabsmag_SN2017gas      =peakmag_SN2017gas   +redshiftdistancemodulus_SN2017gas      -A_V_SN2017gas -A_V_NaID_SN2017gas; 
peakabsmag_SN2017hcc      =peakmag_SN2017hcc   +redshiftdistancemodulus_SN2017hcc      -A_R_SN2017hcc -A_R_NaID_SN2017hcc;



%%absmagB_sn2014ab = LCsn2014ab(4,:) +redshiftdistancemodulus_2014ab-A_B_sn2014ab-A_B_NaID
%
%
%
%
%
%
%
%
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
%[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
%data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
%data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
%data(end).contrange = [data(end).contrange
%[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
%[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
%data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
%data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
%data(end).contrange = [data(end).contrange
%[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];
%
%
%
%
%
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID','testy')
%
%


%agenda
%consider QISP and UISP from serkowski referenced within https://arxiv.org/pdf/1907.03160.pdf
%reduce bh
%plot vel vs cont pol
%plot vel vs time


%sn 2014ab
%2014-03-29
data(end+1).description = 'sn2014ab 2014-03-29 Bok comb';
data(end).name = 'SN 2014ab';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2014ab;
[data(end).wave data(end).flux] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-03-29comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,03,29),juliandate(2014,03,29),juliandate(2014,03,30),juliandate(2014,03,31),juliandate(2014,04,02)];
data(end).date =(56745.37*1920+56746.41*960+56747.38*960+56749.34*960)/(1920+960+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2014ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2014ab;
data(end).wavedez = data(end).wave/(1+z_SN2014ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2014ab+A_V_NaID_SN2014ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);



%2014-04-20
[data(end+1).description] = 'sn2014ab 2014-04-20 MMT comb';
data(end).name = 'SN 2014ab';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2014ab;
[data(end).wave data(end).flux] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2014ab\spectropolarimetry\MMT_SPOL\sn2014ab_2014-04-20comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,04,20),juliandate(2014,04,21)];
data(end).date =(56767.42*720+56768.42*960)/(720+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2014ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2014ab;
data(end).wavedez = data(end).wave/(1+z_SN2014ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2014ab+A_V_NaID_SN2014ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);





%2014-04-26
[data(end+1).description] = 'sn2014ab 2014-04-26 Kuiper comb';
data(end).name = 'SN 2014ab';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2014ab;
[data(end).wave data(end).flux] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-04-26comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,04,26),juliandate(2014,04,27),juliandate(2014,04,28),juliandate(2014,05,01),juliandate(2014,05,01)];
data(end).date =(56773.40*960+56774.39*960+56775.41*960+56778.31*1920)/(960+960+960+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2014ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2014ab;
data(end).wavedez = data(end).wave/(1+z_SN2014ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2014ab+A_V_NaID_SN2014ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2014-05-23
[data(end+1).description] = 'sn2014ab 2014-05-23 Bok comb';
data(end).name = 'SN 2014ab';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2014ab;
[data(end).wave data(end).flux] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2014ab\spectropolarimetry\Bok_SPOL\sn2014ab_2014-05-23comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,05,23),juliandate(2014,05,23),juliandate(2014,05,24),juliandate(2014,05,26)];
data(end).date =(56800.33*1920+56801.31*960+56803.35*960)/(1920+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2014ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2014ab;
data(end).wavedez = data(end).wave/(1+z_SN2014ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2014ab+A_V_NaID_SN2014ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2014-06-22
[data(end+1).description] = 'sn2014ab 2014-06-22 Kuiper comb';
data(end).name = 'SN 2014ab';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2014ab;
[data(end).wave data(end).flux] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2014ab\spectropolarimetry\Kuiper_SPOL\sn2014ab_2014-06-22comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,06,22),juliandate(2014,06,22),juliandate(2014,06,23),juliandate(2014,06,23),juliandate(2014,06,24),juliandate(2014,06,26)];
data(end).date =(56830.24*1920+56831.24*1920+56832.27*960+56834.25*960)/(1920+1920+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2014ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2014ab;
data(end).wavedez = data(end).wave/(1+z_SN2014ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2014ab+A_V_NaID_SN2014ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%sn 2011cc
%2011-09-16
%ind-noqsigusig
[data(end+1).description] = 'sn2011cc 2011-09-16 Bok ind';
data(end).name = 'SN 2011cc';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2011cc;
[data(end).wave data(end).flux] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2011cc\spectropolarimetry\Bok_SPOL\sn2011cc_2011-09-16ind.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,09,16)];
data(end).date =(55820.22*720)/(720)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2011cc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2011cc;
data(end).wavedez = data(end).wave/(1+z_SN2011cc);
data(end).flux_deredMW = deredden(data(end).wavedez,data(end).flux,A_V_SN2011cc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2011cc+A_V_NaID_SN2011cc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%sn 2011ht
%2012-01-23
[data(end+1).description] = 'sn2011ht 2012-01-23 Bok comb';
data(end).name = 'SN 2011ht';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2011ht;
[data(end).wave data(end).flux] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-01-23comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,01,23),juliandate(2012,01,25),juliandate(2012,01,27),juliandate(2012,01,29)];
data(end).date =(55949.45*960+55951.38*960+55953.41*960+55955.33*960)/(960+960+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2011ht;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2011ht;
data(end).wavedez = data(end).wave/(1+z_SN2011ht);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2011ht+A_V_NaID_SN2011ht);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);



%TOO NOISY, excluded data set
%%2012-02-13
%[data(end+1).description] = 'sn2011ht 2012-02-13 Bok comb';
%data(end).name = 'SN 2011ht';
%data(end).tel = 'Bok';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2011ht;
%[data(end).wave data(end).flux] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2011ht\spectropolarimetry\Bok_SPOL\sn2011ht_2012-02-13comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,02,13),juliandate(2012,02,18)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2011ht;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2011ht;
%data(end).wavedez = data(end).wave/(1+z_SN2011ht);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2011ht+A_V_NaID_SN2011ht);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%sn 2012ab
%2012-03-23
[data(end+1).description] = 'sn2012ab 2012-03-23 Bok comb';
data(end).name = 'SN 2012ab';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2012ab;
[data(end).wave data(end).flux] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2012ab\spectropolarimetry\Bok_SPOL\sn2012ab_2012-03-23comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,03,23),juliandate(2012,03,23)];
data(end).date =(56009.41*1200)/(1200)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2012ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2012ab;
data(end).wavedez = data(end).wave/(1+z_SN2012ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2012ab+A_V_NaID_SN2012ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2012-04-16
%depolarization present, measure Hbeta and HeI5876 also
[data(end+1).description] = 'sn2012ab 2012-04-16 MMT comb';
data(end).name = 'SN 2012ab';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2012ab;
[data(end).wave data(end).flux] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2012ab\spectropolarimetry\MMT_SPOL\sn2012ab_2012-04-16comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,04,16),juliandate(2012,04,16),juliandate(2012,04,16)];
data(end).date =(56033.38*1440)/(1440)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2012ab;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2012ab;
data(end).wavedez = data(end).wave/(1+z_SN2012ab);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2012ab+A_V_NaID_SN2012ab);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%PTF11iqb
%2012-01-26
%ind-noqsigusig
[data(end+1).description] = 'PTF11iqb 2012-01-26 Bok ind';
data(end).name = 'PTF11iqb';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_PTF11iqb;
[data(end).wave data(end).flux] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\PTF11iqb\spectropolarimetry\Bok_SPOL\PTF11iqb_2012-01-26ind.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,01,26)];
data(end).date =(55952.13*800)/(800)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_PTF11iqb;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_PTF11iqb;
data(end).wavedez = data(end).wave/(1+z_PTF11iqb);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_PTF11iqb+A_V_NaID_PTF11iqb);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%sn 2009ip
%2012-09-20
[data(end+1).description] = 'sn2009ip 2012-09-20 MMT comb';
data(end).name = 'SN 2009ip';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2009ip;
[data(end).wave data(end).flux] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2009ip\spectropolarimetry\MMT_SPOL\sn2009ip_2012-09-20comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,09,20),juliandate(2012,09,22),juliandate(2012,09,23),juliandate(2012,09,23)];
data(end).date =(56191.22*960+56193.23*960+56194.19*1920)/(960+960+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2009ip;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2009ip;
data(end).wavedez = data(end).wave/(1+z_SN2009ip);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2009ip+A_V_NaID_SN2009ip);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2012-10-11
%depolarization present, measure Hbeta and HeI5876 also
[data(end+1).description] = 'sn2009ip 2012-10-11 Kuiper comb';
data(end).name = 'SN 2009ip';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2009ip;
[data(end).wave data(end).flux] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-10-11comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,10,11),juliandate(2012,10,11),juliandate(2012,10,14),juliandate(2012,10,16),juliandate(2012,10,16)];
data(end).date =(56211.18*1920+56214.16*960+56216.16*1920)/(1920+960+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2009ip;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2009ip;
data(end).wavedez = data(end).wave/(1+z_SN2009ip);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2009ip+A_V_NaID_SN2009ip);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];

%2012-11-12
[data(end+1).description] = 'sn2009ip 2012-11-12 Kuiper comb';
data(end).name = 'SN 2009ip';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2009ip;
[data(end).wave data(end).flux] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2009ip\spectropolarimetry\Kuiper_SPOL\sn2009ip_2012-11-12comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,11,12),juliandate(2012,11,12),juliandate(2012,11,14),juliandate(2012,11,14)];
data(end).date =(56243.13*1920+56245.12*1920)/(1920+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2009ip;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2009ip;
data(end).wavedez = data(end).wave/(1+z_SN2009ip);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2009ip+A_V_NaID_SN2009ip);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2012-12-05
[data(end+1).description] = 'sn2009ip 2012-12-05 Bok comb';
data(end).name = 'SN 2009ip';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2009ip;
[data(end).wave data(end).flux] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2009ip\spectropolarimetry\Bok_SPOL\sn2009ip_2012-12-05comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,12,05),juliandate(2012,12,05),juliandate(2012,12,06),juliandate(2012,12,06),juliandate(2012,12,07)];
data(end).date =(56266.07*1600+56267.08*1600+56268.09*960)/(1600+1600+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2009ip;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2009ip;
data(end).wavedez = data(end).wave/(1+z_SN2009ip);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2009ip+A_V_NaID_SN2009ip);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%sn 2017hcc
%2017-10-17
%depolarization present, measure Hbeta and HeI5876 also
[data(end+1).description] = 'sn2017hcc 2017-10-17 Kuiper comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-10-17comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,10,17),juliandate(2017,10,17),juliandate(2017,10,20),juliandate(2017,10,21),juliandate(2017,10,21),juliandate(2017,10,22),juliandate(2017,10,22)];
data(end).date =(58043.31*1600+58046.23*960+58047.31*1600+58048.26*1600)/(1600+960+1600+1600)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];


%2017-11-15
[data(end+1).description] = 'sn2017hcc 2017-11-15 Kuiper comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-11-15comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,11,15),juliandate(2017,11,15),juliandate(2017,11,16),juliandate(2017,11,16),juliandate(2017,11,21),juliandate(2017,11,21),juliandate(2017,11,21),juliandate(2017,11,21),juliandate(2017,11,21),juliandate(2017,11,22),juliandate(2017,11,22)];
data(end).date =(58072.23*1600+58073.12*1600+58078.13*4640+58079.20*1920)/(1600+1600+4640+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2017-12-08
[data(end+1).description] = 'sn2017hcc 2017-12-08 Kuiper comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2017-12-08comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,12,08),juliandate(2017,12,08),juliandate(2017,12,09),juliandate(2017,12,09),juliandate(2017,12,15),juliandate(2017,12,15),juliandate(2017,12,16),juliandate(2017,12,16)];
data(end).date =(58095.23*960+58096.12*1600+58102.19*1600+58103.12*1920)/(960+1600+1600+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2017-12-21
[data(end+1).description] = 'sn2017hcc 2017-12-21 MMT comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\MMT_SPOL\sn2017hcc_2017-12-21comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,12,21),juliandate(2017,12,21),juliandate(2017,12,22)];
data(end).date =(58108.08*960+58109.11*960)/(960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2018-01-12
[data(end+1).description] = 'sn2017hcc 2018-01-12 Kuiper comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Kuiper_SPOL\sn2017hcc_2018-01-12comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,01,12),juliandate(2018,01,13),juliandate(2018,01,14),juliandate(2018,01,15),juliandate(2018,01,16)];
data(end).date =(58130.16*480+58131.13*960+58132.14*960+58133.15*800+58134.15*800)/(480+960+960+800+800)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2018-01-19
[data(end+1).description] = 'sn2017hcc 2018-01-19 Bok comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-01-19comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,01,19),juliandate(2018,01,20),juliandate(2018,01,20),juliandate(2018,01,22),juliandate(2018,01,23)];
data(end).date =(58137.14*800+58138.08*1280+58140.12*960+58141.14*360)/(800+1280+960+360)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


[data(end+1).description] = 'sn2017hcc 2018-10-28 Bok comb';
data(end).name = 'SN 2017hcc';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017hcc;
[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28)];
data(end).date =(58419.20*4800)/(4800)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%sn 2017gas
%2017-08-30
%depolarization present, measure Hbeta and HeI5876 also
[data(end+1).description] = 'sn2017gas 2017-08-30 MMT comb';
data(end).name = 'SN 2017gas';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017gas;
[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-08-30comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,08,30),juliandate(2017,08,30),juliandate(2017,08,30),juliandate(2017,08,30),juliandate(2017,08,30),juliandate(2017,08,31),juliandate(2017,08,31),juliandate(2017,08,31),juliandate(2017,08,31),juliandate(2017,08,31)];
data(end).date =(57995.21*2400+57996.22*2400)/(2400+2400)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
data(end).wavedez = data(end).wave/(1+z_SN2017gas);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];


%2017-09-19
[data(end+1).description] = 'sn2017gas 2017-09-19 Kuiper comb';
data(end).name = 'SN 2017gas';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017gas;
[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-09-19comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,09,19),juliandate(2017,09,19),juliandate(2017,09,20),juliandate(2017,09,20)];
data(end).date =(58015.21*1920+58016.23*1920)/(1920+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
data(end).wavedez = data(end).wave/(1+z_SN2017gas);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2017-10-17
[data(end+1).description] = 'sn2017gas 2017-10-17 Kuiper comb';
data(end).name = 'SN 2017gas';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017gas;
[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,10,17),juliandate(2017,10,17),juliandate(2017,10,21),juliandate(2017,10,21)];
data(end).date =(58043.20*1920+58047.16*1920)/(1920+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
data(end).wavedez = data(end).wave/(1+z_SN2017gas);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);



%2017-11-19
[data(end+1).description] = 'sn2017gas 2017-11-19 Kuiper comb';
data(end).name = 'SN 2017gas';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017gas;
[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,11,19),juliandate(2017,11,20),juliandate(2017,11,20),juliandate(2017,11,22)];
data(end).date =(58076.16*960+58077.11*1920+58079.10*960)/(960+1920+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
data(end).wavedez = data(end).wave/(1+z_SN2017gas);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);



%2017-12-22
[data(end+1).description] = 'sn2017gas 2017-12-22 MMT comb';
data(end).name = 'SN 2017gas';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2017gas;
[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,12,22),juliandate(2017,12,22)];
data(end).date =(58109.08*1920)/(1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
data(end).wavedez = data(end).wave/(1+z_SN2017gas);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%J02331624 aka PS15cwt
%PS15cwt
%2015-10-16
[data(end+1).description] = 'PS15cwt 2015-10-16 Bok comb';
data(end).name = 'PS15cwt';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_J02331624;
[data(end).wave data(end).flux] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,10,16),juliandate(2015,10,16),juliandate(2015,10,16),juliandate(2015,10,16)];
data(end).date =(57311.31*3840)/(3840)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_J02331624;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_J02331624;
data(end).wavedez = data(end).wave/(1+z_J02331624);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_J02331624+A_V_NaID_J02331624);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%sn 2010jl
%2010-11-10
%depolarization present, measure Hbeta and HeI5876 also
[data(end+1).description] = 'sn2010jl 2010-11-10 Kuiper comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-11-10comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2010,11,10),juliandate(2010,11,10),juliandate(2010,11,10),juliandate(2010,11,11),juliandate(2010,11,12),juliandate(2010,11,14),juliandate(2010,11,14),juliandate(2010,11,14),juliandate(2010,11,15)];
data(end).date = (55510.46*720+55511.46*480+55512.46*240+55514.44*720+55515.43*480)/(720+480+240+720+480)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];

%2010-12-01
%depolarization present, measure Hbeta and HeI5876 also
[data(end+1).description] = 'sn2010jl 2010-12-01 Kuiper comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2010-12-01comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2010,12,01),juliandate(2010,12,02),juliandate(2010,12,03)];
data(end).date =(55531.45*720+55532.44*720+55533.44*800)/(720+720+800)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];

%2011-01-02
[data(end+1).description] = 'sn2010jl 2011-01-02 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-01-02comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,01,02),juliandate(2011,01,03),juliandate(2011,01,03)];
data(end).date =(55563.40*480+55564.39*960)/(480+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2011-02-02
[data(end+1).description] = 'sn2010jl 2011-02-02 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-02-02comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,02,02),juliandate(2011,02,05),juliandate(2011,02,06)];
data(end).date =(55594.35*720+55597.32*720+55598.33*720)/(720+720+720)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2011-03-02
[data(end+1).description] = 'sn2010jl 2011-03-02 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-03-02comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,03,02),juliandate(2011,03,04),juliandate(2011,03,06)];
data(end).date =(55622.31*720+55624.27*720+55626.28*720)/(720+720+720)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2011-04-04
[data(end+1).description] = 'sn2010jl 2011-04-04 Kuiper comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Kuiper_SPOL\sn2010jl_2011-04-04comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,04,04)];
data(end).date =(55655.23*960)/(960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2011-05-27
[data(end+1).description] = 'sn2010jl 2011-05-27 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-05-27comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,05,27)];
data(end).date =(55708.19*720)/(720)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2011-06-14
[data(end+1).description] = 'sn2010jl 2011-06-14 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2011-06-14comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2011,06,14),juliandate(2011,06,15)];
data(end).date =(55726.18*720+55727.17*720)/(720+720)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2012-01-23
[data(end+1).description] = 'sn2010jl 2012-01-23 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-01-23comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,01,23),juliandate(2012,01,25),juliandate(2012,01,27),juliandate(2012,01,29)];
data(end).date =(55949.38*960+55951.30*960+55953.35*960+55955.31*960)/(960+960+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2012-02-13
[data(end+1).description] = 'sn2010jl 2012-02-13 Bok comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\Bok_SPOL\sn2010jl_2012-02-13comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,02,13),juliandate(2012,02,18),juliandate(2012,02,19),juliandate(2012,02,20),juliandate(2012,02,21)];
data(end).date =(55970.28*960+55975.35*960+55976.33*960+55977.39*960+55978.29*960)/(960+960+960+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2012-04-16
[data(end+1).description] = 'sn2010jl 2012-04-16 MMT comb';
data(end).name = 'SN 2010jl';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2010jl;
[data(end).wave data(end).flux] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2010jl\spectropolarimetry\MMT_SPOL\sn2010jl_2012-04-16comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2012,04,16),juliandate(2012,04,16),juliandate(2012,04,16)];
data(end).date =(56033.13*1440)/(1440)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2010jl;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2010jl;
data(end).wavedez = data(end).wave/(1+z_SN2010jl);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2010jl+A_V_NaID_SN2010jl);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%asassn14il
%2014-10-25
[data(end+1).description] = 'asassn-14il 2014-10-25 Kuiper comb';
data(end).name = 'ASASSN-14il';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_ASASSN14il;
[data(end).wave data(end).flux] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-10-25comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,10,25),juliandate(2014,10,25),juliandate(2014,10,28)];
data(end).date =(56955.22*1920+56958.22*960)/(1920+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_ASASSN14il;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_ASASSN14il;
data(end).wavedez = data(end).wave/(1+z_ASASSN14il);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_ASASSN14il+A_V_NaID_ASASSN14il);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2014-11-27
[data(end+1).description] = 'asassn-14il 2014-11-27 Kuiper comb';
data(end).name = 'ASASSN-14il';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_ASASSN14il;
[data(end).wave data(end).flux] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\asassn14il\spectropolarimetry\Kuiper_SPOL\asassn14il_2014-11-27comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2014,11,27),juliandate(2014,11,27),juliandate(2014,11,28),juliandate(2014,11,28)];
data(end).date =(56988.17*1920+56989.18*1920)/(1920+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_ASASSN14il;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_ASASSN14il;
data(end).wavedez = data(end).wave/(1+z_ASASSN14il);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_ASASSN14il+A_V_NaID_ASASSN14il);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2015-01-22
[data(end+1).description] = 'asassn-14il 2015-01-22 Bok comb';
data(end).name = 'ASASSN-14il';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_ASASSN14il;
[data(end).wave data(end).flux] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\asassn14il\spectropolarimetry\Bok_SPOL\asassn14il_2015-01-22comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,01,22),juliandate(2015,01,23)];
data(end).date =(57044.13*960+57045.13*960)/(960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_ASASSN14il;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_ASASSN14il;
data(end).wavedez = data(end).wave/(1+z_ASASSN14il);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_ASASSN14il+A_V_NaID_ASASSN14il);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%MJ044212
%2015-02-19
[data(end+1).description] = 'M04421 2015-02-19 Kuiper comb';
data(end).name = 'M04421';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_MJ044212;
[data(end).wave data(end).flux] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\MJ044212\spectropolarimetry\Kuiper_SPOL\MJ044212_2015-02-19comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,02,19),juliandate(2015,02,19),juliandate(2015,02,19)];
data(end).date =(57072.19*2880)/(2880)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_MJ044212;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_MJ044212;
data(end).wavedez = data(end).wave/(1+z_MJ044212);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_MJ044212+A_V_NaID_MJ044212);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%sn 2015da
%2015-03-25
[data(end+1).description] = 'sn2015da 2015-03-25 Kuiper comb';
data(end).name = 'SN 2015da';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015da;
[data(end).wave data(end).flux] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-03-25comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,03,25),juliandate(2015,03,26),juliandate(2015,03,26),juliandate(2015,03,26)];
data(end).date =(57106.37*960+57107.37*2880)/(960+2880)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015da;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015da;
data(end).wavedez = data(end).wave/(1+z_SN2015da);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015da+A_V_NaID_SN2015da);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2015-04-15
[data(end+1).description] = 'sn2015da 2015-04-15 Kuiper comb';
data(end).name = 'SN 2015da';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015da;
[data(end).wave data(end).flux] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015da\spectropolarimetry\Kuiper_SPOL\sn2015da_2015-04-15comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,04,15),juliandate(2015,04,15),juliandate(2015,04,18),juliandate(2015,04,19)];
data(end).date =(57127.33*1920+57130.39*960+57131.39*960)/(1920+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015da;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015da;
data(end).wavedez = data(end).wave/(1+z_SN2015da);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015da+A_V_NaID_SN2015da);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2015-04-27
[data(end+1).description] = 'sn2015da 2015-04-27 MMT comb';
data(end).name = 'SN 2015da';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015da;
[data(end).wave data(end).flux] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015da\spectropolarimetry\MMT_SPOL\sn2015da_2015-04-27comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,04,27),juliandate(2015,04,27),juliandate(2015,04,27),juliandate(2015,04,29),juliandate(2015,04,29)];
data(end).date =(57139.31*2400+57141.36*1920)/(2400+1920)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015da;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015da;
data(end).wavedez = data(end).wave/(1+z_SN2015da);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015da+A_V_NaID_SN2015da);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);


%2015-05-22
[data(end+1).description] = 'sn2015da 2015-05-22 Bok comb';
data(end).name = 'SN 2015da';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015da;
[data(end).wave data(end).flux] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015da\spectropolarimetry\Bok_SPOL\sn2015da_2015-05-22comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,05,22),juliandate(2015,05,24),juliandate(2015,05,24),juliandate(2015,05,25)];
data(end).date =(57164.33*960+57166.35*1920+57167.34*960)/(960+1920+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015da;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015da;
data(end).wavedez = data(end).wave/(1+z_SN2015da);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015da+A_V_NaID_SN2015da);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%sn 2015bh
%2015-05-19
[data(end+1).description] = 'sn2015bh 2015-05-19 Bok comb';
data(end).name = 'SN 2015bh';
data(end).tel = 'Bok';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015bh;
[data(end).wave data(end).flux] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015bh\spectropolarimetry\Bok_SPOL\sn2015bh_2015-05-19comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,05,19),juliandate(2015,05,20),juliandate(2015,05,22),juliandate(2015,05,23)];
data(end).date =(57161.20*960+57162.18*960+57164.23*960+57165.20*960)/(960+960+960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015bh;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015bh;
data(end).wavedez = data(end).wave/(1+z_SN2015bh);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015bh+A_V_NaID_SN2015bh);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

%2015-06-11
[data(end+1).description] = 'sn2015bh 2015-06-11 MMT comb';
data(end).name = 'SN 2015bh';
data(end).tel = 'MMT';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015bh;
[data(end).wave data(end).flux] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015bh\spectropolarimetry\MMT_SPOL\sn2015bh_2015-06-11comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,06,11),juliandate(2015,06,12)];
data(end).date =(57184.15*960+57185.15*960)/(960+960)-jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015bh;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015bh;
data(end).wavedez = data(end).wave/(1+z_SN2015bh);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015bh+A_V_NaID_SN2015bh);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
[data(end).flux_norm_contHbeta data(end).indx_Hbetapeak data(end).EQW_Hbeta data(end).EQW_Hbeta_sig data(end).EQW_Hbeta_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Hbeta','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Hbeta_narrowcore = data(end).wavedez(data(end).indx_Hbetapeak+1)-data(end).wavedez(data(end).indx_Hbetapeak-1);
data(end).velHbeta= 10^-5 .* c.* (data(end).wavedez-lambdaHbeta)./lambdaHbeta;
data(end).Hbeta_peakwav_contnorm = data(end).wavedez(data(end).indx_Hbetapeak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_Hbetapeak-1) data(end).wavedez(data(end).indx_Hbetapeak+1)]];
[data(end).flux_norm_contHeI5876 data(end).indx_HeI5876peak data(end).EQW_HeI5876 data(end).EQW_HeI5876_sig data(end).EQW_HeI5876_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','HeI5876','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_HeI5876_narrowcore = data(end).wavedez(data(end).indx_HeI5876peak+1)-data(end).wavedez(data(end).indx_HeI5876peak-1);
data(end).velHeI5876= 10^-5 .* c.* (data(end).wavedez-lambdaHeI5876)./lambdaHeI5876;
data(end).HeI5876_peakwav_contnorm = data(end).wavedez(data(end).indx_HeI5876peak);
data(end).contrange = [data(end).contrange
[data(end).wavedez(data(end).indx_HeI5876peak-1) data(end).wavedez(data(end).indx_HeI5876peak+1)]];
%zzz need to initiate this data set by running once, after it is reduced and placed in directory

%2015-06-14
[data(end+1).description] = 'sn2015bh 2015-06-14 Kuiper comb';
data(end).name = 'SN 2015bh';
data(end).tel = 'Kuiper';
data(end).instr = 'SPOL';
data(end).ISP = ISP_SN2015bh;
[data(end).wave data(end).flux] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.flx.txt','%f%f','delimiter',' ');
[dump data(end).q] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.q.txt','%f%f','delimiter',' ');
[dump data(end).qsig] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.qsig.txt','%f%f','delimiter',' ');
[dump data(end).qsum] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.qsum.txt','%f%f','delimiter',' ');
[dump data(end).u] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.u.txt','%f%f','delimiter',' ');
[dump data(end).usig] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.usig.txt','%f%f','delimiter',' ');
[dump data(end).usum] = textread('..\data\sn2015bh\spectropolarimetry\Kuiper_SPOL\sn2015bh_2015-06-14comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2015,06,14),juliandate(2015,06,15),juliandate(2015,06,16),juliandate(2015,06,18),juliandate(2015,06,19)];
data(end).date =(57187.18*800+57188.17*960+57189.18*800+57191.18*720+57192.18*560)/(800+960+800+720+560) -jdtomjd;
data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2015bh;
data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2015bh;
data(end).wavedez = data(end).wave/(1+z_SN2015bh);
data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2015bh+A_V_NaID_SN2015bh);
data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
data(end).contrange = [contrange
[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);

data = data(2:end);


%run SPOL plotting code, generates data_contpol
for i = 1:size(data,2)
i
	if(isempty(data(i).qsig))
		SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum)
	else                                                                                                  
		SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig)
	end
end




%%%%%%%%%%
%%%%%%%%%%
%%%%%%%%%%
%%%%%%%%%%
%%%%%%%%%%
%NaID fitting
%uncomment for running, just commented out so we dont run when running the other code
[data_spec(1).wave data_spec(1).flux] = textread('..\data\ASASSN14il\spectra\ASASSN14il-2014-10-15-MMT-BC-1200.txt','%f%f','delimiter',' ');
data_spec(1).name = 'ASASSN-14il_NaID';
data_spec(1).instr = 'MMT BC';
data_spec(1).date = juliandate(2014,10,15)+8/24+16/60/24+17/60/60/24;
data_spec(1).reldate_peak = data_spec(1).date - peakmagdatejd_ASASSN14il;
data_spec(1).wavedez = data_spec(1).wave/(1+z_ASASSN14il);
data_spec(1).flux_deredMW = deredden(data_spec(1).wavedez,data_spec(1).flux,A_V_ASASSN14il);
data_spec(1).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(1).wavedez,data_spec(1).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_ASASSN14il','dataID',data_spec(1).name);
data_spec(1).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(1).wavedez,data_spec(1).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(1).NaIDest_wavedez = data_spec(1).wavedez*data_spec(1).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(1).NaIDest_wavedez,data_spec(1).flux_deredMW,A_V_ASASSN14il,data_spec(end).NaIDest_align_halpha_multiplier.highres/(1+z_ASASSN14il),data_spec(1).name,data_spec(1).instr,data_spec(1).reldate_peak,'dataID',data_spec(1).name) 

[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\MJ044212\spectra\M04421-2014-10-15-MMT-BC-1200.txt','%f%f','delimiter',' ');
data_spec(2).name = 'M04421_NaID';
data_spec(2).instr = 'MMT BC';
data_spec(2).date = juliandate(2014,10,15)+12/24+13/60/24+19/60/60/24;
data_spec(2).reldate_peak = data_spec(2).date - peakmagdatejd_MJ044212;
data_spec(2).wavedez = data_spec(2).wave/(1+z_MJ044212);
data_spec(2).flux_deredMW = deredden(data_spec(2).wavedez,data_spec(2).flux,A_V_MJ044212);
data_spec(2).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(2).wavedez,data_spec(2).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_MJ044212','dataID',data_spec(2).name);
data_spec(2).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(2).wavedez,data_spec(2).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(2).NaIDest_wavedez = data_spec(2).wavedez*data_spec(2).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(2).NaIDest_wavedez,data_spec(2).flux_deredMW,A_V_MJ044212,data_spec(2).NaIDest_align_halpha_multiplier.highres/(1+z_MJ044212),data_spec(2).name,data_spec(2).instr,data_spec(2).reldate_peak,'dataID',data_spec(2).name)

%M04421
z_real(2) = 1/(data_spec(2).NaIDest_align_halpha_multiplier.highres/(1+z_MJ044212)) - 1
%SN2017gas
z_real(3) = 1/(data_spec(3).NaIDest_align_halpha_multiplier.highres/(1+z_SN2017gas)) - 1
%not really sure exactly where the resolution would factor in, but probably should factor the resolution into the std noise, before it goes into the upper/lower estimating code, or maybe even bin the data into resolution-appropriate sizes.
%for this work we just do not scale by this resolution, and instead use the NaID1 and NaID2 errors into the poznanski formula to estimate the upper limits
%resolution from website on blue channel MMT 1200 grating http://www.mmto.org/instrument-suite/blue-red-channel-spectrographs/blue-channel-details/
%1.45 resolution BC 1200 @ MMT, but each wavelength separation for eqw statistical noise is 0.482896740876543, so we scale noise by resolution element/data separation in wavelengths


[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\sn2017gas\spectra\SN2017gas-2017-10-08-MMT-BCH-1200.txt','%f%f','delimiter',' ');
data_spec(3).name = 'SN 2017gas_NaID';
data_spec(3).instr = 'MMT BC';
data_spec(3).date = juliandate(2017,10,09)+2/24+2/60/24+15/60/60/24;
data_spec(3).reldate_peak = data_spec(3).date - peakmagdatejd_SN2017gas;
data_spec(3).wavedez = data_spec(3).wave/(1+z_SN2017gas);
data_spec(3).flux_deredMW = deredden(data_spec(3).wavedez,data_spec(3).flux,A_V_SN2017gas);
data_spec(3).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(3).wavedez,data_spec(3).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_SN2017gas','dataID',data_spec(3).name);
data_spec(3).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(3).wavedez,data_spec(3).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(3).NaIDest_wavedez = data_spec(3).wavedez*data_spec(3).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(3).NaIDest_wavedez,data_spec(3).flux_deredMW,A_V_SN2017gas,data_spec(3).NaIDest_align_halpha_multiplier.highres/(1+z_SN2017gas),data_spec(3).name,data_spec(3).instr,data_spec(3).reldate_peak,'dataID',data_spec(3).name)

%narrow line offset estimate from coordinates:
%x 5887.83 to 5888.31 offset to 5889.950   --> 5888.07 offset to 5889.950 --> 1.88 --> to km/s is (1.88/5889.950)*c*10^-5 = 95.756330698902360 km/s
%x  5894.12 offset to 5895.924 --> 1.804 --> (1.804/5895.924)*c*10^-5 = 91.792227986656528
% --> 1.842 average offset in angstroms, but doing each offset to km/s itself, then averaging, we get 93.774279342779437 km/s on average here as the offset
%rough error estimate on this velocity: wave separation between pixel is 0.48, so (0.48/5895.924)*c*10^-5 = 24.423652679376460 km/s error



[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\sn2011cc\spectra\sn2011cc_MMT_BCH_1200_6350_20110510_fluxcal.txt','%f%f','delimiter',' ');
data_spec(4).name = 'SN 2011cc_NaID';
data_spec(4).instr = 'MMT BC';
data_spec(4).date = juliandate(2011,05,10);
data_spec(4).reldate_peak = data_spec(4).date - peakmagdatejd_SN2011cc;
data_spec(4).wavedez = data_spec(4).wave/(1+z_SN2011cc);
data_spec(4).flux_deredMW = deredden(data_spec(4).wavedez,data_spec(4).flux,A_V_SN2011cc);
data_spec(4).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(4).wavedez,data_spec(4).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_SN2011cc','dataID',data_spec(4).name);
data_spec(4).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(4).wavedez,data_spec(4).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(4).NaIDest_wavedez = data_spec(4).wavedez*data_spec(4).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(4).NaIDest_wavedez,data_spec(4).flux_deredMW,A_V_SN2011cc,data_spec(4).NaIDest_align_halpha_multiplier.highres/(1+z_SN2011cc),data_spec(4).name,data_spec(4).instr,data_spec(4).reldate_peak,'dataID',data_spec(4).name)

[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\sn2011ht\spectra\sn2011ht_MMT_20120119_6350_fluxcal.txt','%f%f','delimiter',' ');
data_spec(5).name = 'SN 2011ht_NaID';
data_spec(5).instr = 'MMT BC';
data_spec(5).date = juliandate(2012,01,19);
data_spec(5).reldate_peak = data_spec(5).date - peakmagdatejd_SN2011ht;
data_spec(5).wavedez = data_spec(5).wave/(1+z_SN2011ht);
data_spec(5).flux_deredMW = deredden(data_spec(5).wavedez,data_spec(5).flux,A_V_SN2011ht);
data_spec(5).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(5).wavedez,data_spec(5).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_SN2011ht','dataID',data_spec(5).name);
data_spec(5).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(5).wavedez,data_spec(5).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(5).NaIDest_wavedez = data_spec(5).wavedez*data_spec(5).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(5).NaIDest_wavedez,data_spec(5).flux_deredMW,A_V_SN2011ht,data_spec(5).NaIDest_align_halpha_multiplier.highres/(1+z_SN2011ht),data_spec(5).name,data_spec(5).instr,data_spec(5).reldate_peak,'dataID',data_spec(5).name)

%set big upper limit
[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\J02331624\spectropolarimetry\Bok_SPOL\J02331624_2015-10-16comb.flx.txt','%f%f','delimiter',' ');
data_spec(6).name = 'PS15cwt_NaID';
data_spec(6).instr = 'Bok SPOL';
data_spec(6).date = mean([juliandate(2015,10,16),juliandate(2015,10,16),juliandate(2015,10,16),juliandate(2015,10,16)]);
data_spec(6).reldate_peak = data_spec(6).date - peakmagdatejd_J02331624;
data_spec(6).wavedez = data_spec(6).wave/(1+z_J02331624);
data_spec(6).flux_deredMW = deredden(data_spec(6).wavedez,data_spec(6).flux,A_V_J02331624);
data_spec(6).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(6).wavedez,data_spec(6).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_J02331624','dataID',data_spec(6).name);
data_spec(6).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(6).wavedez,data_spec(6).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(6).NaIDest_wavedez = data_spec(6).wavedez*data_spec(6).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(6).NaIDest_wavedez,data_spec(6).flux_deredMW,A_V_J02331624,data_spec(6).NaIDest_align_halpha_multiplier.highres/(1+z_J02331624),data_spec(6).name,data_spec(6).instr,data_spec(6).reldate_peak,'dataID',data_spec(6).name)

%not sure we actually using any error estimates here
%resolution calculation from http://james.as.arizona.edu/~psmith/SPOL/gratings.html and observing log from oct 2015 spol
%R(A) ~ Slit width(arcsec) * scale (pix/arcsec) * dispersion (A/pix) * slit demag
% 4.1 * 1.9 * 4.14 * 0.81
%1.5 * 5.2 * 2.62 * 0.76


[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\PTF11iqb\spectra\11iqb_20110929_Keck2_v1.txt','%f%f','delimiter',' ');
data_spec(7).name = 'PTF11iqb_NaID';
data_spec(7).instr = 'MMT BC';
data_spec(7).date = juliandate(2011,09,29);
data_spec(7).reldate_peak = data_spec(7).date - peakmagdatejd_PTF11iqb;
data_spec(7).wavedez = data_spec(7).wave/(1+z_PTF11iqb);
data_spec(7).flux_deredMW = deredden(data_spec(7).wavedez,data_spec(7).flux,A_V_PTF11iqb);
data_spec(7).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(7).wavedez,data_spec(7).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_PTF11iqb','dataID',data_spec(7).name);
data_spec(7).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(7).wavedez,data_spec(7).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(7).NaIDest_wavedez = data_spec(7).wavedez*data_spec(7).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(7).NaIDest_wavedez,data_spec(7).flux_deredMW,A_V_PTF11iqb,data_spec(7).NaIDest_align_halpha_multiplier.highres/(1+z_PTF11iqb),data_spec(7).name,data_spec(7).instr,data_spec(7).reldate_peak,'dataID',data_spec(7).name)

[data_spec(end+1).wave data_spec(end+1).flux] = textread('..\data\SN2009ip\spectra\sn2009ip_MMT_BCH_1200_6350_20121015_fluxcal.txt','%f%f','delimiter',' ');
data_spec(8).name = 'SN 2009ip_NaID';
data_spec(8).instr = 'MMT BC';
data_spec(8).date = juliandate(2012,10,15);
data_spec(8).reldate_peak = data_spec(8).date - peakmagdatejd_SN2009ip;
data_spec(8).wavedez = data_spec(8).wave/(1+z_SN2009ip);
data_spec(8).flux_deredMW = deredden(data_spec(8).wavedez,data_spec(8).flux,A_V_SN2009ip);
data_spec(8).NaIDest_flux_norm_cont_halpha = measure_line(data_spec(8).wavedez,data_spec(8).flux_deredMW,'interactive','yes','line','Halpha','printlabel','NaIDfitting_SN2009ip','dataID',data_spec(8).name);
data_spec(8).NaIDest_align_halpha_multiplier = measure_peaks_halpha(data_spec(8).wavedez,data_spec(8).NaIDest_flux_norm_cont_halpha,'dataID',strcat(data_spec(end).name,num2str(data_spec(end).reldate_peak)));
data_spec(8).NaIDest_wavedez = data_spec(8).wavedez*data_spec(8).NaIDest_align_halpha_multiplier.highres;
measureNaID(data_spec(8).NaIDest_wavedez,data_spec(8).flux_deredMW,A_V_SN2009ip,data_spec(8).NaIDest_align_halpha_multiplier.highres/(1+z_SN2009ip),data_spec(8).name,data_spec(8).instr,data_spec(8).reldate_peak,'dataID',data_spec(8).name)
%%%%%%%%%%
%%%%%%%%%%
%%%%%%%%%%
%%%%%%%%%%
%%%%%%%%%%



%%%%%%not used







for i = 14
i
	if(isempty(data(i).qsig))
		SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum)
	else                                                                                                  
		SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig)
	end
end

%MMT does rotate and bok/kuiper looking piggybacking, email 










%%might not need this code anymore
%%%run data_FW generating code
%
%dataoutputdirectory = 'C:\Users\Cbilinski\Dropbox\Astrophysics\Projects\GradSchool\TypeIInsSNSPOL\data\';
%figuredirectory = 'C:\Users\Cbilinski\Dropbox\Astrophysics\Projects\GradSchool\TypeIInsSNSPOL\data\';
%filename_data_FW = strcat(dataoutputdirectory,'data_FW_new.txt');
%
%for i = 1:size(data,2)
%	data(i).flux_Halphacoretot = sum(data(i).flux_norm_conthalpha(data(i).indx_Halphapeak-1:data(i).indx_Halphapeak+1));
%	data(i).name_nospace = data(i).name(find(~isspace((data(i).name))))
%	results_FW = [num2str(data(i).vel_FW),' ',num2str(data(i).flux_Halphacoretot),' ',num2str(data(i).flux_Halphabroadtot),' ',num2str(data(i).flux_Halphabroadtot_numpix),' ',data(i).name_nospace,' ',data(i).tel,' ',num2str(data(i).reldate_peak),' '];
%	dlmwrite(filename_data_FW,results_FW,'-append','delimiter','');
%end
%
%
%
%
%
%
%
%
%
%
%
%
%
%%with ISP removed
%
%%run SPOL plotting code, generates data_contpol
%for i = 1:size(data,2)
%	if(isempty(data(i).qsig))
%		SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum)
%	else                                                                                                  
%		SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig)
%	end
%end
%
%%sn 2017gas
%%2017-08-30
%i=22
%SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig,'ISPexact',[-1.0321*0.01,-1.1081*0.01])
%
%
%SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig,'ISPexact',5)
%
%
%%zzz for rest of ISP exact objects
%for i = 1:size(data,2)
%	if(~isempty(data(i).ISPfitvals_common))
%		if(isempty(data(i).qsig))
%			%[data(i).SPOLPlotter_wavecut data(i).SPOLPlotter_qRSP data(i).SPOLPlotter_uRSP data(i).SPOLPlotter_popt] = SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'ISPfitvals',data(i).ISPfitvals_common,'Halphacorewav',data(i).wavedez(data(i).indx_Halphapeak))
%		else                                                                                                  
%			%[data(i).SPOLPlotter_wavecut data(i).SPOLPlotter_qRSP data(i).SPOLPlotter_uRSP data(i).SPOLPlotter_popt] = SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig,'ISPfitvals',data(i).ISPfitvals_common,'Halphacorewav',data(i).wavedez(data(i).indx_Halphapeak))
%		end
%	else
%		if(isempty(data(i).qsig))
%			%[data(i).SPOLPlotter_wavecut data(i).SPOLPlotter_qRSP data(i).SPOLPlotter_uRSP data(i).SPOLPlotter_popt] = SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum)
%		else                                                                                                  
%			%[data(i).SPOLPlotter_wavecut data(i).SPOLPlotter_qRSP data(i).SPOLPlotter_uRSP data(i).SPOLPlotter_popt] = SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig)
%		end
%	end
%end
%
%
%%SPOLPlotter(data(i).wavedez,data(i).flux,data(i).q,data(i).u,data(i).ymdplotlabel,data(i).reldate_peak,data(i).name,[data(i).tel ' ' data(i).instr],size(data(i).contrange,1),data(i).contrange,'ISP',data(i).ISP,'qsum',data(i).qsum,'usum',data(i).usum,'qsig',data(i).qsig,'usig',data(i).usig,'ISPexact',[-1.0321*0.01,-1.1081*0.01])
%
%
%%[testy testyindex] = rmoutliers(data(13).flux,'movmedian',150,'ThresholdFactor',0.5);
%%hold all
%%plot(data(13).wavedez(~testyindex),testy)
%%plot(data(13).wavedez,data(13).flux)
%%plot(data(13).wavedez(~testyindex),testy-0.1*mean(testy))
%
%
%lowbound = 4400;
%uppbound = 7000;
%
%figuredirectory = 'c:\Users\Cbilinski\Desktop\Figures\';
%
%
%
%
%for i=1:size(data,2)
%	data(i).description_nows = data(i).description;
%	data(i).description_nows(data(i).description_nows == ' ') = [];
%	data(i).fit_flux_bounded = data(i).flux(((data(i).wavedez)>lowbound)&((data(i).wavedez)<uppbound));
%	[data(i).fit_flux_bounded_outliersremoved data(i).fit_index_outliers] = rmoutliers(data(i).fit_flux_bounded,'movmedian',150,'ThresholdFactor',0.5);
%	outlierfig = figure;
%	clf
%	hold all
%	plot(data(i).SPOLPlotter_wavecut(~data(i).fit_index_outliers),data(i).fit_flux_bounded_outliersremoved)
%	plot(data(i).SPOLPlotter_wavecut,data(i).fit_flux_bounded)
%	plot(data(i).SPOLPlotter_wavecut(~data(i).fit_index_outliers),data(i).fit_flux_bounded_outliersremoved-0.1*mean(data(i).fit_flux_bounded_outliersremoved))
%	%saveplot
%	filename_outliers{i} = strcat(figuredirectory,'qRSPslope\outliers_',data(i).description_nows,'.eps');
%	saveas(outlierfig, [filename_outliers{i}], 'epsc');
%	eval(['!epstopdf ' filename_outliers{i}]);
%	close(outlierfig)
%
%	%if there are two versions of the qRSP,uRSP,p2_opt because an ISP exact q and u were subtracted, store the subtracted fit as the primary value and the nonsubtracted as an additional variable
%	if(size(data(i).SPOLPlotter_qRSP,2) == 2)
%		data(i).fit_linearqRSP_filtered_noISPsub = fit(data(i).SPOLPlotter_wavecut(~data(i).fit_index_outliers),data(i).SPOLPlotter_qRSP{1}(~data(i).fit_index_outliers),'poly1','Robust','Bisquare');
%		data(i).fit_linearqRSP_noISPsub = fit(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{1},'poly1','Robust','Bisquare');
%		fitfigure_noISPsub = figure;
%		hold all
%		plot(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{1})
%		plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP_noISPsub(data(i).SPOLPlotter_wavecut))
%		plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP_filtered_noISPsub(data(i).SPOLPlotter_wavecut))
%		%saveplot
%		filename_qRSPfit_noISPsub{i} = strcat(figuredirectory,'qRSPslope\qRSP_slopefit_noISPsub_',data(i).description_nows,'.eps');
%		saveas(fitfigure_noISPsub, [filename_qRSPfit_noISPsub{i}], 'epsc');
%		eval(['!epstopdf ' filename_qRSPfit_noISPsub{i}]);
%		close(fitfigure_noISPsub)
%		
%		data(i).fit_linearqRSP_filtered = fit(data(i).SPOLPlotter_wavecut(~data(i).fit_index_outliers),data(i).SPOLPlotter_qRSP{2}(~data(i).fit_index_outliers),'poly1','Robust','Bisquare');
%		data(i).fit_linearqRSP = fit(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{2},'poly1','Robust','Bisquare');
%		fitfigure = figure;
%		hold all
%		plot(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{2})
%		plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP(data(i).SPOLPlotter_wavecut))
%		plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP_filtered(data(i).SPOLPlotter_wavecut))
%		%saveplot
%		filename_qRSPfit{i} = strcat(figuredirectory,'qRSPslope\qRSP_slopefit_',data(i).description_nows,'.eps');
%		saveas(fitfigure, [filename_qRSPfit{i}], 'epsc');
%		eval(['!epstopdf ' filename_qRSPfit{i}]);
%		close(fitfigure)
%	else
%		data(i).fit_linearqRSP_filtered = fit(data(i).SPOLPlotter_wavecut(~data(i).fit_index_outliers),data(i).SPOLPlotter_qRSP{1}(~data(i).fit_index_outliers),'poly1','Robust','Bisquare');
%		data(i).fit_linearqRSP = fit(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{1},'poly1','Robust','Bisquare');
%		fitfigure = figure;
%		hold all
%		plot(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{1})
%		plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP(data(i).SPOLPlotter_wavecut))
%		plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP_filtered(data(i).SPOLPlotter_wavecut))
%		%saveplot
%		filename_qRSPfit{i} = strcat(figuredirectory,'qRSPslope\qRSP_slopefit_',data(i).description_nows,'.eps');
%		saveas(fitfigure, [filename_qRSPfit{i}], 'epsc');
%		eval(['!epstopdf ' filename_qRSPfit{i}]);
%		close(fitfigure)
%	end
%	
%	%data(i).fit_linearqRSP_filtered = fit(data(i).SPOLPlotter_wavecut(~data(i).fit_index_outliers),data(i).SPOLPlotter_qRSP{1}(~data(i).fit_index_outliers),'poly1','Robust','Bisquare');
%	%data(i).fit_linearqRSP = fit(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{1},'poly1','Robust','Bisquare');
%	%fitfigure = figure;
%	%hold all
%	%plot(data(i).SPOLPlotter_wavecut,data(i).SPOLPlotter_qRSP{1})
%	%plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP(data(i).SPOLPlotter_wavecut))
%	%plot(data(i).SPOLPlotter_wavecut,data(i).fit_linearqRSP_filtered(data(i).SPOLPlotter_wavecut))
%	%saveplot
%end
%
%
%%basic plot
%
%
%%histogram plot
%
%
%%slope parameter vs time plot
%
%slopevstimefigure = figure;
%clf
%hold all
%for i=1:size(data,2)
%	data(i).name_nows = data(i).name;
%	data(i).name_nows(data(i).name_nows == ' ') = [];
%	scatter(data(i).reldate_peak,data(i).fit_linearqRSP_filtered.p1,100,colormatrix_pool(strcmp(data(i).name_nows,snnames),:),'filled');	
%	errorbar(data(i).reldate_peak,data(i.fit_linearqRSP_filtered.p1,)
%end
%
%slopevstimefig_hleg = legend(snnames);
%%slopevstimefig_chleg = get(slopevstimefig_hleg,'children')
%for i=1:size(snnames,1)
%	slopevstimefig_hleg.String{i} = ['\color[rgb]{' num2str(colormatrix_pool(i,:)) '} ' slopevstimefig_hleg.String{i}]
%end
%
%
%
%
%
%snnames([2 14]) = snnames([14 2]);
%
%
%
%
%data(16).fit_linearqRSP.
%
%
%
%i = 26


%2017-09-19


%%2017-10-17
%[data(end+1).description] = 'sn2017gas 2017-10-17 Kuiper comb';
%data(end).name = 'SN 2017gas';
%data(end).tel = 'Kuiper';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017gas;
%[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-10-17comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,10,17),juliandate(2017,10,17),juliandate(2017,10,21),juliandate(2017,10,21)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
%data(end).wavedez = data(end).wave/(1+z_SN2017gas);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%data(end).flux_norm_conthalpha = estimate_cont_halpha(data(end).wavedez,data(end).flux,'printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)));
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).indx_blueHalpha100 = find(data(end).wavedez>(lambdaHalpha-100),1,'first');
%data(end).indx_redHalpha100 = find(data(end).wavedez<(lambdaHalpha+100),1,'last');
%[data(end).Halpha_peakvalue_contnorm data(end).indx_Halphapeak_afterblue] = max(data(end).flux_norm_conthalpha(data(end).indx_blueHalpha100:data(end).indx_redHalpha100));
%data(end).indx_Halphapeak = data(end).indx_blueHalpha100+(data(end).indx_Halphapeak_afterblue-1);
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]
%[data(end).wavedez(data(end).indx_Halphapeakmin200A) data(end).wavedez(data(end).indx_Halphapeakplu200A)]];
%data(end).flux_norm1_conthalpha_norm2_peakhalpha = 1+(data(end).flux_norm_conthalpha-1)./(data(end).flux_norm_conthalpha(data(end).indx_Halphapeak)-1);
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight)
%data(end).flux_Halphacoretot = sum(data(end).flux_norm_conthalpha(data(end).indx_Halphapeak-1:data(end).indx_Halphapeak+1));
%data(end).flux_Halphabroadtot = sum(data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A));
%data(end).flux_Halphabroadtot_numpix = data(end).indx_Halphapeakplu200A-data(end).indx_Halphapeakmin200A+1;
%
%
%
%%2017-11-19
%[data(end+1).description] = 'sn2017gas 2017-11-19 Kuiper comb';
%data(end).name = 'SN 2017gas';
%data(end).tel = 'Kuiper';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017gas;
%[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\Kuiper_SPOL\sn2017gas_2017-11-19comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,11,19),juliandate(2017,11,20),juliandate(2017,11,20),juliandate(2017,11,22)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
%data(end).wavedez = data(end).wave/(1+z_SN2017gas);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%data(end).flux_norm_conthalpha = estimate_cont_halpha(data(end).wavedez,data(end).flux,'printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)));
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).indx_blueHalpha100 = find(data(end).wavedez>(lambdaHalpha-100),1,'first');
%data(end).indx_redHalpha100 = find(data(end).wavedez<(lambdaHalpha+100),1,'last');
%[data(end).Halpha_peakvalue_contnorm data(end).indx_Halphapeak_afterblue] = max(data(end).flux_norm_conthalpha(data(end).indx_blueHalpha100:data(end).indx_redHalpha100));
%data(end).indx_Halphapeak = data(end).indx_blueHalpha100+(data(end).indx_Halphapeak_afterblue-1);
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]
%[data(end).wavedez(data(end).indx_Halphapeakmin200A) data(end).wavedez(data(end).indx_Halphapeakplu200A)]];
%data(end).flux_norm1_conthalpha_norm2_peakhalpha = 1+(data(end).flux_norm_conthalpha-1)./(data(end).flux_norm_conthalpha(data(end).indx_Halphapeak)-1);
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight)
%data(end).flux_Halphacoretot = sum(data(end).flux_norm_conthalpha(data(end).indx_Halphapeak-1:data(end).indx_Halphapeak+1));
%data(end).flux_Halphabroadtot = sum(data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A));
%data(end).flux_Halphabroadtot_numpix = data(end).indx_Halphapeakplu200A-data(end).indx_Halphapeakmin200A+1;
%
%
%
%%2017-12-22
%[data(end+1).description] = 'sn2017gas 2017-12-22 MMT comb';
%data(end).name = 'SN 2017gas';
%data(end).tel = 'MMT';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017gas;
%[data(end).wave data(end).flux] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017gas\spectropolarimetry\MMT_SPOL\sn2017gas_2017-12-22comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2017,12,22),juliandate(2017,12,22)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017gas;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017gas;
%data(end).wavedez = data(end).wave/(1+z_SN2017gas);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017gas+A_V_NaID_SN2017gas);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%data(end).flux_norm_conthalpha = estimate_cont_halpha(data(end).wavedez,data(end).flux,'printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)));
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).indx_blueHalpha100 = find(data(end).wavedez>(lambdaHalpha-100),1,'first');
%data(end).indx_redHalpha100 = find(data(end).wavedez<(lambdaHalpha+100),1,'last');
%[data(end).Halpha_peakvalue_contnorm data(end).indx_Halphapeak_afterblue] = max(data(end).flux_norm_conthalpha(data(end).indx_blueHalpha100:data(end).indx_redHalpha100));
%data(end).indx_Halphapeak = data(end).indx_blueHalpha100+(data(end).indx_Halphapeak_afterblue-1);
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]
%[data(end).wavedez(data(end).indx_Halphapeakmin200A) data(end).wavedez(data(end).indx_Halphapeakplu200A)]];
%data(end).flux_norm1_conthalpha_norm2_peakhalpha = 1+(data(end).flux_norm_conthalpha-1)./(data(end).flux_norm_conthalpha(data(end).indx_Halphapeak)-1);
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight)
%data(end).flux_Halphacoretot = sum(data(end).flux_norm_conthalpha(data(end).indx_Halphapeak-1:data(end).indx_Halphapeak+1));
%data(end).flux_Halphabroadtot = sum(data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A));
%data(end).flux_Halphabroadtot_numpix = data(end).indx_Halphapeakplu200A-data(end).indx_Halphapeakmin200A+1;


%testing stuff


%%2018-10-28
%[data(end+1).description] = 'sn2017hcc 2018-10-28 Bok comb';
%data(end).name = 'SN 2017hcc';
%data(end).tel = 'Bok';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017hcc;
%[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,29),juliandate(2018,10,29),juliandate(2018,10,29),juliandate(2018,11,01),juliandate(2018,11,01),juliandate(2018,11,01)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
%data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
%
%
%
%%2018-10-28
%[data(end+1).description] = 'sn2017hcc 2018-10-28 Bok Paul';
%data(end).name = 'SN 2017hcc_test';
%data(end).tel = 'Bok';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017hcc;
%[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_18oct_1.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_1.q.txt','%f%f','delimiter',' ');
%%[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_1.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_1.u.txt','%f%f','delimiter',' ');
%%[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_1.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,29),juliandate(2018,10,29),juliandate(2018,10,29),juliandate(2018,11,01),juliandate(2018,11,01),juliandate(2018,11,01)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
%data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
%
%
%%2018-10-28
%[data(end+1).description] = 'sn2017hcc 2018-10-28 Bok Chris1';
%data(end).name = 'SN 2017hcc';
%data(end).tel = 'Bok';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017hcc;
%[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-28comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,28),juliandate(2018,10,29),juliandate(2018,10,29),juliandate(2018,10,29),juliandate(2018,11,01),juliandate(2018,11,01),juliandate(2018,11,01)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
%data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
%
%
%%2018-10-29
%[data(end+1).description] = 'sn2017hcc 2018-10-29 Bok Chris1';
%data(end).name = 'SN 2017hcc';
%data(end).tel = 'Bok';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017hcc;
%[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-10-29comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,11,01),juliandate(2018,11,01),juliandate(2018,11,01)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
%data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);
%
%
%
%%2018-11-01
%[data(end+1).description] = 'sn2017hcc 2018-11-01 Bok Chris1';
%data(end).name = 'SN 2017hcc';
%data(end).tel = 'Bok';
%data(end).instr = 'SPOL';
%data(end).ISP = ISP_SN2017hcc;
%[data(end).wave data(end).flux] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01.flx.txt','%f%f','delimiter',' ');
%[dump data(end).q] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01comb.q.txt','%f%f','delimiter',' ');
%[dump data(end).qsig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01comb.qsig.txt','%f%f','delimiter',' ');
%[dump data(end).qsum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01comb.qsum.txt','%f%f','delimiter',' ');
%[dump data(end).u] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01comb.u.txt','%f%f','delimiter',' ');
%[dump data(end).usig] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01comb.usig.txt','%f%f','delimiter',' ');
%[dump data(end).usum] = textread('..\data\sn2017hcc\spectropolarimetry\Bok_SPOL\sn2017hcc_2018-11-01comb.usum.txt','%f%f','delimiter',' ');
%data(end).date = [juliandate(2018,11,01),juliandate(2018,11,01),juliandate(2018,11,01)];
%data(end).reldate_disc = mean(data(end).date) - discoverydatejd_SN2017hcc;
%data(end).reldate_peak = mean(data(end).date) - peakmagdatejd_SN2017hcc;
%data(end).wavedez = data(end).wave/(1+z_SN2017hcc);
%data(end).flux = deredden(data(end).wavedez,data(end).flux,A_V_SN2017hcc+A_V_NaID_SN2017hcc);
%data(end).ymdplotlabel = [num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Year),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Month),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Day),'-',num2str(datetime(mean(data(end).date),'convertfrom','juliandate').Hour/24)];
%[data(end).flux_norm_conthalpha data(end).indx_Halphapeak data(end).EQW_Halpha data(end).EQW_Halpha_sig data(end).EQW_Halpha_narrowcore]= measure_line(data(end).wavedez,data(end).flux,'line','Halpha','printlabel',strcat(data(end).name,num2str(data(end).reldate_peak)),'interactive','yes','dataID',data(end).description)
%data(end).wavrange_Halpha_narrowcore = data(end).wavedez(data(end).indx_Halphapeak+1)-data(end).wavedez(data(end).indx_Halphapeak-1);
%data(end).velHalpha = 10^-5 .* c.* (data(end).wavedez-lambdaHalpha)./lambdaHalpha;
%data(end).Halpha_peakwav_contnorm = data(end).wavedez(data(end).indx_Halphapeak);
%data(end).indx_Halphapeakmin200A = find(data(end).wavedez > (data(end).Halpha_peakwav_contnorm - 200),1,'first');
%data(end).indx_Halphapeakplu200A = find(data(end).wavedez < (data(end).Halpha_peakwav_contnorm + 200),1,'last');
%data(end).lorentzfit_Halpha = lorentzfit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)');
%data(end).gaussfit_Halpha = fit(data(end).wavedez(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A),data(end).flux_norm_conthalpha(data(end).indx_Halphapeakmin200A:data(end).indx_Halphapeakplu200A)','gauss2');
%data(end).contrange = [contrange
%[data(end).wavedez(data(end).indx_Halphapeak-1) data(end).wavedez(data(end).indx_Halphapeak+1)]];
%data(end).vel_FW = measureFW(data(end).wavedez,data(end).flux_norm_conthalpha,FWheight);






